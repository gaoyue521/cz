/*2017-09-14 23:13:16 smartisan*/
!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t(require,exports,module):e.CountUp=t()}(this,function(e,t,o){var i=function(e,t,o,i,r,a){for(var s=0,n=["webkit","moz","ms","o"],c=0;c<n.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[n[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[c]+"CancelAnimationFrame"]||window[n[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var o=(new Date).getTime(),i=Math.max(0,16-(o-s)),r=window.setTimeout(function(){e(o+i)},i);return s=o+i,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});var l=this;l.options={useEasing:!0,useGrouping:!0,separator:",",decimal:".",easingFn:null,formattingFn:null};for(var u in a)a.hasOwnProperty(u)&&(l.options[u]=a[u]);""===l.options.separator&&(l.options.useGrouping=!1),l.options.prefix||(l.options.prefix=""),l.options.suffix||(l.options.suffix=""),l.d="string"==typeof e?document.getElementById(e):e,l.startVal=Number(t),l.endVal=Number(o),l.countDown=l.startVal>l.endVal,l.frameVal=l.startVal,l.decimals=Math.max(0,i||0),l.dec=Math.pow(10,l.decimals),l.duration=1e3*Number(r)||2e3,l.formatNumber=function(e){e=e.toFixed(l.decimals),e+="";var t,o,i,r;if(t=e.split("."),o=t[0],i=t.length>1?l.options.decimal+t[1]:"",r=/(\d+)(\d{3})/,l.options.useGrouping)for(;r.test(o);)o=o.replace(r,"$1"+l.options.separator+"$2");return l.options.prefix+o+i+l.options.suffix},l.easeOutExpo=function(e,t,o,i){return o*(-Math.pow(2,-10*e/i)+1)*1024/1023+t},l.easingFn=l.options.easingFn?l.options.easingFn:l.easeOutExpo,l.formattingFn=l.options.formattingFn?l.options.formattingFn:l.formatNumber,l.version=function(){return"1.7.1"},l.printValue=function(e){var t=l.formattingFn(e);"INPUT"===l.d.tagName?this.d.value=t:"text"===l.d.tagName||"tspan"===l.d.tagName?this.d.textContent=t:this.d.innerHTML=t},l.count=function(e){l.startTime||(l.startTime=e),l.timestamp=e;var t=e-l.startTime;l.remaining=l.duration-t,l.options.useEasing?l.countDown?l.frameVal=l.startVal-l.easingFn(t,0,l.startVal-l.endVal,l.duration):l.frameVal=l.easingFn(t,l.startVal,l.endVal-l.startVal,l.duration):l.countDown?l.frameVal=l.startVal-(l.startVal-l.endVal)*(t/l.duration):l.frameVal=l.startVal+(l.endVal-l.startVal)*(t/l.duration),l.countDown?l.frameVal=l.frameVal<l.endVal?l.endVal:l.frameVal:l.frameVal=l.frameVal>l.endVal?l.endVal:l.frameVal,l.frameVal=Math.round(l.frameVal*l.dec)/l.dec,l.printValue(l.frameVal),t<l.duration?l.rAF=requestAnimationFrame(l.count):l.callback&&l.callback()},l.start=function(e){return l.callback=e,l.rAF=requestAnimationFrame(l.count),!1},l.pauseResume=function(){l.paused?(l.paused=!1,delete l.startTime,l.duration=l.remaining,l.startVal=l.frameVal,requestAnimationFrame(l.count)):(l.paused=!0,cancelAnimationFrame(l.rAF))},l.reset=function(){l.paused=!1,delete l.startTime,l.startVal=t,cancelAnimationFrame(l.rAF),l.printValue(l.startVal)},l.update=function(e){cancelAnimationFrame(l.rAF),l.paused=!1,delete l.startTime,l.startVal=l.frameVal,l.endVal=Number(e),l.countDown=l.startVal>l.endVal,l.rAF=requestAnimationFrame(l.count)},l.printValue(l.startVal)};return i}),function(){function e(e){this.tokens=[],this.tokens.links={},this.options=e||l.defaults,this.rules=u.normal,this.options.gfm&&(this.options.tables?this.rules=u.tables:this.rules=u.gfm)}function t(e,t){if(this.options=t||l.defaults,this.links=e,this.rules=d.normal,this.renderer=this.options.renderer||new o,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=d.breaks:this.rules=d.gfm:this.options.pedantic&&(this.rules=d.pedantic)}function o(e){this.options=e||{}}function i(e){this.tokens=[],this.token=null,this.options=e||l.defaults,this.options.renderer=this.options.renderer||new o,this.renderer=this.options.renderer,this.renderer.options=this.options}function r(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function a(e){return e.replace(/&([#\w]+);/g,function(e,t){return t=t.toLowerCase(),"colon"===t?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""})}function s(e,t){return e=e.source,t=t||"",function o(i,r){return i?(r=r.source||r,r=r.replace(/(^|[^\[])\^/g,"$1"),e=e.replace(i,r),o):new RegExp(e,t)}}function n(){}function c(e){for(var t,o,i=1;i<arguments.length;i++){t=arguments[i];for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}function l(t,o,a){if(a||"function"==typeof o){a||(a=o,o=null),o=c({},l.defaults,o||{});var s,n,u=o.highlight,d=0;try{s=e.lex(t,o)}catch(p){return a(p)}n=s.length;var f=function(e){if(e)return o.highlight=u,a(e);var t;try{t=i.parse(s,o)}catch(r){e=r}return o.highlight=u,e?a(e):a(null,t)};if(!u||u.length<3)return f();if(delete o.highlight,!n)return f();for(;d<s.length;d++)!function(e){return"code"!==e.type?--n||f():u(e.text,e.lang,function(t,o){return t?f(t):null==o||o===e.text?--n||f():(e.text=o,e.escaped=!0,void(--n||f()))})}(s[d])}else try{return o&&(o=c({},l.defaults,o)),i.parse(e.lex(t,o),o)}catch(p){if(p.message+="\nPlease report this to https://github.com/chjj/marked.",(o||l.defaults).silent)return"<p>An error occured:</p><pre>"+r(p.message+"",!0)+"</pre>";throw p}}var u={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:n,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:n,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n(?!def)[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:n,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};u.bullet=/(?:[*+-]|\d+\.)/,u.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,u.item=s(u.item,"gm")(/bull/g,u.bullet)(),u.list=s(u.list)(/bull/g,u.bullet)("hr","\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))")("def","\\n+(?="+u.def.source+")")(),u.blockquote=s(u.blockquote)("def",u.def)(),u._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b",u.html=s(u.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,u._tag)(),u.paragraph=s(u.paragraph)("hr",u.hr)("heading",u.heading)("lheading",u.lheading)("blockquote",u.blockquote)("tag","<"+u._tag)("def",u.def)(),u.normal=c({},u),u.gfm=c({},u.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/}),u.gfm.paragraph=s(u.paragraph)("(?!","(?!"+u.gfm.fences.source.replace("\\1","\\2")+"|"+u.list.source.replace("\\1","\\3")+"|")(),u.tables=c({},u.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),e.rules=u,e.lex=function(t,o){var i=new e(o);return i.lex(t)},e.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},e.prototype.token=function(e,t,o){for(var i,r,a,s,n,c,l,d,p,e=e.replace(/^ +$/gm,"");e;)if((a=this.rules.newline.exec(e))&&(e=e.substring(a[0].length),a[0].length>1&&this.tokens.push({type:"space"})),a=this.rules.code.exec(e))e=e.substring(a[0].length),a=a[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?a:a.replace(/\n+$/,"")});else if(a=this.rules.fences.exec(e))e=e.substring(a[0].length),this.tokens.push({type:"code",lang:a[2],text:a[3]});else if(a=this.rules.heading.exec(e))e=e.substring(a[0].length),this.tokens.push({type:"heading",depth:a[1].length,text:a[2]});else if(t&&(a=this.rules.nptable.exec(e))){for(e=e.substring(a[0].length),c={type:"table",header:a[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:a[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:a[3].replace(/\n$/,"").split("\n")},d=0;d<c.align.length;d++)/^ *-+: *$/.test(c.align[d])?c.align[d]="right":/^ *:-+: *$/.test(c.align[d])?c.align[d]="center":/^ *:-+ *$/.test(c.align[d])?c.align[d]="left":c.align[d]=null;for(d=0;d<c.cells.length;d++)c.cells[d]=c.cells[d].split(/ *\| */);this.tokens.push(c)}else if(a=this.rules.lheading.exec(e))e=e.substring(a[0].length),this.tokens.push({type:"heading",depth:"="===a[2]?1:2,text:a[1]});else if(a=this.rules.hr.exec(e))e=e.substring(a[0].length),this.tokens.push({type:"hr"});else if(a=this.rules.blockquote.exec(e))e=e.substring(a[0].length),this.tokens.push({type:"blockquote_start"}),a=a[0].replace(/^ *> ?/gm,""),this.token(a,t,!0),this.tokens.push({type:"blockquote_end"});else if(a=this.rules.list.exec(e)){for(e=e.substring(a[0].length),s=a[2],this.tokens.push({type:"list_start",ordered:s.length>1}),a=a[0].match(this.rules.item),i=!1,p=a.length,d=0;d<p;d++)c=a[d],l=c.length,c=c.replace(/^ *([*+-]|\d+\.) +/,""),~c.indexOf("\n ")&&(l-=c.length,c=this.options.pedantic?c.replace(/^ {1,4}/gm,""):c.replace(new RegExp("^ {1,"+l+"}","gm"),"")),this.options.smartLists&&d!==p-1&&(n=u.bullet.exec(a[d+1])[0],s===n||s.length>1&&n.length>1||(e=a.slice(d+1).join("\n")+e,d=p-1)),r=i||/\n\n(?!\s*$)/.test(c),d!==p-1&&(i="\n"===c.charAt(c.length-1),r||(r=i)),this.tokens.push({type:r?"loose_item_start":"list_item_start"}),this.token(c,!1,o),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(a=this.rules.html.exec(e))e=e.substring(a[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:"pre"===a[1]||"script"===a[1]||"style"===a[1],text:a[0]});else if(!o&&t&&(a=this.rules.def.exec(e)))e=e.substring(a[0].length),this.tokens.links[a[1].toLowerCase()]={href:a[2],title:a[3]};else if(t&&(a=this.rules.table.exec(e))){for(e=e.substring(a[0].length),c={type:"table",header:a[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:a[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:a[3].replace(/(?: *\| *)?\n$/,"").split("\n")},d=0;d<c.align.length;d++)/^ *-+: *$/.test(c.align[d])?c.align[d]="right":/^ *:-+: *$/.test(c.align[d])?c.align[d]="center":/^ *:-+ *$/.test(c.align[d])?c.align[d]="left":c.align[d]=null;for(d=0;d<c.cells.length;d++)c.cells[d]=c.cells[d].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(c)}else if(t&&(a=this.rules.paragraph.exec(e)))e=e.substring(a[0].length),this.tokens.push({type:"paragraph",text:"\n"===a[1].charAt(a[1].length-1)?a[1].slice(0,-1):a[1]});else if(a=this.rules.text.exec(e))e=e.substring(a[0].length),this.tokens.push({type:"text",text:a[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var d={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:n,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:n,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};d._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,d._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,d.link=s(d.link)("inside",d._inside)("href",d._href)(),d.reflink=s(d.reflink)("inside",d._inside)(),d.normal=c({},d),d.pedantic=c({},d.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),d.gfm=c({},d.normal,{escape:s(d.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:s(d.text)("]|","~]|")("|","|https?://|")()}),d.breaks=c({},d.gfm,{br:s(d.br)("{2,}","*")(),text:s(d.gfm.text)("{2,}","*")()}),t.rules=d,t.output=function(e,o,i){var r=new t(o,i);return r.output(e)},t.prototype.output=function(e){for(var t,o,i,a,s="";e;)if(a=this.rules.escape.exec(e))e=e.substring(a[0].length),s+=a[1];else if(a=this.rules.autolink.exec(e))e=e.substring(a[0].length),"@"===a[2]?(o=":"===a[1].charAt(6)?this.mangle(a[1].substring(7)):this.mangle(a[1]),i=this.mangle("mailto:")+o):(o=r(a[1]),i=o),s+=this.renderer.link(i,null,o);else if(this.inLink||!(a=this.rules.url.exec(e))){if(a=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(a[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(a[0])&&(this.inLink=!1),e=e.substring(a[0].length),s+=this.options.sanitize?r(a[0]):a[0];else if(a=this.rules.link.exec(e))e=e.substring(a[0].length),this.inLink=!0,s+=this.outputLink(a,{href:a[2],title:a[3]}),this.inLink=!1;else if((a=this.rules.reflink.exec(e))||(a=this.rules.nolink.exec(e))){if(e=e.substring(a[0].length),t=(a[2]||a[1]).replace(/\s+/g," "),t=this.links[t.toLowerCase()],!t||!t.href){s+=a[0].charAt(0),e=a[0].substring(1)+e;continue}this.inLink=!0,s+=this.outputLink(a,t),this.inLink=!1}else if(a=this.rules.strong.exec(e))e=e.substring(a[0].length),s+=this.renderer.strong(this.output(a[2]||a[1]));else if(a=this.rules.em.exec(e))e=e.substring(a[0].length),s+=this.renderer.em(this.output(a[2]||a[1]));else if(a=this.rules.code.exec(e))e=e.substring(a[0].length),s+=this.renderer.codespan(r(a[2],!0));else if(a=this.rules.br.exec(e))e=e.substring(a[0].length),s+=this.renderer.br();else if(a=this.rules.del.exec(e))e=e.substring(a[0].length),s+=this.renderer.del(this.output(a[1]));else if(a=this.rules.text.exec(e))e=e.substring(a[0].length),s+=r(this.smartypants(a[0]));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}else e=e.substring(a[0].length),o=r(a[1]),i=o,s+=this.renderer.link(i,null,o);return s},t.prototype.outputLink=function(e,t){var o=r(t.href),i=t.title?r(t.title):null;return"!"!==e[0].charAt(0)?this.renderer.link(o,i,this.output(e[1])):this.renderer.image(o,i,r(e[1]))},t.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/--/g,"—").replace(/(^|[-\u2014\/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014\/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):e},t.prototype.mangle=function(e){for(var t,o="",i=e.length,r=0;r<i;r++)t=e.charCodeAt(r),Math.random()>.5&&(t="x"+t.toString(16)),o+="&#"+t+";";return o},o.prototype.code=function(e,t,o){if(this.options.highlight){var i=this.options.highlight(e,t);null!=i&&i!==e&&(o=!0,e=i)}return t?'<pre><code class="'+this.options.langPrefix+r(t,!0)+'">'+(o?e:r(e,!0))+"\n</code></pre>\n":"<pre><code>"+(o?e:r(e,!0))+"\n</code></pre>"},o.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},o.prototype.html=function(e){return e},o.prototype.heading=function(e,t,o){return"<h"+t+' id="'+this.options.headerPrefix+o.toLowerCase().replace(/[^\w]+/g,"-")+'">'+e+"</h"+t+">\n"},o.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},o.prototype.list=function(e,t){var o=t?"ol":"ul";return"<"+o+">\n"+e+"</"+o+">\n"},o.prototype.listitem=function(e){return"<li>"+e+"</li>\n"},o.prototype.paragraph=function(e){return"<p>"+e+"</p>\n"},o.prototype.table=function(e,t){return"<table>\n<thead>\n"+e+"</thead>\n<tbody>\n"+t+"</tbody>\n</table>\n"},o.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},o.prototype.tablecell=function(e,t){var o=t.header?"th":"td",i=t.align?"<"+o+' style="text-align:'+t.align+'">':"<"+o+">";return i+e+"</"+o+">\n"},o.prototype.strong=function(e){return"<strong>"+e+"</strong>"},o.prototype.em=function(e){return"<em>"+e+"</em>"},o.prototype.codespan=function(e){return"<code>"+e+"</code>"},o.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},o.prototype.del=function(e){return"<del>"+e+"</del>"},o.prototype.link=function(e,t,o){if(this.options.sanitize){try{var i=decodeURIComponent(a(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(r){return""}if(0===i.indexOf("javascript:"))return""}var s='<a href="'+e+'"';return t&&(s+=' title="'+t+'"'),s+=">"+o+"</a>"},o.prototype.image=function(e,t,o){var i='<img src="'+e+'" alt="'+o+'"';return t&&(i+=' title="'+t+'"'),i+=this.options.xhtml?"/>":">"},i.parse=function(e,t,o){var r=new i(t,o);return r.parse(e)},i.prototype.parse=function(e){this.inline=new t(e.links,this.options,this.renderer),this.tokens=e.reverse();for(var o="";this.next();)o+=this.tok();return o},i.prototype.next=function(){return this.token=this.tokens.pop()},i.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},i.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},i.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,this.token.text);case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var e,t,o,i,r,a="",s="";for(o="",e=0;e<this.token.header.length;e++)i={header:!0,align:this.token.align[e]},o+=this.renderer.tablecell(this.inline.output(this.token.header[e]),{header:!0,align:this.token.align[e]});for(a+=this.renderer.tablerow(o),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],o="",r=0;r<t.length;r++)o+=this.renderer.tablecell(this.inline.output(t[r]),{header:!1,align:this.token.align[r]});s+=this.renderer.tablerow(o)}return this.renderer.table(a,s);case"blockquote_start":for(var s="";"blockquote_end"!==this.next().type;)s+=this.tok();return this.renderer.blockquote(s);case"list_start":for(var s="",n=this.token.ordered;"list_end"!==this.next().type;)s+=this.tok();return this.renderer.list(s,n);case"list_item_start":for(var s="";"list_item_end"!==this.next().type;)s+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(s);case"loose_item_start":for(var s="";"list_item_end"!==this.next().type;)s+=this.tok();return this.renderer.listitem(s);case"html":var c=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(c);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}},n.exec=n,l.options=l.setOptions=function(e){return c(l.defaults,e),l},l.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new o,xhtml:!1},l.Parser=i,l.parser=i.parse,l.Renderer=o,l.Lexer=e,l.lexer=e.lex,l.InlineLexer=t,l.inlineLexer=t.output,l.parse=l,"undefined"!=typeof module&&"object"==typeof exports?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):this.marked=l}.call(function(){return this||("undefined"!=typeof window?window:global)}()),function(e,t,o){"use strict";var i={timeout:6e3,timeArray:[],slideName:".slides",slideBtnsName:".buttons",maskName:".mask",isLoopStop:!1},r=function(){var e=navigator.userAgent.toLowerCase(),t={isIE:/msie/.test(e),isHackIE:/msie [7-8]/.test(e),isWebkit:/webkit/.test(e),isWindows:/windows/.test(e),isMac:/mac/.test(e)};return t.isNormalIE=t.isIE&&!t.isIE6&&!t.isHackIE,t}();jQuery.fn.extend({carousel:function(e){var o=t(this),a=t.extend({},i,e);a.wrapper=o.selector;var s,n,c=a.timeout,l=1,u=!1,d=o.find(a.slideName),p=o.find(a.maskName);if(a.slideBtnsName){for(var f=t('<ul class="'+a.slideBtnsName.substring(1,a.slideBtnsName.length)+'"></ul>'),m="",g=0,h=d.children("li").length;g<h;g++)m+=g?"<li></li>":'<li class="active"></li>';f.html(m),o.append(f)}else var f=o.find(a.slideBtnsName);setTimeout(function(){f.addClass("banner-3d-buttons-show")},50),a.timeArray.length>0&&(n=a.timeArray);var v=function(e){l="undefined"!=typeof e?e:l,l>=d.children("li").length&&(l=0);var t=c;n&&n.length>0&&n[l]&&(t=n[l]),d.children("li").eq(l).addClass("active").siblings("li").removeClass("active"),f.length>0&&f.find("li").eq(l).addClass("active").siblings("li").removeClass("active"),p.length&&p.find("a").eq(l).addClass("active").siblings("a").removeClass("active"),l++,u&&(s=setTimeout(v,t))},b=function(){u=!1,clearTimeout(s)},k=function(){u=!0;var e=c;n&&n.length>0&&n[l]&&(e=n[l]),s=setTimeout(v,e)},y=function(e){setTimeout(function(){v(e)},100)},$=function(){r.isIE?(d.toggleClass("switch",!1),setTimeout(function(){d.toggleClass("switch",!0)},0)):d.toggleClass("switch",!1).show().delay(0).toggleClass("switch",!0)},_=function(){a.isLoopStop&&t(document).on("mouseenter",a.wrapper,function(e){b()}).on("mouseleave",a.wrapper,function(e){k()})};return _(),t(document).on("click",a.wrapper+" "+a.slideBtnsName+" li",function(e){clearTimeout(s);var o=t(this).index();setTimeout(function(){v(o)},100)}),{doCarousel:k,exitCarousel:b,loopUpdate:y,toggleSwitchClass:$}}})}(window,jQuery),function(e,t,o){"use strict";function i(){return!t("html").hasClass("csstransforms3d")}var r={timeout:3e3,wrapper:"",item:"",btn:"",videoTimeArray:[],beforeMove:null},a=!!document.createElement("video").canPlayType,s="ipad"==navigator.userAgent.toLowerCase().match(/ipad/i),n=function(){var o=e.devicePixelRatio||1;return t(e).width()<=736&&(screen.width<=736||o>=2)};t.fn.myCarousel=function(e){var o,c,l,u,d=t(this),p=t.extend({},r,e),f=(p.timeout,d),m=f.find(p.btn),g=f.find(p.item),h=f.find(p.item2),v=0,b=p.timeout,k=!1,y=!1;m.each(function(e,o){t(this).attr("data-carousel-index",e)}),p.videoTimeArray.length>0&&(c=s||!a||i()?[]:p.videoTimeArray),!n()&&c&&c.length>0&&(l=g.eq(0).parent().find("video"),u=h.eq(0).parent().find("video")),l&&l.length>0&&t.each(l,function(e,o){l[e].oncanplay=function(o){t(this).attr("data-canplay",!0),t(this).get(0).play(),l[e].oncanplay=null}}),u&&u.length>0&&t.each(u,function(e,o){u[e].oncanplay=function(o){t(this).attr("data-canplay",!0),t(this).get(0).play(),u[e].oncanplay=null}});var $=function(e){v="undefined"!=typeof e?e:v;var i=b;if(v==m.length&&(v=0),m.eq(v).addClass("active").siblings().removeClass("active"),g.eq(v).addClass("active").siblings().removeClass("active"),h.eq(v).addClass("active").siblings().removeClass("active"),l&&l.length>0&&!t(this).attr("data-canplay")){i=c&&c.length>0&&c[v]?c[v]:b;var r=v;setTimeout(function(){l.eq(r)[0].pause()},i),l.eq(v).addClass("active"),l.eq(v)[0].currentTime=0,l.eq(r)[0].play(),u&&u.length>0&&(u.eq(v).addClass("active"),u.eq(v)[0].currentTime=0)}"function"==typeof p.beforeMove&&p.beforeMove(v),o=setTimeout($,c&&c.length>0?i+2e3:b),v+=1};l&&l.length>0?u&&u.length>0?(l[0].oncanplaythrough=function(){k=!0,k&&y&&(k=!1,y=!1,$(0)),l[0].oncanplaythrough=null},u[0].oncanplaythrough=function(){y=!0,k&&y&&(k=!1,y=!1,$(0)),u[0].oncanplaythrough=null}):l[0].oncanplaythrough=function(){$(0),l[0].oncanplaythrough=null}:setTimeout(function(){$(v)},500),m.on("click",function(e){clearTimeout(o);var i;return i=parseInt(t(this).attr("data-carousel-index")),setTimeout(function(){$(i)},100),!1})}}(window,jQuery),$.fn.scrollUnique=function(){return $(this).each(function(){var e="mousewheel";void 0!==document.mozHidden&&(e="DOMMouseScroll"),$(this).on(e,function(e){var t=this.scrollTop,o=this.scrollHeight,i=this.clientHeight,r=e.originalEvent.wheelDelta?e.originalEvent.wheelDelta:-(e.originalEvent.detail||0);(r>0&&t<=r||r<0&&o-i-t<=-1*r)&&(this.scrollTop=r>0?0:o,e.preventDefault())})})},appsDirectives.directive("osThird",["$rootScope","$document","$filter","$timeout",function(e,t,o,i){var r=function(){var e=window.devicePixelRatio||1;return $(window).width()<=736&&(screen.width<=736||e>=2)};return{restrict:"EA",templateUrl:function(){var e="../../view/template-html/os-3.html";return r()&&(e="../../view/template-html/os-3-mobile.html"),e},scope:{options:"@options"},link:function(e,t,o,i){function a(){return $(".ie8,.ie9").length>0}function s(){I=setInterval(function(){var e=$(".handshaker .loop-dot a.active"),t=e.next("a");t.length>0?t.click():$(".handshaker .loop-dot a").eq(0).click()},8e3)}function n(e,t,o){var i=$(e).next(t);i.length>0?($(e).removeClass("active"),i.addClass("active")):($(o).removeClass("active"),$(o).eq(0).addClass("active"))}function c(e){if($(window).width()>1440)if(1==b)var t=e+" .en-video-view .video-large",o=$(t)[0];else var t=e+" .cn-video-view .video-large",o=$(t)[0];else if(1==b)var t=e+" .en-video-view .video-medium",o=$(t)[0];else var t=e+" .cn-video-view .video-medium",o=$(t)[0];o.play()}a()||setTimeout(function(){$(".qr-code-view .img-view").empty(),$(".qr-code-view .img-view").qrcode({render:"canvas",width:140,height:140,text:location.href})},300);var l,u,d,p,f,m,g,h,v,b=$("html.en").length;r()||setTimeout(function(){l=$("#onestep").offset().top,v=$("#blastParticiple").offset().top,u=$("#cloudMusic").offset().top,d=$("#record").offset().top,p=$("#handShaker").offset().top,f=$("#functionService").offset().top,m=$("#functionIwork").offset().top,g=$("#functionContact").offset().top,h=$("#functionMessage").offset().top},200);var k="",y=window.location.hash.match(/section=([a-z]{1,20})/);y&&(k=y[1]),setTimeout(function(){"onestep"==k&&$("body,html").scrollTop(l)},500);var _=!0,C=!0,w=!0,S=!0,I=0;if($(".handshaker .buttons a").click(function(){var e=$(this).index();$(".handshaker .buttons a").removeClass("active"),$(this).addClass("active"),$(".third-type .handshaker .img-view").removeClass("active"),$(".third-type .handshaker .img-view").eq(e).addClass("active"),$(".third-type .handshaker .content p").removeClass("active"),$(".third-type .handshaker .content p").eq(e).addClass("active"),$(".handshaker .loop-dot a").eq(0).click()}),$(".handshaker .loop-dot a").click(function(){clearInterval(I),s();var e=$(this).index();$(".handshaker .loop-dot a").removeClass("active"),$(this).addClass("active"),$(".handshaker .img-view.active .pc-view figure").removeClass("active"),$(".handshaker .img-view.active .pc-view figure").eq(e).addClass("active"),$(".handshaker .img-view.active .phone-view figure").removeClass("active"),$(".handshaker .img-view.active .phone-view figure").eq(e).addClass("active")}),$("#onestep .item1 .replay").click(function(){c("#onestep .item1")}),$("#onestep .item2 .replay").click(function(){c("#onestep .item2")}),$("#onestep .item3 .replay").click(function(){c("#onestep .item3")}),$("#blastParticiple .item1 .replay").click(function(){c("#blastParticiple .item1")}),$("#blastParticiple .item2 .replay").click(function(){c("#blastParticiple .item2")}),$("#blastParticiple .item3 .replay").click(function(){c("#blastParticiple .item3")}),!r()){var M=!1,x=!1;$(document).scroll(function(){var e=$(".third-type").length;if(1==e&&!a()){var t=$(window).scrollTop();if(l<=t&&t<v-50){var o,i,r;$(window).width()>1440?1==b?(o=$("#onestep .item1 .en-video-view .video-large")[0],i=$("#onestep .item2 .en-video-view .video-large")[0],r=$("#onestep .item3 .en-video-view .video-large")[0]):(o=$("#onestep .item1 .cn-video-view .video-large")[0],i=$("#onestep .item2 .cn-video-view .video-large")[0],r=$("#onestep .item3 .cn-video-view .video-large")[0]):1==b?(o=$("#onestep .item1 .en-video-view .video-medium")[0],i=$("#onestep .item2 .en-video-view .video-medium")[0],r=$("#onestep .item3 .en-video-view .video-medium")[0]):(o=$("#onestep .item1 .cn-video-view .video-medium")[0],i=$("#onestep .item2 .cn-video-view .video-medium")[0],r=$("#onestep .item3 .cn-video-view .video-medium")[0]),o.loop=!1,i.loop=!1,r.loop=!1,M||(o.play(),setTimeout(function(){$("#onestep .item1 .replay").addClass("active")},14e3),setTimeout(function(){i.play(),$("#onestep .item2 img").css({"z-index":"2"})},16e3),setTimeout(function(){$("#onestep .item2 .replay").addClass("active")},21e3),setTimeout(function(){r.play(),$("#onestep .item3 img").css({"z-index":"2"})},23e3),M=!0,setTimeout(function(){$("#onestep .item3 .replay").addClass("active")},3e4))}if(v<=t&&t<u){var o,i,r;$(window).width()>1440?1==b?(o=$("#blastParticiple .item1 .en-video-view .video-large")[0],i=$("#blastParticiple .item2 .en-video-view .video-large")[0],r=$("#blastParticiple .item3 .en-video-view .video-large")[0]):(o=$("#blastParticiple .item1 .cn-video-view .video-large")[0],i=$("#blastParticiple .item2 .cn-video-view .video-large")[0],r=$("#blastParticiple .item3 .cn-video-view .video-large")[0]):1==b?(o=$("#blastParticiple .item1 .en-video-view .video-medium")[0],i=$("#blastParticiple .item2 .en-video-view .video-medium")[0],r=$("#blastParticiple .item3 .en-video-view .video-medium")[0]):(o=$("#blastParticiple .item1 .cn-video-view .video-medium")[0],i=$("#blastParticiple .item2 .cn-video-view .video-medium")[0],r=$("#blastParticiple .item3 .cn-video-view .video-medium")[0]),o.loop=!1,i.loop=!1,r.loop=!1,x||(o.play(),setTimeout(function(){$("#blastParticiple .item1 .replay").addClass("active")},15e3),setTimeout(function(){i.play(),$("#blastParticiple .item2 img").css({"z-index":"2"})},17e3),setTimeout(function(){$("#blastParticiple .item2 .replay").addClass("active")},25e3),setTimeout(function(){r.play(),$("#blastParticiple .item3 img").css({"z-index":"2"})},27e3),setTimeout(function(){$("#blastParticiple .item3 .replay").addClass("active")},33e3),x=!0)}u<=t&&t<d&&_&&(_=!1,setInterval(function(){n(".third-type .cloud-music .container .album-phone figure.active","figure",".third-type .cloud-music .container .album-phone figure")},8e3)),p<=t&&t<f&&C&&(C=!1,s()),f<=t&&t<m&&w&&(w=!1,setInterval(function(){n(".third-type .function-item .item-file .m1-view figure.active","figure",".third-type .function-item .item-file .m1-view figure")},8e3)),m<=t&&t<g&&S&&(S=!1,setInterval(function(){n(".third-type .function-item .item-contact .m1-view figure.active","figure",".third-type .function-item .item-contact .m1-view figure")},8e3))}})}$(".screen-recording .buttons a").click(function(){var e=$(this).index();$(".screen-recording .buttons a").removeClass("active"),$(this).addClass("active"),$(".third-type .screen-recording .left-hand figure").removeClass("active"),$(".third-type .screen-recording .left-hand figure").eq(e).addClass("active")}),$(".item-setting ul li").click(function(){var e=$(this).index();$(".item-setting ul li").removeClass("active"),$(this).addClass("active"),$(".item-setting .need-change figure").removeClass("active"),$(".item-setting .need-change figure").eq(e).addClass("active"),$(".item-setting p").removeClass("active"),$(".item-setting p").eq(e).addClass("active")}),$(".item-message ul li").click(function(){var e=$(this).index();$(".item-message ul li").removeClass("active"),$(this).addClass("active"),$(".item-message .need-change figure").removeClass("active"),$(".item-message .need-change figure").eq(e).addClass("active"),$(".item-message p").removeClass("active"),$(".item-message p").eq(e).addClass("active")});var T,P="",D="#videoSubfield",A=!1;$(".video-content .video-1").click(function(e){A=!0,P=$("#videoSubfield.video-box").html(),D="#videoSubfield",$(".video-layer").show(),$("#videoSubField").show(),$("#videoBlastParticiple").hide(),$("#videoVoice").hide(),$("body").addClass("no-scroll");var t=$("#videoSubfield.video-box .video-js").attr("id"),o=$("#"+t);o.attr({width:"848px",height:"478px"}),T=videojs(t),T.currentTime(0),T.play()}),$(".video-content .video-2").click(function(e){A=!0,P=$("#videoBlastParticiple.video-box").html(),D="#videoBlastParticiple",$(".video-layer").show(),$("#videoSubField").hide(),$("#videoVoice").hide(),$("#videoBlastParticiple").show(),$("body").addClass("no-scroll");var t=$("#videoBlastParticiple.video-box .video-js").attr("id"),o=$("#"+t);o.attr({width:"848px",height:"478px"}),T=videojs(t),T.currentTime(0),T.play()}),$(".video-content .video-3").click(function(e){A=!0,P=$("#videoVoice.video-box").html(),D="#videoVoice",$(".video-layer").show(),$("#videoSubField").hide(),$("#videoBlastParticiple").hide(),$("#videoVoice").show(),$("body").addClass("no-scroll");var t=$("#videoVoice.video-box .video-js").attr("id"),o=$("#"+t);o.attr({width:"848px",height:"478px"}),T=videojs(t),T.currentTime(0),T.play()}),$("a.close-video").click(function(){
A=!1,$(".video-layer").hide(),$("body").removeClass("no-scroll"),0===$(".ie8").length&&(T.currentTime(0),T.pause()),T.dispose(),$(D+".video-box").html(P)}),$("body").keydown(function(e){var t=e.keyCode;if(27==t){if(!A)return;$("a.close-video").click()}})}}}]).directive("specsParam",["$rootScope","$document","$filter","$timeout",function(e,t,o,i){return{restrict:"A",templateUrl:function(){var e="../../view/template-html/specs-param.html";return e}}}]),appsControllers.controller("MainCtrl",["$scope","$rootScope","$http","$timeout","$location","$window","Account","Message","BaseInfo","Utils","StoreConfig","AddCartAnimation","CartReBuildService",function(e,t,o,i,r,a,s,n,c,l,u,d,p){var f={threshold:"购物车已达最大购买限制，请删除过期商品"};t.cartMenu={},t.cartOrder={},$(window).on("message",function(e){n.handler(e)}),t.$on("isEditCart",function(e,o){t.cartOrder.isEditCart=o.status,p.reverseState(t.cartOrder.isEditCart)}),t.$on("cart",function(e,o){var i=o.name,r=o.target,a=o.sku,s=o.num||1,n=o.isCover||!1,c=o.batchType,u=o.attach,d=o.isMobile,m=o.callback;if(i)switch(i){case"sync":p.fetch().then(function(e){p.bind(e.data),l.matchModules("shop","cart")&&t.cartOrder.tips&&l.openDialog({message:t.cartOrder.tips})});break;case"add":p.add(a,s,n,r).then(function(e){p.bind(e.data,r),e.bomb?l.openDialog({message:f.threshold}):m&&m()},function(e){l.openDialog({message:e})});break;case"singleDel":p.singleDel(a,u,d).then(function(e){p.bind(e.data),e.bomb?l.openDialog({message:f.threshold}):m&&m()});break;case"batchedDel":p.batchedDel(c).then(function(e){p.bind(e.data),e.bomb&&l.openDialog({message:f.threshold})});break;case"buy":p.buy();break;case"empty":p.clean(),m&&m()}}),c.update(),e.login=function(){c.update().then(function(){t.isLoggedIn=!0},function(){s.login()})},e.logout=function(){s.logout()},e.changeLangCookies=l.changeLangCookies,t.isMobile||($("body").toggleClass("browser-windows",u.config.isWindows),$("body").toggleClass("browser-webkit",u.config.isWebkit)),e.mainConfig=u}]),appsControllers.controller("CategoryCtrl",["$http","$rootScope","$scope","$timeout","$filter","Utils","TitleBar","$location","goodsList","CategoryService","displayType","StorageService","PagingService","StoreConfig","Config","GoodsService","AddCartAnimation","timestamp",function(e,t,o,i,r,a,s,n,c,l,u,d,p,f,m,g,h,v){var b=null,k=null;t.timestamp=v,o.getParams=function(){o.categoryID=n.search().id,o.sortType=n.search().sort||"sort",o.page=n.search().page||1,t.currentPage=o.categoryID,o.curCategory={title:"全部商品"};var e=_.findWhere(t.subMenuList,{id:parseInt(o.categoryID,10)})||null;e&&e.title&&(o.curCategory=e,e=null),a.isMobile()?s.setOptions({title:o.curCategory.title}):a.setTitle(o.curCategory.title,"Smartisan")},o.getParams(),o.displayType=u,o.$on("$locationChangeStart",function(e,t,i){var r=!!t&&t.match(/\/category\?id=(\d+)/)||"";r&&r[1]&&(o.getParams(),o.pcRender())}),o.giftInfo={},o.goodsList=c.spu,o.maxPageCount=o.goodsList.page_count,o.isAnimate=f.csstransitions,o.getSpecialTshirtTag=function(){angular.forEach(o.goodsList.list,function(e,t){o.timestamp>f.discount618StartTime&&o.timestamp<f.discount618EndTime&&e.id&&_.indexOf(f.discount618Spus,e.id.toString())>=0&&(e.showSpecialTag=!0)})},o.getSpecialTshirtTag(),o.gortSort=function(e,t){t=t||1,"price"==e&&(e="price_low","price_low"==o.sortType&&(e="price_high")),n.search("sort",e),n.search("page",t)};var y=function(e,t,r){for(var a,s={},n={},c=0,a=o.goodsList.list.length;c<a;++c)if(o.goodsList.list[c].id==e){s=o.goodsList.list[c];break}angular.forEach(s.sku,function(e){e.sku_id==t&&(n=e)}),i(function(){s.current.promos={},n.give?1==n.give.promo_type&&(s.current.promos={promo_tag:n.give.promo_tag,promo_type:n.give.promo_type,promo_title:n.give.promo_title}):n.discount?5==n.discount.promo_type&&(s.current.promos={promo_tag:n.discount.promo_tag,promo_type:n.discount.promo_type,promo_title:n.discount.promo_title,discountPrice:n.discount.discountPrice,hasDiscount:n.discount.hasDiscount}):n.is_package&&(s.current.isPackage=!0),angular.extend(s.current,{image:n.image,in_stock:n.in_stock,limit_num:n.limit_num,sale_status:n.sale_status,targetUrl:n.targetUrl,price:n.price,sku_id:n.sku_id,active_index:r})},20)};o.checkStockNums=function(e){var t,i=$(e.currentTarget),r=[],a=i.attr("data-spu"),s=i.find(".colors-list li"),n="",c={};n=s.find(".active").length?s.find(".active").parent().attr("data-sku"):s.attr("data-sku"),angular.forEach(s,function(e){r.push($(e).attr("data-sku"))});for(var l=0,t=o.goodsList.list.length;l<t;++l)if(o.goodsList.list[l].id==a){c=o.goodsList.list[l],o.spuInfo=c;break}c.sku[r[0]]&&void 0===c.sku[r[0]].in_stock&&g.getSkuListWithStock(r).then(function(e){var t=e.list;t.length>0&&(angular.forEach(t,function(e){c.sku[e.id]&&(c.sku[e.id].in_stock=e.in_stock,c.sku[e.id].sale_status=e.sale_status,c.sku[e.id].limit_num=e.stock?e.stock:e.shop_info.limit_num)}),y(a,n))})},o.switchSku=function(e,t,o){b=i(function(){var r,a=$(o.currentTarget);k&&i.cancel(k),$(".item-blue-btn").show(),$(".item-green-btn").removeClass("active"),a.siblings().find("a").removeClass(),a.find("a").addClass("active"),r=a.attr("data-index"),y(e,t,r)},150)},o.cancelSwitchSku=function(){i.cancel(b)},o.pcRender=function(){l.getSpuListWithPromotion(o.categoryID,o.page,o.sortType).then(function(e){return o.page<1||e.page_count<o.page?(location.replace("http://www.smartisan.com/#/error/404"),!1):(o.goodsList=e.spu,o.getSpecialTshirtTag(),o.isLoading=!1,$("html,body").scrollTop(0),void(t.isMobile&&o.bindLoading()))})},o.addCart=function(e){var a=$(e.currentTarget);h.getIsRunnng()||t.$emit("cart",{name:"add",sku:o.spuInfo.current.sku_id,target:"menu",callback:function(){h.init(a,r("smartImg")(o.spuInfo.current.image,"60",o.spuInfo.current.isOSS,"w_60,Q_90")),h.start(),i(function(){h.pop()},700)}})},o.toggleDisplayOption=function(){o.displayType=3-o.displayType,d.set("categoryDisplay",o.displayType)},o.scrollFuc=function(){if(!o.isLoading){var e=$(window).height(),t=$(window).scrollTop(),i=$(document).height(),r=e+t-(i-1e3);r>=0&&o.appendGoodsByPage()}},o.isLoading=!1,o.bindLoading=function(){o.maxPageCount<o.page||($(window).off("scroll",o.scrollFuc),$(window).scroll(o.scrollFuc))},o.bindLoading(),o.appendGoodsByPage=function(){o.isLoading=!0,o.page<o.maxPageCount&&(o.page++,l.getSpuListWithPromotion(o.categoryID,o.page,o.sortType).then(function(e){return o.maxPageCount=e.spu.page_count,o.canLoading=o.maxPageCount>o.page,o.page<1||e.page_count<o.page?(location.replace("http://www.smartisan.com/#/error/404"),!1):(o.goodsList.list=o.goodsList.list.concat(e.spu.list),o.isLoading=!1,void o.getSpecialTshirtTag())}))}}]),appsControllers.controller("ItemCtrl",["$rootScope","$scope","$animate","$timeout","$q","$anchorScroll","$filter","Utils","TitleBar","StoreConfig","Config","$location","CategoryService","$routeParams","DialogService","OrderService","PullPlugin","AddCartAnimation","BaseInfo","GoodsService","timestamp","promotions",function(e,t,o,i,r,a,s,n,c,l,u,d,p,f,m,g,h,v,b,k,y,C){function w(e){for(var t=0,o=0;o<e.length;o++){var i=e.charCodeAt(o);i>=1&&i<=126||65376<=i&&i<=65439?t++:t+=2}return t}var S=u.getDPR(),I=!0;t.promotionInfo=C,t.sku=null,e.currentPage=null,e.timestamp=y,t.thumbnailIndex=0,t.panelFixed=!1,t.$on("ngRepeatFinished",function(){i(function(){e.pageLoading=!1,$(".m-page-item").addClass("m-page-item-show-all"),$(".m-page-item-detail").css({display:"block"}),d.hash(d.$$search.anchor).replace().search("anchor",null),a()},50)});var M=null;t.postageTerm=l.postageTerm,t.cartConfig={el:$(".store-content"),useData:!1,canDelete:!1,customClass:"item-num",refresh:function(e){(M=e)()}};var x=function(o){var i="",r=t.sku.shop_info.tpl_content[o].images,a={isOSS:!1,clipPieces:0,clipHeight:0,url:[]};e.isMobile?r.ali_mobile&&r.ali_mobile.url&&r.ali_mobile.pieces_num&&r.ali_mobile.piece_height&&(a.clipPieces=r.ali_mobile.pieces_num,a.clipHeight=r.ali_mobile.piece_height,i=r.ali_mobile.url):r.ali&&r.ali.url&&r.ali.pieces_num&&r.ali.piece_height&&(a.clipPieces=r.ali.pieces_num,a.clipHeight=r.ali.piece_height,i=r.ali.url);for(var s=0;s<a.clipPieces;++s)a.url.push(i+"#i_"+s);return 0==a.url.length?a.url=r[S]:a.isOSS=!0,a};t.render=function(){if(t.is618=!1,t.spuId=t.spuId||f.id||0,t.skuId=t.skuId||d.$$search.id||0,t.spuId&&t.skuId){e.timestamp>=l.discount618StartTime&&e.timestamp<=l.discount618EndTime&&_.indexOf(l.discount906Skus,t.skuId)>-1&&(t.is618=!0),t.skuId&&t.skuId===t.spuId&&(t.spuId=t.skuId.substring(0,t.skuId.length-2)),$(window).scrollTop()>30&&$("html,body").scrollTop(0);var o=$(".store-content");t.$el=$(".store-content"),p.getSkuDetail(t.skuId).then(function(r){var a,s=!0,u=r.shop_info.tpl_id||"",d={},f="",m=r.sale_status||1,g=1e3,h=r.shop_info.buy_notes;if(d=e.isMobile?{out:"该商品已售罄",off:"该商品已下架","new":"即将开售"}:{out:"已售罄",off:"已下架","new":"即将开售"},t.sku=r,t.sku.shop_info.is_custom=parseInt(t.sku.shop_info.is_custom)||0,t.sku.shop_info.is_custom)f="追加定制";else switch(m){case 2:f=_.indexOf(l.accessoriesOffSale,t.sku.id.toString())>-1?d["new"]:t.sku.shop_info.is_doodle?d["new"]:d.off;break;case 3:g||(f=d.out);break;default:f=d.out}t.sku.statusLabel=f,t.sku.product_info.num||(t.sku.product_info.num=1),w(t.sku.shop_info.title)>36&&(t.sku.titleLong=!0),t.sku.in_stock&&t.sku.stock&&(g=t.sku.stock),C.discount[t.skuId]&&(null!=C.discount[t.skuId].maxNum?(g=C.discount[t.skuId].maxNum,t.sku.stock=C.discount[t.skuId].maxNum):(g=100,t.sku.stock=100)),g=Math.min(g,t.sku.shop_info.limit_num),3==t.sku.sale_status&&(C.discount[t.skuId]||t.sku.in_stock)?t.sku.numberMax=g:t.sku.numberMax=0,_.indexOf(u.split(","),"doodle")>=0?a=x("doodle"):_.indexOf(u.split(","),"base")>=0&&(a=x("base")),t.sku.shop_info.images=t.sku.shop_info.ali_images?t.sku.shop_info.ali_images:t.sku.shop_info.images,t.sku.shop_info.isOSS=!!t.sku.shop_info.ali_images,t.sku.shop_info.tpl_content.list=a.url,t.sku.shop_info.tpl_content.clipHeight=a.clipHeight,t.sku.shop_info.tpl_content.isOSS=a.isOSS,0==t.sku.shop_info.tpl_content.list.length&&(e.pageLoading=!1),angular.isFunction(M)&&i(function(){M()},0),h&&(t.sku.itemTips=h),n.isMobile()?c.setOptions({toggle:"back"}):n.setTitle(t.sku.shop_info.title,"Smartisan");var v=p.getSpecList(t.sku.shop_info.spec_v2,t.sku.sku_list,t.sku.id);$.each(v,function(e,o){t.sku.shop_info.is_doodle&&"颜色"==o.name&&(s=!1)}),s&&(t.specData=v),t.scrollFixedNav(),e.isMobile&&(t.$gallery=o.find(".m-page-item-gallery"),t.$detail=o.find(".m-page-item-detail"),t.$more=o.find(".touch-more")),I=!0},function(e){location.replace("http://www.smartisan.com/#/error/404")})}},t.render(),e.isMobile&&t.$el&&h.bindPull({domWrapper:t.$el,swipeWrapper:t.$el.find(".m-page-item-gallery"),enableUp:!1,enableDown:!0,loadingClass:"swiping",swipeUpCallback:function(){},swipeDownCallback:function(){t.$detail.is(":visible")||(t.$el.addClass("m-page-item-show-all"),t.$detail.fadeIn(),$("html,body").scrollTop(t.$detail.offset().top-95))}}),t.addCart=function(o){var r=$(".store-content"),a=r.find(".cart-tip-diag"),c=$(o.currentTarget);if(c.hasClass("disabled-btn")||c.hasClass("m-disabled-btn"))return!1;var l=parseInt(r.find(".js-select-quantity .num input").val(),10);return t.sku.shop_info.limit_num<l?void n.openDialog({message:"选购的商品已达数量上限，请重新选择"}):void(v.getIsRunnng()||e.$emit("cart",{name:"add",sku:t.sku.id,num:l,target:"menu",callback:function(){n.isMobile()?n.openDialog({message:"已添加至购物车"}):(r.find(".fixed-nav").is(":visible")?(a.removeClass("absolute").addClass("fixed"),a.stop(!0,!1).fadeIn({duration:100})):(v.init(c,s("smartImg")(t.sku.shop_info.images[0],"60",t.sku.shop_info.isOSS,"w_60,Q_90")),v.start()),i(function(){v.pop()},700))}}))},t.goToCheckout=function(o){var i=$(".store-content"),r=(i.find(".cart-tip-diag"),$(o.currentTarget));if(r.hasClass("disabled-btn")||r.hasClass("m-disabled-btn"))return!1;var a=parseInt(i.find(".js-select-quantity .num input").val(),10);if(t.sku.shop_info.limit_num<a)return void m.setContent("dialog",{message:"您购买的产品超出数量上限，请重新选择。",dialogClass:"module-dialog-confirm"}).open("dialog");var s=[],n={goods_infos:[],carts:[],mobileGoods:[],suitGoods:[],isNormal:!0};if(t.sku.product_info.is_package){var c=[];t.sku.product_info.package_goods&&(angular.forEach(t.sku.product_info.package_goods,function(e){c.push(e.goods_code+":"+e.num)}),s.push("0-"+t.sku.id+":"+a+"|"+c.join("|")))}else n.carts.push({id:t.sku.id,num:a}),n.goods_infos.push(t.sku.id+":"+a);n.suitGoods=s.join(","),n.goods_infos=n.goods_infos.join(","),e.isMobile?location.href="http://m.store.smartisan.com/#/checkout?"+MobileService.parseTempOrderParams(n,!0):g.createTempOrder(n).then(function(e){b.update().then(function(t){location.href="http://store.smartisan.com/#/checkout/"+e.id},function(t){location.href="https://account.smartisan.com/#/v2/login?return_url="+encodeURIComponent("http://store.smartisan.com/#/checkout/"+e.id)})})},t.hideCartTipDiag=function(){var e=$(".store-content"),t=e.find(".cart-tip-diag");t.is(":visible")&&t.stop(!0,!1).fadeOut({duration:100})},t.jumpToCart=function(){location.href="#/cart"},t.chooseParams=function(e){var o,i=$(e.currentTarget),r={},a=t.sku.sku_list,s="";if(!(i.hasClass("cur")||i.hasClass("soldout")||i.hasClass("disabled"))&&I){i.toggleClass("cur",!0).siblings().toggleClass("cur",!1),I=!1,o=t.sku.id,a=t.sku.sku_list;var n={key:i.data("name"),val:i.data("value")};r=p.getCurrentSku(a,o),s=p.getUpdateSkuID(a,r,n.key,n.val),s&&t.navigateToSku(s)}},t.navigateToSku=function(e){var o=e.toString(),i=o.substring(0,o.length-2),r=$(window).scrollTop();t.spuId=i,t.skuId=o,t.render(),d.url("/item/"+i+"?id="+o).replace(),$("body,html").animate({scrollTop:r},0,"easeOutQuint")},t.addCustomize=function(){var o=$(".store-content");m.setContent("dialog",{dialogClass:"module-dialog-item-warning",message:'<p class="text-left">这款背壳已经售完，但你仍可以追加定制此背壳。</p><p class="text-left">1. 追加定制的发货周期在 2 周 ~ 3 周;</p><p class="text-left">2. 追加定制的价格会比原价高 20%。</p>'}).open("dialog",function(){var i={carts:[],isDoodle:!0},r=parseInt(o.find(".js-select-quantity .num input").val(),10);i.carts.push({id:t.sku.sku,num:r}),e.isLoggedIn&&g.createTempOrder(i).then(function(e){location.href="http://store.smartisan.com/#checkout/"+e.id}),m.close()})},t.preNextThumbnail=function(o,i){var r=$(".store-content"),a=e.isMobile?r.find(".thumb"):r.find(".thumbnail"),s=a.find("li").length-1,n=i;switch(o){case"pre":n>0?t.activeThumbnail(n-1):t.activeThumbnail(s);break;case"next":n<s?t.activeThumbnail(n+1):t.activeThumbnail(0)}},t.activeThumbnail=function(o){var i=$(".store-content"),r=i.find(".thumb"),a=null;e.isMobile&&(a=r.find("li").eq(o),a&&a.find("img").attr("src",a.find("img").attr("lazy-load"))),t.thumbnailIndex=o},t.scrollFixedNav=function(o){var i=$(".store-content"),r=0,a=[],s=$(".fixed-nav");$(window).scroll(function(o){r=$(this).scrollTop(),e.isMobile?t.$apply(function(){$(".m-page-item-detail").is(":visible")&&(r>$(".m-page-item-gallery").height()+20?t.panelFixed=!0:t.panelFixed=!1)}):(i.find(".item-params-box .anchor-to").each(function(e,t){a[e]=$(t).offset().top-80}),r>a[0]?s.stop(!0,!1).animate({opacity:1},100).show():s.stop(!0,!1).animate({opacity:0},100,function(){s.hide()}))})},t.bindSwipeUp=function(){$(".store-content");if(e.isMobile){var o=$(window).height(),i=$(window).scrollTop(),r=$(document).height(),a=o+i-r;a>=-5&t.$gallery.is(":visible")&&($(window).scrollTop(0),t.$gallery.fadeOut(),t.$detail.fadeIn())}},t.bindSwipeDown=function(){$(".store-content");if(e.isMobile){var o=$(window).scrollTop();0===o&t.$detail.is(":visible")&&($(window).scrollTop(0),t.$detail.fadeOut(),t.$gallery.fadeIn())}},t.touchMore=function(){t.$detail.is(":visible")||(t.$el.addClass("page-item-show-all"),t.$more.hide(),t.$detail.fadeIn(),$("html,body").scrollTop(t.$detail.offset().top-95))}}]),appsControllers.controller("JianguoCtrl",["$timeout","$rootScope","$scope","Utils","$location","pageParams","specMap","StoreConfig","NutsService","MobileGoodsService","curMobile","StorePv","MobileService","giftInfo",function(e,t,o,i,r,a,s,n,c,l,u,d,p,f){o.categoryID=r.search().id,o.sortType=r.search().sort||"sort",o.page=r.search().page||1,i.setTitle("坚果手机","Smartisan"),o.pageParams=a,o.specMap=s,o.curMobile=o.pageParams.curMobile,o.giftInfo=f,o.resetMobile=o.curMobile?{edition:o.curMobile.edition,version:o.curMobile.version,color:o.curMobile.color,capacity:o.curMobile.capacity}:{},o.subTotalObj={total:0,cost:0},o.chooseMobile=function(){var e=c.getNutsParams(o.resetMobile.version,o.resetMobile);o.pageParams.color=e.color,o.pageParams.capacity=e.capacity,o.subTotal()},o.subTotal=function(){var e={};e={edition:o.resetMobile.edition,version:o.resetMobile.version,color:o.resetMobile.color,capacity:o.resetMobile.capacity};var t=_.where(l.mapPhones,e),i={};1==t.length&&o.resetMobile.capacity?i=t[0]:o.resetMobile.color&&o.resetMobile.capacity&&(delete o.resetMobile.color,delete o.resetMobile.capacity),o.curMobile=$.extend(o.resetMobile,i,c.mapStock[i.sku]);var r,a=0|o.curMobile.price;0==a||(r=o.curMobile.oldPrice?o.curMobile.oldPrice+200:a+200),o.subTotalObj={total:a,cost:r}},o.checkRadio=function(e,t,i){var r=$(e.currentTarget);$(e.target);if(!r.hasClass("disabled"))switch(t){case"edition":o.chooseEdition(i);break;case"version":o.chooseVersion(i);break;case"color":o.chooseColor(i);break;case"capacity":o.chooseCapacity(i)}},o.chooseEdition=function(e){var t=$(".store-content"),i={};o.resetMobile.edition=e,o.resetMobile.version?(i.version=o.resetMobile.version,i=o.pageParams.defChooseMobileData[e][i.version]):o.pageParams.defChooseMobileData[e].hasStock&&(i=o.pageParams.defChooseMobileData[e].hasStock),i?o.resetMobile=$.extend({},i):o.resetMobile=$.extend({},{edition:e,version:o.resetMobile.version}),o.imageLoopView.exitCarousel();var r=t.find('.js-loop-item[data-version="'+o.resetMobile.version+'"]'),a=0;r=o.resetMobile.color?r.filter('[data-color="'+o.resetMobile.color+'"]'):r.first(),a=r.index(),o.chooseParametersImage(r.data("color")),o.imageLoopView.loopUpdate(a),o.imageLoopView.toggleSwitchClass(),o.chooseMobile()},o.chooseVersion=function(e){var t=$(".store-content"),i={};i=o.resetMobile.edition?o.pageParams.defChooseMobileData[o.resetMobile.edition][e]:o.pageParams.defChooseMobileData.netcom[e]||o.pageParams.defChooseMobileData.all[e],i?o.resetMobile=$.extend({},i):o.resetMobile=$.extend({},{edition:o.resetMobile.edition,version:e}),o.imageLoopView.exitCarousel();var r=t.find('.js-loop-item[data-version="'+e+'"]'),a=0;r=o.resetMobile.color?r.filter('[data-color="'+o.resetMobile.color+'"]'):r.first(),a=r.index(),o.chooseParametersImage(r.data("color")),o.imageLoopView.loopUpdate(a),o.imageLoopView.toggleSwitchClass(),o.chooseMobile()},o.chooseColor=function(e){var t=$(".store-content"),i={};if(e==t.find(".js-loop-item.selected").data("color")&&o.curMobile.color==e)return!1;i=$.extend({},{edition:o.resetMobile.edition,version:o.resetMobile.version,color:e});var r,a=_.where(l.mapPhones,i);a.length&&$.each(a,function(e,t){t.stock&&(r=t.capacity,o.resetMobile.capacity&&(i.capacity=o.resetMobile.capacity))}),!i.capacity&&r&&(i.capacity=r),o.resetMobile=$.extend({},i),o.chooseParametersImage(e);var s=t.find('.js-loop-item[data-color="'+e+'"]'),n=s.index();e!=t.find(".js-loop-item.selected").data("color")&&o.imageLoopView.toggleSwitchClass(),o.imageLoopView.loopUpdate(n),o.chooseMobile()},o.chooseCapacity=function(e){e=e||o.pageParams.curMobile.capacity;var t={};t=$.extend({},{edition:o.curMobile.edition,version:o.curMobile.version,color:o.curMobile.color,capacity:e}),o.resetMobile=$.extend({},t),o.chooseMobile()},o.chooseParametersImage=function(e){var o=$(".store-content");o.find(".js-parameters-size-color").removeClass().addClass("mobile-size js-parameters-size-color "+e),t.isMobile?o.find(".js-parameters-keysPorts").removeClass().addClass("detail product-interface js-parameters-keysPorts "+e):o.find(".js-parameters-keysPorts").removeClass().addClass("spec-parameters-detail spec-parameters-keysPorts js-parameters-keysPorts "+e)};var m=function(){var e=$(".store-content");if(n.isMobile)return!1;var t=e.find(".js-checkout-panel"),o=$(".footer").offset().top,i=$(window).height();t.toggleClass("checkout-fix-panel-follow",i<=o),$(window).on("resize, scroll",function(){var e=$(window).height(),i=$(this).scrollTop();t.toggleClass("checkout-fix-panel-follow",i+e<=o)})};o.LoopView=function(){var e=$(".store-content"),t=function(t){e.find(".js-loop-item").eq(t).addClass("selected").siblings("li").removeClass("selected")},o=function(){n.config.isIE?(e.find(".js-loop-list").toggleClass("switch",!1),setTimeout(function(){e.find(".js-loop-list").toggleClass("switch",!0)},0)):e.find(".js-loop-list").toggleClass("switch",!1).show().delay(0).toggleClass("switch",!0)};return{loopUpdate:t,toggleSwitchClass:o}},o.checkout=function(e){if(o.curMobile){var t=$(e.currentTarget),i=(o.pageParams.activity,_.where(l.mapPhones,{sku:o.curMobile.sku})),a={};t.hasClass("disabled-btn")||1!=i.length||(i=i[0],a={mobile_id:i.sku,pay_type:2,mobileData:i},d.SMpvEvent("坚果","现在购买"),r.url("/insurance?"+p.parseTempOrderParams(a)))}},e(function(){m(),o.imageLoopView=$(".js-nuts-image-panel").carousel({slideName:".js-loop-list",slideBtnsName:"",timeout:3e3}),o.imageLoopView.doCarousel(),o.curMobile&&(o.imageLoopView.exitCarousel(),o.chooseColor(o.curMobile.color),o.chooseCapacity(o.curMobile.capacity),o.chooseMobile())},500)}]),appsControllers.controller("InsuranceCtrl",["$rootScope","$scope","$location","$timeout","StoreConfig","Utils","renderData","$routeParams","StorageService","MobileGoodsService","MobileFittingService","StorePv","MobileService","DialogService","$filter","BaseInfo","Account","TitleBar","promotions",function(e,t,o,i,r,a,s,n,c,l,u,d,p,f,m,g,h,v,b){v.setOptions({aside:" ",toggle:"back",title:"添加保险服务"}),a.setTitle("添加保险服务","Smartisan"),t.pageData=s,t.promotionInfos=b,t.selectionTip={show:!1,shake:!1,fadein:!1},b.discount[t.pageData.currMobile.id]&&b.discount[t.pageData.currMobile.id].discountPrice>0&&(t.pageData.currMobile.reducePrice=t.pageData.currMobile.price-b.discount[t.pageData.currMobile.id].discountPrice,t.pageData.currMobile.discountPrice=b.discount[t.pageData.currMobile.id].discountPrice);var k={bindFixedBar:function(){var e=$(".store-content"),t=e.find(".js-accessories-fixed-panel"),o=e.find(".js-phone-fixed-bar"),i=e.find(".js-phone-fixed-bar-bg"),r=e.find(".js-cart-btn").offset().top-15;$(window).on("scroll",function(){t.toggleClass("hide",$(this).scrollTop()<=r),o.toggleClass("phone-fixed-bar",$(this).scrollTop()>r),i.toggleClass("phone-fixed-bar-bg",$(this).scrollTop()>r)})},reformOrderGoods:function(){var e=[],o=[],i=[],r={sku:t.pageData.currMobile.id.toString(),num:1},a={cartData:[],paramsData:{id:"o"+(new Date).getTime(),mobileGoods:[t.pageData.currMobile.id.toString()]}};return angular.forEach(t.pageData.insurances,function(t){1==t.checked&&(e.push(t.sku),a.paramsData.mobileGoods.push(t.sku))}),e.length>0&&(r.warranty=e.join(":")),a.paramsData.mobileGoods.push(1),a.paramsData.mobileGoods=a.paramsData.mobileGoods.join(":"),a.cartData.push(r),angular.forEach(t.pageData.accessories,function(e,t){a.cartData.push({sku:t,num:e.num}),o.push(t+":"+e.num),i.push(t)}),o.length>0&&(a.paramsData.goodsInfo=o.join(","),a.paramsData.relation_goods=r.sku+"|"+i.join(":")),t.pageData.cdKey&&(a.paramsData.cdKey=t.pageData.cdKey,a.paramsData.discountAmount=t.pageData.discountAmount),a},removeTempOrderCache:function(e){var t=c.filter("^o"),o=new Date;o.setTime(o.getTime()-1),angular.forEach(t,function(e,t){c.remove(t,{domain:".smartisan.com",expires:o})}),"function"==typeof e&&e()},orderCheckout:function(t){var o=e.isMobile?"http://m.store.smartisan.com/#/checkout?":"http://store.smartisan.com/#/checkout/";if(e.isMobile){var i=r.formatJSONToHash({id:t.id,mg:t.mobileGoods,g:t.goodsInfo,r:t.relation_goods,c:t.cdKey,d:t.discountAmount});e.isLoggedIn?location.href=o+i:h.login(o+i)}else this.removeTempOrderCache(function(){c.set(t.id,{id:t.id,mobileGoods:t.mobileGoods,goods_infos:t.goodsInfo,relation_goods:t.relation_goods,cdkey_code:t.cdKey,discount_amount:t.discountAmount},{useCookie:!0,domain:".smartisan.com"})}),e.isLoggedIn?location.href=o+t.id:h.login(o+t.id)}};t.chooseInsurance=function(e,o){if(e.checked!=o)if(1==o)e.checked=o,t.pageData.insurancesNum+=1,t.pageData.totalPrice+=e.price;else{var i=0,r=e.checked;e.checked=o;for(var a=0;a<t.pageData.insurances.length;++a)if(1==t.pageData.insurances[a].checked){i++;break}t.pageData.insurancesNum=i,r!=-1&&(t.pageData.totalPrice-=e.price)}},t.removeInsurance=function(e){for(var o=0;o<t.pageData.insurances.length;++o)if(t.pageData.insurances[o].sku==e){t.pageData.insurances[o].checked=0,t.pageData.totalPrice-=t.pageData.insurances[o].price,t.pageData.insurancesNum-=1;break}},t.toggleHeader=function(e){var t=$(e.currentTarget),o=t.parent(),i=t.siblings("ul");o.hasClass("open")?i.stop().animate({maxHeight:0,opacity:0,padding:0},{duration:300,easing:"easeOutQuart"}):i.stop().animate({maxHeight:"1000px",opacity:1},{duration:300}),o.toggleClass("open")},t.warrantyConfig={normalClass:"red-checkbox",parentEl:"label",callback:function(e,o,i,r){t.chooseInsurance(r,i)}},t.buyMobile=function(r){var s=$(r.currentTarget);if(s.hasClass("disabled-btn"))return!1;var n=_.every(t.pageData.insurances,function(e){return e.checked!=-1});if(!a.isMobile()&&!n)return t.selectionTip.show=!0,t.selectionTip.fadein||(t.selectionTip.fadein=!0,i(function(){t.selectionTip.fadein=!1},300)),!1;var c=k.reformOrderGoods();t.pageData.quickCheckout?k.orderCheckout(c.paramsData):e.$emit("cart",{name:"add",sku:c.cartData,callback:function(){o.url("/cart")}})},e.isMobile||i(k.bindFixedBar,500)}]),appsControllers.controller("CartCtrlReBuild",["$rootScope","$scope","TitleBar","CartReBuildService","CartWarrantyDialogService","$filter","Utils","$timeout","timestamp",function(e,t,o,i,r,a,s,n,c){var l=null,u=null;s.isMobile()?(o.setOptions({toggle:"back",title:"购物车"}),e.cartOrder.isEditCart=!1):s.setTitle("我的购物车","Smartisan"),e.timestamp=c,t.addWarranty=function(o,a,c,l){var d,p=c||l;if(t.tmpMobile={mobileSku:o,num:a,warrantyList:[]},d=t.tmpMobile,d.warrantyList=i.findWarranties(o),t.warrantys=d.warrantyList,p){for(var f=d.warrantyList,m=[],g=[],h=0;h<f.length;++h)g.push({goods_code:f[h].sku,count:f[h].num*d.num});m.push({goods_code:d.mobileSku,count:d.num,extra:g}),i.fetch(m).then(function(e){i.bind(e.data),e.bomb&&s.openDialog({message:"购物车已达最大购买限制，请删除过期商品"})})}else s.isMobile()?(t.warrantyConfig={normalClass:"red-checkbox",parentEl:"label",callback:function(e,t,o){}},e.cartOrder.mBuyWarranty=!0,e.mTitleBar.preventDefault=!0,u=n(function(){$("html,body").animate({scrollTop:0},30)},0)):(r.setOptions({scope:t}),r.init())},e.$on("goBack",function(o,i){i&&t.buyWarranty(null,function(t){e.cartOrder.mBuyWarranty=!1,e.mTitleBar.preventDefault=!1,u=n(function(){$("html,body").animate({scrollTop:$(".js-cart-items[data-id='"+t+"']").offset().top-60},80)},0)})}),t.showPackage=function(e){var t=$(e.currentTarget);t.hide(),t.siblings(".package-box").slideDown(500,jQuery.easing.easeOutCubic)},t.buyWarranty=function(e,o){var a=e&&$(e.currentTarget),c=t.tmpMobile,l=c.warrantyList,d=[],p=[];if(a&&a.hasClass("disabled-btn"))return!1;for(var f=0;f<l.length;++f)l[f]._checked&&p.push({goods_code:l[f].sku,count:l[f].num*c.num});d.push({goods_code:c.mobileSku,count:c.num,extra:p}),i.fetch(d).then(function(e){i.bind(e.data),!s.isMobile()&&r.close(),o&&o(c.mobileSku),e.bomb&&(u=n(function(){s.openDialog({message:"购物车已达最大购买限制，请删除过期商品"},function(){u&&n.cancel(u)})},200))})},t.checkboxWarrantyConfig={el:$(".store-content"),parentEl:"p",normalClass:e.isMobile?"m-blue-checkbox-new":"blue-checkbox-new",callback:function(){var e=t.tmpMobile.warrantyList,o=0;u=n(function(){for(var i=0;i<e.length;++i)e[i]._checked&&o++;0===o?t.tmpMobile.changeOne=!1:t.tmpMobile.changeOne=!0},0)}},t.checkboxConfig={normalClass:e.isMobile?"m-blue-checkbox-new":"blue-checkbox-new",callback:function(t,o,r,a){i.toggleChecked(r,e.cartOrder.isEditCart,a)}},t.checkboxConfigAll={normalClass:e.isMobile?"m-blue-checkbox-new":"blue-checkbox-new",callback:function(t,o,r){i.toggleAllChecked(r,e.cartOrder.isEditCart)}},t.removeCart=function(t,o,i){s.openDialog({message:"您确认删除该商品吗？",cancelText:"返回",doneText:"是",hasCancel:!0},function(){e.$emit("cart",{name:"singleDel",sku:t,attach:o,isMobile:i})})},t.removeChooseCart=function(t){t&&e.$emit("cart",{name:"batchedDel",batchType:"isChecked"})},t.removeDisabledCart=function(t){t&&e.$emit("cart",{name:"batchedDel",batchType:"isInvalid"})},t.cartQuantityConfig={useData:!1,canDelete:!1,customClass:"",callback:function(t,o,i,r){e.$emit("cart",{name:"add",isCover:!0,sku:o,num:i,callback:function(){r&&r()}})},refresh:function(e){(l=e)()}},t.createOrder=function(t){t&&e.$emit("cart",{name:"buy"})},e.scrollFixCount=function(){if(!e.isMobile&&t.$cartBox&&t.$cartBox.length>0){var o=$(window).scrollTop()+$(window).height(),i=t.$cartBox.offset().top+t.$cartBox.height();t.cartOrder&&o<i?(t.$fix.addClass("fix-bottom-fixed"),t.$fix.parent().addClass("gray-bottom-fixed")):(t.$fix.removeClass("fix-bottom-fixed"),t.$fix.parent().removeClass("gray-bottom-fixed"))}},t.$on("$viewContentLoaded",function(e){var o=$(".store-content");t.$cartBox=o.find(".gray-box:first"),t.$fix=o.find(".cart-bottom-bg"),u=n(function(){t.scrollFixCount()},0)}),$(window).on("scroll resize",function(){t.scrollFixCount()}),t.$on("$destroy",function(){u&&n.cancel(u)})}]),appsControllers.controller("CdkeyCtrl",["$rootScope","$scope","CartRequest","$q","Config","StoreConfig","Utils","$timeout","$location","MobileService","MobileGoodsService","$cookies","GoodsService",function(e,t,o,i,r,a,s,n,c,l,u,d,p){s.setTitle("优先购买通道","Smartisan"),t.invalid={},t.util={},t.focus={},t.util.submitted=!1,t.errorMsg="",t.phone=null,t.uCodeInfo=null,t.captchaLoading=!1,t.reloadCaptcha=function(){var e="mobileCode",o=r.URI.store+a.captcha[e];o=o.replace(/\&*$/gi,""),_.indexOf(location.host.split("#"),"www.smartisan.com")==-1&&(o="http://www.smartisan.com"+o),t.captchaLoading=!0;var i=+new Date;t.loginCaptchaUrl=o+"&"+i,n(function(){t.captchaLoading=!1},600)},t.reloadCaptcha(),t.$watch("cdkey.cdkeycode",function(e){t.uCodeError=!1}),t.codeErrorTrigger=function(e){t.uCodeError=!0,t.invalid.cdkeycodeValid=!1,t.errorMsg=e,t.phone=null,t.uCodeInfo=null,t.reloadCaptcha()},t.verifyCode=function(){if(t.util.submitted=!0,!t.form.$invalid){var e={cdkey_code:t.cdkey.cdkeycode,captcha_code:t.cdkey.captcha},r=function(e){var t=e.data,r="";return e.skuInfo=null,t&&t.pre_goods_id&&0!=t.pre_goods_id?(r=t.pre_goods_id,o.getSingleSkuInfo({skuId:r}).then(function(t){return t&&t.data&&(e.skuInfo=t.data.shop_info),e})):i.when(e)};l.verifyMobileCdkey(e).then(r).then(function(e){var o=0,i="未使用",r=e.data,a=e.errInfo;if(!e.code&&r){if(r.batch_id==-1&&!a){var s=new Date;s.setDate(s.getDate()+1),d.put("__batch_code",t.cdkey.cdkeycode,{domain:".smartisan.com",path:"/",expires:s}),c.url("/jianguopro-cdkey")}if(r.pre_goods_id&&0!=r.pre_goods_id){var n=r.pre_goods_id,l=e.skuInfo;if(l){t.phone={mobileId:n,cdkeyCode:t.cdkey.cdkeycode,name:l.name,versionLabel:l.versionLabel,price:l.price,discountAmount:r.money,isDisabled:1==r.status,image:l.ali_image?l.ali_image:l.image,isOSS:!!l.ali_image};for(var u=0;u<l.spec_json.length;++u)1==l.spec_json[u].spec_id||12==l.spec_json[u].spec_id?t.phone.colorLabel=l.spec_json[u].show_name:2!=l.spec_json[u].spec_id&&13!=l.spec_json[u].spec_id||(t.phone.capacityLabel=l.spec_json[u].show_name);t.uCodeInfo={createTime:r.create_time,expireTime:r.expire_time,money:r.money,status:0,bathchId:r.batch_id,statusLabel:""},$(window).scrollTop(0)}else t.codeErrorTrigger("未开售")}}if(a){var p=parseInt(_.keys(a)[0]),f={21001:"优码不能为空",21002:"优码格式错误",21003:"已过期",21004:"现金券和优码不能同时使用",21005:"非手机商品不支持优码购买",21006:"手机不支持现金券购买",21007:"此优码无效",21008:"已使用",21009:"未发布"};if(r.batch_id==-1)switch(p){case 21003:case 21008:t.codeErrorTrigger(f[p]||"无效");break;case 21009:t.codeErrorTrigger("未开售");break;case 10014:t.invalid.captchaValid=!1,t.reloadCaptcha();break;default:t.codeErrorTrigger("无效")}else switch(p){case 21003:case 21008:o=1,i=f[p];break;case 21009:
t.codeErrorTrigger("未开售");break;case 10014:t.invalid.captchaValid=!1,t.reloadCaptcha();break;default:t.codeErrorTrigger("无效")}}t.uCodeStatus=o,t.uCodeStatusLabel=i})}},t.returnVerify=function(){t.phone=null,t.uCodeInfo=null},t.useCode=function(e){return(!t.phone||!t.phone.isDisabled)&&void(t.phone.activateChecked?l.createTempOrder(t.phone).then(function(e){c.url("/insurance?"+l.parseTempOrderParams({mobile_id:t.phone.mobileId,cdkey_code:t.phone.cdkeyCode,discount_amount:t.phone.discountAmount}))}):($(".phone-activate .highlight").css("display","inline-block"),s.isMobile()?$("html, body").animate({scrollTop:$(".phone-activate").offset().top-$(window).height()+260},{duration:100,easing:"swing"}):$("html, body").animate({scrollTop:0},{duration:100,easing:"swing"})))},t.checkboxActivateConfig={el:$(".store-content"),parentEl:".phone-activate",normalClass:e.isMobile?"m-red-checkbox":"red-checkbox"}}]),appsControllers.controller("T2Ctrl",["$rootScope","$scope","Config","StoreConfig","Utils","$timeout","$location","MobileService","MobileGoodsService","StorePv","pageParams","T2Service","giftInfo",function(e,t,o,i,r,a,s,n,c,l,u,d,p){r.setTitle("Smartisan T2","Smartisan"),t.pageParams=angular.extend({},u),t.curMobile=t.pageParams.curMobile,t.giftInfo=p,t.subTotalObj={total:0,cost:0},t.resetMobile=t.curMobile?{edition:t.curMobile.edition,version:t.curMobile.version,color:t.curMobile.color,capacity:t.curMobile.capacity}:{},t.chooseMobile=function(){var e=d.getT2Params(t.resetMobile.version,t.resetMobile);t.pageParams.color=[].concat(e.color),t.pageParams.capacity=[].concat(e.capacity),t.subTotal()},t.subTotal=function(){var e={};e={edition:t.resetMobile.edition,version:t.resetMobile.version,color:t.resetMobile.color,capacity:t.resetMobile.capacity};var o=_.where(c.mapPhones,e),i={};1==o.length&&t.resetMobile.capacity?i=o[0]:t.resetMobile.color&&t.resetMobile.capacity&&(delete t.resetMobile.color,delete t.resetMobile.capacity),t.curMobile=$.extend(t.resetMobile,i,d.mapStock[i.sku]);var r,a=0|t.curMobile.price;0==a||(r=t.curMobile.oldPrice?t.curMobile.oldPrice:a+200),t.subTotalObj={total:a,cost:r},t.curMobileSku=t.curMobile.sku},t.checkRadio=function(e,o,i){var r=$(e.currentTarget);$(e.target);if(!r.hasClass("disabled"))switch(o){case"capacity":t.chooseCapacity(i)}},t.chooseCapacity=function(e){e=e||t.pageParams.curMobile.capacity;var o={};o=$.extend({},{edition:t.curMobile.edition,version:t.curMobile.version,color:t.curMobile.color,capacity:e}),t.resetMobile=$.extend({},o),t.chooseMobile()},t.chooseParametersImage=function(e){var t=$(".store-content");t.find(".js-parameters-size-color").removeClass().addClass("mobile-size js-parameters-size-color "+e),t.find(".js-parameters-keysPorts").removeClass().addClass("spec-parameters-detail spec-parameters-keysPorts js-parameters-keysPorts "+e)},t.checkout=function(e){if(t.curMobile){var o=$(e.currentTarget),i=(t.pageParams.activity,_.where(c.mapPhones,{sku:t.curMobile.sku})),r={};o.hasClass("disabled-btn")||1!=i.length||(i=i[0],r={mobile_id:i.sku,pay_type:2,mobileData:i},t.curMobile.activateChecked?(l.SMpvEvent("T2","现在购买"),s.url("/insurance?"+n.parseTempOrderParams(r))):($(".t2-activate .highlight").css("display","inline-block"),$("html, body").animate({scrollTop:$(".t2-activate").offset().top-$(window).height()+148+100+30},{duration:100,easing:"swing"})))}};var f=function(){var e=$(".store-content");if(i.isMobile)return!1;var t=e.find(".js-checkout-panel"),o=$(".footer").offset().top,r=$(window).height();t.toggleClass("checkout-fix-panel-follow",r<=o),$(window).on("resize, scroll",function(){var e=$(window).height(),i=$(this).scrollTop();t.toggleClass("checkout-fix-panel-follow",i+e<=o)})};t.$on("$viewContentLoaded",function(e){if(t.curMobile&&t.chooseMobile(),!r.isMobile()){var o=$(".js-loop-banner-list").carousel({slideName:".show-loop-list",slideBtnsName:".loop-dot-list",timeout:5e3,isLoopStop:!0});o.doCarousel(),f()}}),t.bindScroll=function(){var e=$(".store-content"),o=e.find(".js-fix-btn-panel");$(window).scroll(function(){t.pageParams.allStock&&o.toggleClass("on",$(window).scrollTop()>155)})},e.isMobile&&t.bindScroll(),t.checkboxActivateConfig={el:$(".store-content"),parentEl:".t2-activate",normalClass:e.isMobile?"m-red-checkbox":"red-checkbox"}}]),appsControllers.controller("M1Ctrl",["$rootScope","$scope","$window","$location","$route","$routeParams","$timeout","$cookies","$q","$filter","TitleBar","Utils","mobileWithPackage","accessoriesWithStock","promotionsGifts","M1Service","StoreConfig","promotions",function(e,t,o,i,r,a,s,n,c,l,u,d,p,f,m,g,h,v){var b,k,y,_={},C=null,w={m1:{id:"m1",name:"Smartisan M1",value:"5.15"},m1l:{id:"m1l",name:"Smartisan M1L",value:"5.7"}},S=/^1[3|4|5|7|8](\d{9}|\d{1}\*{4}\d{4})$/,I=i.$$search,M="m1l"!==I.n?"m1":"m1l",x=p.mobilesData,T=p.packageData,P=p.currMobile;d.setTitle("Smartisan M1 / M1L","Smartisan"),u.setOptions({title:"Smartisan M1/M1L"}),t.promotionInfo=v,e.topOffset="-50",t.PHOTO_SIZE=610,t.PACKAGE_STATUS=h.usePackage,t.ACCESSORY_STATUS=h.useAccessory,t.params={},t.category=M,t.currMobile=P,t.currPackage={},t.packageInfo=T,t.accessories={},t.accessories[t.category]=f,t.accessoriesTop3={},t.accessoriesTop3[t.category]=[],t.mobilePromos=m.mobilePromos||{},t.mobileGifts=m.gifts||{},t.currAccessories={m1:{skus:[],items:{},totalPrice:0},m1l:{skus:[],items:{},totalPrice:0}},t.reminder={},t.photoFadeIn=!0,t.currMobile.versionId&&t.currMobile.colorId&&t.category&&i.search({c:t.currMobile.colorId,v:t.currMobile.versionId,n:t.category}).replace(),t.accessories[t.category].length>3?t.accessoriesTop3[t.category]=t.accessories[t.category].slice(0,3):t.accessoriesTop3[t.category]=t.accessories[t.category],t.$on("footerFixed",function(){s(function(){y=$(".footer").offset().top,$(".m1-fix-bar").toggleClass("follow",$(window).scrollTop()+$(window).height()<=y),N()},0)}),t.chooseParams=function(e,o){var r=$(e.currentTarget);if(!r.hasClass("active"))switch(o){case"inch":var a;M="m1l"!==I.n?"m1":"m1l",r.addClass("active").siblings().removeClass("active"),t.category=r.data("name"),t.photoFadeIn=!1,c.all([g.getMobileInfoWithPackageStock(t.category),g.getAccessoriesInfoWithStock(t.category)]).then(function(e){if(x=e[0].mobilesData,T=e[0].packageData,t.currMobile=e[0].currMobile,t.accessories[t.category]=e[1],t.accessoriesTop3[t.category]=t.accessoriesTop3[t.category]?t.accessoriesTop3[t.category]:[],t.currMobile.versionId&&t.currMobile.colorId&&t.category&&i.search({c:t.currMobile.colorId,v:t.currMobile.versionId,n:t.category}).replace(),t.accessories[t.category].length>3)if(t.accessoriesTop3[t.category].length>0&&window.addEventListener){a=[];for(var o in t.accessories[t.category].slice(0,3))a.push(angular.extend({},t.accessoriesTop3[t.category][o],t.accessories[t.category].slice(0,3)[o].skus,t.accessories[t.category].slice(0,3)[o].saleStatus));t.accessoriesTop3[t.category]=a}else t.accessoriesTop3[t.category]=t.accessories[t.category].slice(0,3);else if(t.accessoriesTop3[t.category].length>0&&window.addEventListener){a=[];for(var r in t.accessories[t.category])a.push(angular.extend({},t.accessoriesTop3[t.category][r],t.accessories[t.category][r].skus,t.accessories[t.category][r].saleStatus));t.accessoriesTop3[t.category]=a}else t.accessoriesTop3[t.category]=t.accessories[t.category];t.currMobile.totalPrice=Number(t.currMobile.price)+Number(t.currAccessories[t.category].totalPrice),D(),s(function(){t.photoFadeIn=!0},20),!d.isMobile()&&t.$broadcast("footerFixed")},function(e){});break;case"color":var n=null;t.photoFadeIn=!1,i.search("c",r.data("cid")).replace(),n=g.updateVersionInfoByColorId(r.data("cid"),_[t.category].versions),n&&(t.params[t.category].versions=n),!d.isMobile()&&t.$broadcast("footerFixed");break;case"version":r.addClass("active").siblings().removeClass("active"),i.search("v",r.data("vid")).replace(),!d.isMobile()&&t.$broadcast("footerFixed")}},t.choosePackage=function(e){var o=$(e.currentTarget),i=o.data("pid");if(!o.hasClass("disabled")){if(o.addClass("active").next().toggle(),o.parent().siblings().children(".item-wrapper").removeClass("active").next().hide(),i){for(var r=0,a=t.packageInfo.length;r<a;++r)if(t.packageInfo[r].packageId==i){t.currPackage={packageId:i,packageTitle:t.packageInfo[r].packageTitle,packageSubTitle:t.packageInfo[r].packageSubTitle,packagePrice:t.packageInfo[r].packagePrice};break}t.currMobile.totalPrice=Number(t.currMobile.price)+Number(t.currPackage.packagePrice)}else t.currPackage={packageId:"no-package",packageTitle:"裸机",packageSubTitle:"裸机"},t.currMobile.totalPrice=t.currMobile.price;g.confirmSaleStatusWithPackageId(t.currMobile,t.currPackage.packageId)}},t.chooseAccessory=function(e,t){var o=$(e.currentTarget),i={};i.skuInfo=t.curr,i.type="accessory",o.hasClass("active")?A("remove",i):A("add",i),o.toggleClass("active")},t.findMoreAccessories=function(){t.accessoriesTop3[t.category]=t.accessories[t.category],s(function(){y=$(".footer").offset().top,$(".m1-fix-bar").toggleClass("follow",$(window).scrollTop()+$(window).height()<=y)},0)},t.buyPhone=function(){t.packageInfo,t.currPackage;if(3==t.currMobile.saleStatus&&t.currMobile.userRank.canBuy&&t.currMobile.inStock)if(t.currMobile.activateChecked){var o="insurance?m="+t.currMobile.sku,r=t.category;t.currAccessories[r].skus.length>0&&(o+="&ac="+t.currAccessories[r].skus.join("|")),e.mobileAccessories=t.currAccessories[r],e.currMobile=t.currMobile,$(".header-desktop").removeClass("fixed"),i.url(o)}else $(".m1-activate .highlight").css("display","inline-block"),$("html, body").animate({scrollTop:$(".m1-activate").offset().top},{duration:100,easing:"swing"})},t.switchSku=function(e,o){var i=$(e.currentTarget),r=i.parent().data("index")||0;C=s(function(){!i.hasClass("disabled")&&o&&(i.addClass("active").siblings().removeClass("active"),g.updateCurrPackageGoodsBySkuId(T,t.currPackage.packageId,r,o))},150)},t.cancelSwitchSku=function(){s.cancel(C)},t.switchAccessorySku=function(e,t,o){var i=$(e.currentTarget);if(!i.hasClass("disabled")){var r=o.curr.skuId.toString(),a=r.substring(0,r.length-2),s=$(".accessories-wrapper li[data-spu="+a+"]"),n={type:"accessory"};t!=r?angular.forEach(o.skus,function(e){e.skuId==t&&(o.curr=e,s.hasClass("active")||s.addClass("active"),n.skuInfo=o.curr,A("add",n))}):(n.skuInfo=o.curr,s.hasClass("active")?(s.removeClass("active"),A("remove",n)):(s.addClass("active"),A("add",n)))}e.stopPropagation()},t.checkboxActivateConfig={el:$(".store-content"),parentEl:".m1-activate",normalClass:e.isMobile?"m-red-checkbox":"red-checkbox"},t.reminder.keydown=function(){var e=$(event.currentTarget);e.parent().removeClass("invalid"),e.next().hide()},t.reminder.blur=function(o){var i=$(o.currentTarget),r=n.get("__t_no");i.val()?e.isLoggedIn&&r?!S.test(t.reminder.phoneNumber)||t.reminder.phoneNumber.indexOf("*")>-1&&r!==t.reminder.phoneNumber?(i.parent().addClass("invalid"),i.next().show()):(i.parent().removeClass("invalid"),i.next().hide()):S.test(t.reminder.phoneNumber)?(i.parent().removeClass("invalid"),i.next().hide()):(i.parent().addClass("invalid"),i.next().show()):i.prev(".reminder-placeholder").show()},t.reminder.focus=function(e){var t=$(e.currentTarget);t.prev(".reminder-placeholder").hide()},t.reminder.submit=function(o){if(e.isLoggedIn){var r=n.get("__t_no");if(t.reminder.phoneNumber&&!S.test(t.reminder.phoneNumber)||t.reminder.phoneNumber.indexOf("*")>-1&&r!==t.reminder.phoneNumber){var a=$(o.currentTarget).siblings(".reminder-input");a.addClass("invalid")}else g.submitNumberInfo(t.reminder.phoneNumber,t.currMobile.sku).then(function(e){e?d.isMobile()?i.url("/reminder"):(g.updateSkuReserved(t.currMobile.sku),t.currMobile.userRank.isReserve=!0,t.currMobile.labelMessage="预约成功",$(".page-bg-cover").addClass("active"),$(".m1-fix-reminder-submit").hide(),$(".m1-fix-reminder-success").show()):(g.updateSkuReserved(t.currMobile.sku),t.currMobile.userRank.isReserve=!0,t.currMobile.labelMessage="预约成功",$(".page-bg-cover").removeClass("active"),$(".m1-fix-reminder-submit").hide())}),e.reminderMobile=t.currMobile,e.reminderNumber=t.reminder.phoneNumber,n.put("__t_no",t.reminder.phoneNumber)}else if(t.reminder.phoneNumber)if(S.test(t.reminder.phoneNumber))t.reminder.phoneNumber?n.put("__t_no",t.reminder.phoneNumber):n.remove("__t_no"),t.login();else{var a=$(o.currentTarget).siblings(".reminder-input");a.addClass("invalid")}else n.remove("__t_no"),t.login()},t.reminder.closeTips=function(e,t){$(e.currentTarget).parents(".m1-fix-reminder-"+t).hide(),$(".page-bg-cover").removeClass("active")};var D=function(){var o;t.params.inches=w,angular.forEach(x,function(e,o){var i={},r={},a=[],s=[],n=["whiteA","coffee","whiteB"],c=["normal","senior"];angular.forEach(e,function(e,t){i[e.colorId]?i[e.colorId].inStock=i[e.colorId].inStock||e.inStock:i[e.colorId]={inStock:e.inStock,colorId:e.colorId,colorName:e.colorName},r[e.versionId]?r[e.versionId].inStock=r[e.versionId].inStock||e.inStock:r[e.versionId]={inStock:e.inStock,versionName:e.versionName,versionId:e.versionId,capacity:e.capacity},v.discount[e.id]&&v.discount[e.id].discountPrice>0&&(e.reducePrice=e.price-v.discount[e.id].discountPrice)}),angular.forEach(n,function(e,t){angular.forEach(i,function(t,o){o===e&&a.push(t)})}),angular.forEach(c,function(e,t){angular.forEach(r,function(t,o){o===e&&s.push(t)})}),_[o]={colors:a,versions:s},t.params[o]=angular.extend({},_[o])}),o=g.updateVersionInfoByColorId(t.currMobile.colorId,_[t.category].versions),t.params[t.category].versions=o,angular.forEach(x[t.category],function(e){t.currMobile.colorId===e.colorId&&e.reducePrice>0&&angular.forEach(t.params[t.category].versions,function(t){t.versionId===e.versionId&&(t.isReducePrice=!0,t.colorId=e.colorId,t.reducePrice=e.reducePrice)})}),g.confirmSaleStatusWithPackageId(t.currMobile,t.currPackage.packageId),s(function(){if(e.isLoggedIn){var o=n.get("__t_no");if(o)t.reminder.phoneNumber=o;else{var i="";e.loginUser&&e.loginUser.cellphone&&(i=e.loginUser.cellphone.split(" "),2===i.length?i[0].indexOf("+86")>=0?(t.reminder.phoneNumber=i[1],n.put("__t_no",i[1])):(t.reminder.phoneNumber="",n.remove("__t_no")):(t.reminder.phoneNumber=i[0],n.put("__t_no",i[0])))}}},0)},A=function(e,o){var i=o.type,r=o.skuInfo;if("accessory"===i){var a=r.skuId,s=r.skuId.toString().substring(0,r.skuId.toString().length-2),n=r.price,c=t.category;if("add"===e){var l=null;for(var u in t.currAccessories[c].skus)if(l=t.currAccessories[c].skus[u].toString(),l.indexOf(s)>-1){t.currAccessories[c].skus.splice(u,1),t.currAccessories[c].totalPrice=Number(t.currAccessories[c].totalPrice)-Number(t.currAccessories[c].items[l].price),delete t.currAccessories[c].items[l];break}t.currAccessories[c].skus.push(a),t.currAccessories[c].items[a]=r,t.currAccessories[c].totalPrice=Number(t.currAccessories[c].totalPrice)+Number(n),t.currMobile.totalPrice=Number(t.currMobile.price)+t.currAccessories[c].totalPrice;for(var d=0;d<t.accessoriesTop3[t.category].length;++d)if(t.accessoriesTop3[t.category][d].spuId==s)for(var p in t.accessoriesTop3[t.category][d].skus)if(p==a){t.accessoriesTop3[t.category][d].choosen=a,t.accessoriesTop3[t.category][d].curr=r;break}}else if("remove"===e){for(var u=0;u<t.currAccessories[c].skus.length;++u)t.currAccessories[c].skus[u]==a&&(t.currAccessories[c].skus.splice(u,1),delete t.currAccessories[c].items[a],t.currAccessories[c].totalPrice=Number(t.currAccessories[c].totalPrice)-Number(n),t.currMobile.totalPrice=Number(t.currMobile.price)+Number(t.currAccessories[c].totalPrice));for(var d=0;d<t.accessoriesTop3[t.category].length;++d)if(t.accessoriesTop3[t.category][d].spuId==s){t.accessoriesTop3[t.category][d].choosen=!1;break}}}},N=function(e){var t=$(".m1-view"),e=$(".m1-choose-main");t.height()>=e.height()?t.removeClass("pos-bottom pos-fixed"):$(window).scrollTop()>=e.offset().top+e.height()+41-96-40-544?(t.addClass("pos-bottom"),t.addClass("pos-fixed")):$(window).scrollTop()>e.offset().top?(t.removeClass("pos-bottom"),t.addClass("pos-fixed")):(t.removeClass("pos-fixed"),t.removeClass("pos-bottom"))};t.$on("$locationChangeSuccess",function(e,o,r){var a,n=i.search(),c=i.$$path;return!(c.indexOf("/buyphone")<0)&&(n.v||n.c?(n.v=n.v?n.v:t.currMobile.versionId,n.c=n.c?n.c:t.currMobile.colorId,n.v!==t.currMobile.versionId||n.c!==t.currMobile.colorId?g.resolveUrlParams(t.category,n,function(e){t.currMobile=e,a=g.updateVersionInfoByColorId(t.currMobile.colorId,_[t.category].versions),t.currMobile.totalPrice=Number(t.currMobile.price)+Number(t.currAccessories[t.category].totalPrice),a&&(t.params[t.category].versions=a),g.confirmSaleStatusWithPackageId(t.currMobile,t.currPackage.packageId),angular.forEach(x[t.category],function(e){t.currMobile.colorId===e.colorId&&e.reducePrice>0&&angular.forEach(t.params[t.category].versions,function(t){t.versionId===e.versionId&&(t.isReducePrice=!0,t.colorId=e.colorId,t.reducePrice=e.reducePrice)})}),e&&t.PACKAGE_STATUS&&g.getPackGoodsStock(e.sku,e.packageInfo).then(function(e){T=g.reformMobileGoodsWithStock(t.category,x,e),t.packageInfo=T,t.currPackage={}})}):i.search({c:t.currMobile.colorId,v:t.currMobile.versionId,n:t.currMobile.category}).replace()):(i.search({c:t.currMobile.colorId,v:t.currMobile.versionId,n:t.currMobile.category}).replace(),D()),void s(function(){t.photoFadeIn=!0},20))}),t.$on("$viewContentLoaded",function(e){D(),d.isMobile()||s(function(){var e=$(window).height(),t=$(".m1-fix-bar");y=$(".footer").offset().top,b=$(".m1-view"),k=$(".m1-choose-main"),t.toggleClass("follow",e<=y),$(window).on("resize, scroll",function(){e=$(window).height(),y=$(".footer").offset().top,t.toggleClass("follow",$(this).scrollTop()+e<=y),N()})},0)})}]),appsControllers.controller("JianguoProCtrl",["$rootScope","$scope","$window","$location","$route","$routeParams","$timeout","$cookies","$q","$filter","TitleBar","Utils","StoreConfig","mobileWithStock","accessoriesAndPromosInfo","JianguoProService","PreSaleDialogService","timestamp","promotions",function(e,t,o,i,r,a,s,n,c,l,u,d,p,f,m,g,h,v,b){d.setTitle("坚果 Pro","Smartisan"),u.setOptions({title:"坚果 Pro"});var k,y={},C=f.mobilesData,w=f.currMobile;t.promotionInfo=b,t.params={},t.currMobile=w,t.accessories=m.accessoriesInfo||{},t.currAccessories={skus:[],items:{},totalPrice:0},t.currAccessBigImg={},t.mobilePromos=m.promosInfo.mobilePromos||{},t.mobileGifts=m.promosInfo.gifts||{},t.photoFadeIn=!0,t.currScollTop=null,t.currMobile.versionId&&t.currMobile.colorId&&i.search({v:t.currMobile.versionId,c:t.currMobile.colorId}).replace(),t.$on("footerFixed",function(){s(function(){k=$(".footer").offset().top,$(".jianguo-pro-fix-bar").toggleClass("follow",$(window).scrollTop()+$(window).height()<=k)},0)}),t.chooseParams=function(e,o){var r=$(e.currentTarget);if(!r.hasClass("active"))switch(o){case"version":t.photoFadeIn=!1,i.search("v",r.data("vid")).replace(),t.currAccessories={skus:[],items:{},totalPrice:0},!d.isMobile()&&t.$broadcast("footerFixed");break;case"color":if(r.hasClass("disabled"))return;t.photoFadeIn=!1,i.search("c",r.data("cid")).replace(),t.currAccessories={skus:[],items:{},totalPrice:0},!d.isMobile()&&t.$broadcast("footerFixed");break;case"package":if(r.hasClass("disabled"))return;t.photoFadeIn=!1,i.search("p",r.data("pid")).replace(),t.currAccessories={skus:[],items:{},totalPrice:0},!d.isMobile()&&t.$broadcast("footerFixed")}},t.buyPhone=function(){if(3==t.currMobile.saleStatus&&t.currMobile.inStock)if(t.currMobile.activateChecked){var e="insurance?m="+t.currMobile.sku+"&q=1";t.currAccessories.skus.length>0&&(e+="&ac="+t.currAccessories.skus.join("|")),$(".header-desktop").removeClass("fixed"),i.url(e)}else $(".jianguo-pro-activate .highlight").css("display","inline-block"),$("html, body").animate({scrollTop:$(".jianguo-pro-activate").offset().top},{duration:100,easing:"swing"})},t.showPreSaleDetail=function(){d.isMobile()?(t.currScollTop=$(window).scrollTop(),$(window.document).scrollTop(0),$(".store-content").hide(),$(".m-pre-sale-rule").show(),u.setOptions({title:"坚果 Pro 全款预定规则",toggle:"back"}),e.hideAside=!0,e.mTitleBar.preventDefault=!0):($("body").css("overflow","hidden"),h.setOptions({scope:t}),h.init())},t.chooseAccessory=function(e,t){var o=$(e.currentTarget),i={};i.skuInfo=t.curr,i.type="accessory",o.hasClass("active")?x("remove",i):x("add",i),o.toggleClass("active")},t.switchAccessorySku=function(e,t,o){var i=$(e.currentTarget);if(!i.hasClass("disabled")){var r=o.curr.skuId.toString(),a=r.substring(0,r.length-2),s=$(".accessories-wrapper li[data-spu="+a+"]"),n={type:"accessory"};t!=r?angular.forEach(o.skus,function(e){e.skuId==t&&(o.curr=e,s.hasClass("active")||s.addClass("active"),n.skuInfo=o.curr,x("add",n))}):(n.skuInfo=o.curr,s.hasClass("active")?(s.removeClass("active"),x("remove",n)):(s.addClass("active"),x("add",n)))}e.stopPropagation()},t.accessStockType=function(e,o){var i=0;return angular.forEach(t.accessories[e][o],function(e){e.isSoldOut||i++}),i};var S=null,I=null;t.showDetail=function(e,t,o){var i=$(e.currentTarget);s.cancel(I),S=s(function(){i.addClass("hover").siblings("li").removeClass("hover"),i.children(".item-detail").show(),i.siblings("li").children(".item-detail").hide(),o.hover=o.skus[t]},300),$(".item-detail .story-box").scrollUnique()},t.cancelShowDetail=function(e){var t=$(e.currentTarget);s.cancel(S),I=s(function(){t.removeClass("hover"),t.children(".item-detail").hide(),t.siblings("li").removeClass("hover"),t.siblings("li").children(".item-detail").hide()},300)},t.showMoreAccessories=function(e){var t=$(e.currentTarget);t.hide(),t.siblings(".spu-list").addClass("show-more"),e.stopPropagation()},t.showAccessBigImg=function(o,i){t.currAccessBigImg.image=i.curr.image,t.currScollTop=$(window).scrollTop(),$(".store-content").hide(),$(".m-accessory-picture").show(),u.setOptions({title:"查看大图",toggle:"back"}),e.hideAside=!0,e.mTitleBar.preventDefault=!0,o.stopPropagation()},e.$on("goBack",function(o,i){i&&(u.setOptions({title:"坚果 Pro",toggle:"toggle"}),e.hideAside=!1,e.mTitleBar.preventDefault=!1,$(".m-accessory-picture").hide(),$(".m-pre-sale-rule").hide(),$(".store-content").show(),$("html,body").animate({scrollTop:t.currScollTop},80))}),t.checkboxActivateConfig={el:$(".store-content"),parentEl:".jianguo-pro-activate-wrapper",normalClass:e.isMobile?"m-red-checkbox":"red-checkbox"};var M=function(){var e,o,i={},r={},a={},s=[],n=[],c=[],l=["36","201","210","207","232"],u=["209","208","93"],d=["250","253"];angular.forEach(C,function(e){i[e.colorId]={colorId:e.colorId,colorName:e.colorName},r[e.versionId]={versionId:e.versionId,versionName:e.versionName,pixel:e.pixel,mPixel:e.mPixel,processor:e.processor},a[e.packageId]={packageId:e.packageId,packageName:e.packageName,packageTitle:e.packageTitle?e.packageTitle:"官方标配",packageSubTitle:e.packageSubTitle?e.packageSubTitle:"内含: 坚果 Pro 一台"},b.discount[e.sku]&&b.discount[e.sku].discountPrice>0&&(e.reducePrice=e.price-b.discount[e.sku].discountPrice)}),angular.forEach(l,function(e){angular.forEach(i,function(t,o){o===e&&s.push(t)})}),angular.forEach(u,function(e){angular.forEach(r,function(t,o){o===e&&n.push(t)})}),angular.forEach(d,function(e){angular.forEach(a,function(t,o){o===e&&c.push(t)})}),y={versions:n,colors:s,packages:c},t.params=angular.extend({},y),e=g.updateColorInfoByVersionId(t.currMobile.versionId,y.colors),g.addColorInfoToParams(t.params.colors,e),o=g.updatePackageInfoByVersionIdColorId(t.currMobile.versionId,t.currMobile.colorId,y.packages),g.addPackageInfoToParams(t.params.packages,o),angular.forEach(C,function(e){t.currMobile.colorId===e.colorId&&e.reducePrice>0&&angular.forEach(t.params.versions,function(t){t.versionId===e.versionId&&(t.isReducePrice=!0,t.colorId=e.colorId,t.reducePrice=e.reducePrice)})}),g.confirmSaleStatus(t.currMobile),T()},x=function(e,o){var i=o.type,r=o.skuInfo;if("accessory"===i){var a=r.skuId,s=r.skuId.toString().substring(0,r.skuId.toString().length-2),n=r.awardPrice;if("add"===e){var c=null,l=null,u=null;if(1==r.type){for(var d in t.currAccessories.skus)if(c=t.currAccessories.skus[d].toString(),c.indexOf(s)>-1){t.currAccessories.skus.splice(d,1),t.currAccessories.totalPrice=(Number(t.currAccessories.totalPrice)-Number(t.currAccessories.items[c].awardPrice)).toFixed(2),delete t.currAccessories.items[c];break}}else if(2==r.type)for(var d in t.currAccessories.skus)if(c=t.currAccessories.skus[d].toString(),l=t.currAccessories.items[c].configIndex,u=t.currAccessories.items[c].configId,l==r.configIndex&&u==r.configId){t.currAccessories.skus.splice(d,1),t.currAccessories.totalPrice=(Number(t.currAccessories.totalPrice)-Number(t.currAccessories.items[c].awardPrice)).toFixed(2),delete t.currAccessories.items[c];break}t.currAccessories.skus.push(a),t.currAccessories.items[a]=r,t.currAccessories.totalPrice=Number(t.currAccessories.totalPrice)+Number(n),t.currMobile.totalPrice=Number(t.currMobile.price)+t.currAccessories.totalPrice;for(var p=0;p<t.accessories.length;++p)if(t.accessories[p].spuId==s)for(var f in t.accessories[p].skus)if(f==a){t.accessories[p].choosen=a,t.accessories[p].curr=r;break}}else if("remove"===e){for(var d=0;d<t.currAccessories.skus.length;++d)t.currAccessories.skus[d]==a&&(t.currAccessories.skus.splice(d,1),delete t.currAccessories.items[a],t.currAccessories.totalPrice=(Number(t.currAccessories.totalPrice)-Number(n)).toFixed(2),t.currMobile.totalPrice=Number(t.currMobile.price)+Number(t.currAccessories.totalPrice));for(var p=0;p<t.accessories.length;++p)if(t.accessories[p].spuId==s){t.accessories[p].choosen=!1;break}}}},T=function(){t.currMobile.hasStage=!1,(v>=1504749600&&v<=1505318399||v>=1505440800&&v<=1506009599)&&_.indexOf(p.jianguoPro128GStage,t.currMobile.sku)>=0&&(t.currMobile.hasStage=!0,t.currMobile.stageText="花呗分期 12 期免息"),(v>=1504749600&&v<=1504886399||v>=1505440800&&v<=1505577599)&&_.indexOf(p.jianguoPro64GStage,t.currMobile.sku)>=0&&(t.currMobile.hasStage=!0,t.currMobile.stageText="花呗分期 6 期免息")};t.$on("$locationChangeSuccess",function(e,o,r){var a,n,c=i.search(),l=i.$$path;return!(l.indexOf("/jianguopro")<0)&&(c.v||c.c?(c.v=c.v?c.v:t.currMobile.versionId,c.c=c.c?c.c:t.currMobile.colorId,c.p=c.p?c.p:t.currMobile.packageId,c.v!==t.currMobile.versionId||c.c!==t.currMobile.colorId||c.p!==t.currMobile.packageId?g.resolveUrlParams(c,function(e){t.currMobile=e,a=g.updateColorInfoByVersionId(t.currMobile.versionId,y.colors),g.addColorInfoToParams(t.params.colors,a),n=g.updatePackageInfoByVersionIdColorId(t.currMobile.versionId,t.currMobile.colorId,y.packages),g.addPackageInfoToParams(t.params.packages,n),t.currMobile.totalPrice=Number(t.currMobile.price)+Number(t.currAccessories.totalPrice),angular.forEach(C,function(e){t.currMobile.colorId===e.colorId&&e.reducePrice>0&&angular.forEach(t.params.versions,function(t){t.versionId===e.versionId&&(t.isReducePrice=!0,t.colorId=e.colorId,t.reducePrice=e.reducePrice)})}),g.confirmSaleStatus(t.currMobile),T()}):i.search({v:t.currMobile.versionId,c:t.currMobile.colorId}).replace()):(i.search({v:t.currMobile.versionId,c:t.currMobile.colorId,p:t.currMobile.packageId}).replace(),M()),void s(function(){t.photoFadeIn=!0},20))}),t.$on("$viewContentLoaded",function(e){M(),d.isMobile()||s(function(){var e=$(window).height(),t=$(".jianguo-pro-fix-bar");k=$(".footer").offset().top,t.toggleClass("follow",e<=k),$(window).on("resize, scroll",function(){e=$(window).height(),k=$(".footer").offset().top,t.toggleClass("follow",$(this).scrollTop()+e<=k)})},800)})}]),appsControllers.controller("JianguoProCdkeyCtrl",["$rootScope","$scope","$window","$location","$route","$routeParams","$timeout","$cookies","$q","$filter","TitleBar","Utils","mobileInfoByCdkey","JianguoProCdkeyService","CartRequest",function(e,t,o,i,r,a,s,n,c,l,u,d,p,f,m){d.setTitle("坚果 Pro","Smartisan"),u.setOptions({title:"坚果 Pro"});var g,h={},v=p.mobilesData,b=p.currMobile;t.params={},t.currMobile=b,t.photoFadeIn=!0,t.currMobile.versionId&&t.currMobile.colorId&&i.search({v:t.currMobile.versionId,c:t.currMobile.colorId}).replace(),t.$on("footerFixed",function(){s(function(){g=$(".footer").offset().top,$(".jianguo-pro-fix-bar").toggleClass("follow",$(window).scrollTop()+$(window).height()<=g)},0)}),t.chooseParams=function(e,o){var r=$(e.currentTarget);if(!r.hasClass("active"))switch(o){case"version":t.photoFadeIn=!1,i.search("v",r.data("vid")).replace(),!d.isMobile()&&t.$broadcast("footerFixed");break;case"color":if(r.hasClass("disabled"))return;t.photoFadeIn=!1,i.search("c",r.data("cid")).replace(),!d.isMobile()&&t.$broadcast("footerFixed")}},t.buyPhone=function(){if(3==t.currMobile.saleStatus)if(t.currMobile.activateChecked){var o=n.get("__batch_code"),r="insurance?m="+t.currMobile.sku+"&q=1&c="+o;e.currMobile=t.currMobile,$(".header-desktop").removeClass("fixed"),m.cdkeyBind({goods_id:t.currMobile.sku,cdkey_code:o}).then(function(e){0==e.code?i.url(r):i.url("cdkey")})}else $(".jianguo-pro-activate .highlight").css("display","inline-block"),$("html, body").animate({scrollTop:$(".jianguo-pro-activate").offset().top},{duration:100,easing:"swing"})},t.checkboxActivateConfig={el:$(".store-content"),parentEl:".jianguo-pro-activate-wrapper",normalClass:e.isMobile?"m-red-checkbox":"red-checkbox"};var k=function(){var e,o={},i={},r=[],a=[],s=["36","201","210"],n=["209","208","93"];angular.forEach(v,function(e){o[e.colorId]={colorId:e.colorId,colorName:e.colorName},i[e.versionId]={versionId:e.versionId,versionName:e.versionName,pixel:e.pixel,mPixel:e.mPixel,processor:e.processor}}),angular.forEach(s,function(e){angular.forEach(o,function(t,o){o===e&&r.push(t)})}),angular.forEach(n,function(e){angular.forEach(i,function(t,o){o===e&&a.push(t)})}),h={versions:a,colors:r},t.params=angular.extend({},h),e=f.updateColorInfoByVersionId(t.currMobile.versionId,h.colors),f.addColorInfoToParams(t.params.colors,e),f.confirmSaleStatus(t.currMobile)};t.$on("$locationChangeSuccess",function(e,o,r){var a,n=i.search(),c=i.$$path;return!(c.indexOf("/jianguopro")<0)&&(n.v||n.c?(n.v=n.v?n.v:t.currMobile.versionId,n.c=n.c?n.c:t.currMobile.colorId,n.v!==t.currMobile.versionId||n.c!==t.currMobile.colorId?f.resolveUrlParams(n,function(e){t.currMobile=e,a=f.updateColorInfoByVersionId(t.currMobile.versionId,h.colors),f.addColorInfoToParams(t.params.colors,a),t.currMobile.totalPrice=Number(t.currMobile.price),f.confirmSaleStatus(t.currMobile)}):i.search({v:t.currMobile.versionId,c:t.currMobile.colorId}).replace()):(i.search({v:t.currMobile.versionId,c:t.currMobile.colorId}).replace(),k()),void s(function(){t.photoFadeIn=!0},20))}),t.$on("$viewContentLoaded",function(e){k(),d.isMobile()||s(function(){var e=$(window).height(),t=$(".jianguo-pro-fix-bar");g=$(".footer").offset().top,t.toggleClass("follow",e<=g),$(window).on("resize, scroll",function(){e=$(window).height(),g=$(".footer").offset().top,t.toggleClass("follow",$(this).scrollTop()+e<=g)})},200)})}]),appsControllers.controller("QinghuaiCtrl",["$rootScope","$scope","$timeout","$location","Utils","Config","TitleBar","Cover","ThemeService","CategoryService","GoodsService","timestamp","promotions",function(e,t,o,i,r,a,s,n,c,l,u,d,p){var f=i.search().id||63;t.isFootPrint=63!=f,t.sortType=i.search().sort||"sort",t.page=i.search().page||1,t.curCategory={title:"全部商品"},e.currentPage=f,e.timestamp=d;var m=_.findWhere(e.subMenuList,{id:parseInt(f,10)})||null;m&&m.title&&(t.curCategory=m,m=null),r.isMobile()?s.setOptions({title:t.curCategory.title}):r.setTitle(t.curCategory.title,"Smartisan"),t.cover={list:c.getCoverData(n.list)},t.promotionInfo=angular.extend(p.discount,p.give),t.isFootPrint||angular.forEach(t.cover.list,function(e,t){e.originalPrice=69,e.reducePrice=e.originalPrice-e.price>0?e.originalPrice-e.price:0}),t.getGiftInfo=function(){var e=[];angular.forEach(t.cover.list,function(t,o){e.push(t.id)})},t.getGiftInfo(),t.curPage=1,t.pageSize=10,t.maxPageCount=n.page_count,t.getDoodlesByPage=function(){t.curPage<t.maxPageCount&&(t.curPage++,l.getSkuListForQH(f,t.curPage).then(function(e){var o,i=0;if(e.list)for(;o=e.list.length,i<o;++i)e.list[i].shop_info&&(e.list[i].shop_info.image=e.list[i].shop_info.ali_image?e.list[i].shop_info.ali_image:e.list[i].shop_info.image,e.list[i].shop_info.isOSS=!!e.list[i].shop_info.ali_image);
var r=c.getCoverData(e.list);return angular.isArray(r)&&(angular.forEach(r,function(e,o){t.cover.list.push(e),t.isFootPrint||angular.forEach(t.cover.list,function(e,t){e.originalPrice=69,e.reducePrice=e.originalPrice-e.price>0?e.originalPrice-e.price:0})}),t.getGiftInfo()),e}))},$(window).scroll(function(){var e=$(window).height(),o=$(window).scrollTop(),i=$(document).height(),r=$(".footer").height();e+o+r>=i&&t.getDoodlesByPage()})}]),appsControllers.controller("ConvergeCtrl",["$rootScope","$scope","$location","$timeout","$interval","$q","MyCarousel","TitleBar","Utils","convergeList",function(e,t,o,i,r,a,s,n,c,l){c.setTitle("新品配件","Smartisan"),n.setOptions({title:"新品配件"});var u={100022303:49,100022501:29,100022601:69,100022701:39,100022801:69},d=l.skuList,p=l.msg.data.list;t.itemList=[],angular.forEach(d,function(e,o){angular.forEach(p,function(o,i){o.id==e&&t.itemList.push(o)})}),angular.forEach(u,function(e,o){angular.forEach(t.itemList,function(t,i){t.id==o&&(t.originalPrice=e,t.reducePrice=e-t.price>0?e-t.price:0)})}),c.isMobile()?s.init(".s100-mobile",{item:"img",btn:".colors > li"}):s.init(".series .s100",{item:".gallery > li",btn:".colors > li"})}]),appsControllers.controller("JianguoProConvergeCtrl",["$rootScope","$scope","$window","$location","$route","$routeParams","$timeout","$cookies","$q","$filter","TitleBar","Utils","timestamp",function(e,t,o,i,r,a,s,n,c,l,u,d,p){var f=$(window).height(),m=$(document.body).height(),g=$(".nav-sub"),h=g.find(".nav-sub-wrapper"),v=h.length>0?h.parent().height()/2-10+$(".nav-global").height():135,b=[{sku:"100030501",className:"dna",img:"dna_54081dc5f5.png",name:"DNA",slogan:"1953 年 4 月 25 日，DNA 的双螺旋形结构首次被提及"},{sku:"100030601",className:"laorenyuhai",img:"laorenyuhai_5241ed0d43.png",name:"老人与海",slogan:"1953年5月4日，海明威以作品《老人与海》获普利策奖"},{sku:"100028801",className:"ditelamusi",img:"ditelamusi_031bc14ac9.png",name:"迪特 · 拉姆斯",slogan:"1932 年 5 月 20 日，迪特·拉姆斯出生"},{sku:"100028901",className:"zhixianhuiyi",img:"zhixianhuiyi_29ca94d3a1.png",name:"制宪会议",slogan:"1787 年 5 月 25 日，制宪会议在费城召开"},{sku:"100030901",className:"gongjiaosiji",img:"gongjiaosiji_2c84136975.png",name:"公交司机",slogan:"1947 年 5 月 28 日，纽约公交司机的故事"},{sku:"100030801",className:"chaoren",img:"chaoren_92296f6f13.png",name:"超人漫画",slogan:"1938 年 6 月 1 日，第一本超人漫画出版"},{sku:"100029001",className:"dianhua",img:"dianhua_a7af69976f.png",name:"电话的发明",slogan:"1875 年 6 月 2 日，贝尔世界上第一部电话"},{sku:"100029101",className:"nuomandi",img:"nuomandi_32d2ce1035.png",name:"诺曼底登陆",slogan:"1944 年 6 月 6 日，诺曼底登陆"},{sku:"100029201",className:"tuling",img:"tuling_e71fd29529.png",name:"艾伦 · 图灵",slogan:"1912 年 6 月 23 日，艾伦 · 图灵出生"},{sku:"100029301",className:"bainiangudu",img:"bainiangudu_f0b2b59e8d.png",name:"《百年孤独》",slogan:"1967 年 6 月 29 日，《百年孤独》发表"},{sku:"100029501",className:"bijini",img:"bijini_8c4366820d.png",name:"比基尼",slogan:"1687 年 7 月 5 日，比基尼泳装首次亮相"},{sku:"100029601",className:"hongbaiji",img:"hongbaiji_8240ff6321.png",name:"“红白机”",slogan:"1983 年 7 月 15 日，任天堂“红白机”发售"},{sku:"100029701",className:"yueqiu",img:"yueqiu_65d507aada.png",name:"登陆月球",slogan:"1969 年 7 月 20 日，阿姆斯特朗登上月球"}],k=[{sku:"100023905",className:"red",img:"erji_red_a3efe7805f.png"},{sku:"100023906",className:"black",img:"erji_black_110d56dfd6.png"}];e.timestamp=p,t.currFootPrintName="dna",t.currFootPrintUrl="dna_54081dc5f5.png",t.currFootPrintSku="100030501",t.currFootPrintSlogan="1953 年 4 月 25 日，DNA 的双螺旋形结构首次被提及",t.footprintList=b,t.currHeadsetName="red",t.currHeadsetSku="100023905",t.currHeadsetUrl="erji_red_a3efe7805f.png",t.headsetColorsList=k,d.setTitle("坚果 Pro 新品配件","Smartisan"),u.setOptions({title:"坚果 Pro 新品配件"}),t.chooseFootPrint=function(e,o,i,r){t.currFootPrintName=e,t.currFootPrintSku=o,t.currFootPrintSlogan=r,t.currFootPrintUrl=i},t.chooseHeadset=function(e,o,i){t.currHeadsetName=e,t.currHeadsetSku=o,t.currHeadsetUrl=i},t.buy=function(e){d.isMobile()?i.url("item/"+e):window.open("#/item/"+e)},d.isMobile()||$(window).on("scroll.navFixed",function(){f+$(window).scrollTop()+h.parent().height()/2<m&&($(window).scrollTop()>=v?$(".converge-footprint").addClass("correct"):$(".converge-footprint").removeClass("correct"))})}]),appsServices.factory("StorePv",["$q",function(e){function t(){}return t.prototype.init=function(){},t.prototype.pvPage=function(){try{MLTrackerz.track({type:"pageview",path:window.location.href})}catch(e){}},t.prototype.pvEvent=function(e){try{MLTrackerz.track({type:"event",action:e})}catch(t){}},t.prototype.pvBusiness=function(e){try{MLTrackerz.track(e)}catch(t){}},t.prototype.SMpvEvent=function(e,t){try{_smq.push(["custom",e,t])}catch(o){}},t.prototype.SMpvOrder=function(e,t,o){try{_smq.push(["custom","提交订单",t,o,e])}catch(i){}},t.prototype.SMpvPayment=function(e,t,o){try{_smq.push(["custom","成交订单",t,o,e])}catch(i){}},new t}]),appsServices.factory("PullPlugin",["$rootScope",function(e){function t(){var e=this;e.domConfig={}}return t.prototype.init=function(){},t.prototype.bindPull=function(e){var t=function(e){var t={};return window.navigator.pointerEnabled&&"touch"==e.pointerType||window.navigator.msPointerEnabled&&e.pointerType&&e.pointerType==e.MSPOINTER_TYPE_TOUCH?(t.y=e.pageY,t.x=e.pageX):e.changedTouches&&e.changedTouches.length&&(t.y=e.changedTouches[0].pageY,t.x=e.changedTouches[0].pageX),t},o=this,i={start:0,offset:0},r=$.extend({domWrapper:$(".wrapper"),swipeWrapper:$(".wrapper"),loadingClass:"swiping",swipeMaxHeight:50,swipeUpCallback:null,swipeDownCallback:null},e),a=function(e){var o=e.originalEvent,r=t(o);r.y&&(i.start=r.y)},s=function(e){i.isTop=$(window).scrollTop(),i.isBottom=$(window).scrollTop()+$(window).height()-$(document).height();var o,a=e.originalEvent,s=t(a);s.y&&(i.offset=s.y-i.start,o=Math.round(i.offset/3),r.enableUp&&0===i.isTop&&i.offset>0&&(e.preventDefault(),o=o>=r.swipeMaxHeight?r.swipeMaxHeight:o,r.isLoading=!0,r.swipeWrapper.addClass(r.loadingClass),r.swipeWrapper.css({transform:"translate3d(0, "+o+"px, 0)"})),r.enableDown&&0===i.isBottom&&i.offset<0&&(o=o<=-r.swipeMaxHeight?-r.swipeMaxHeight:o,r.isLoading=!0,r.swipeWrapper.addClass(r.loadingClass),r.swipeWrapper.css({transform:"translate3d(0, "+o+"px, 0)"})))},n=function(e){r.isLoading&&(r.enableUp&&i.offset>0&&(r.swipeWrapper.removeClass(r.loadingClass),r.swipeWrapper.css({transform:"translate3d(0, 0, 0)",transition:"transform 0.6s cubic-bezier(0.1, 0.57, 0.1, 1)"})),r.enableDown&&i.offset<0&&(r.swipeWrapper.removeClass(r.loadingClass),r.swipeWrapper.css({transform:"translate3d(0, 0, 0)",transition:"transform 0.6s cubic-bezier(0.1, 0.57, 0.1, 1)"})),i.offset>=70?r.swipeUpCallback():i.offset<=-70&&r.swipeDownCallback(),r.isLoading=!1)};return r.swipeWrapper.on("touchstart",a),r.swipeWrapper.on("touchend",n),r.swipeWrapper.on("touchmove",s),o},new t}]),appsServices.service("$bsCompiler",["$q","$http","$injector","$compile","$controller","$templateCache",function(e,t,o,i,r,a){function s(e,t){return angular.element((t||document).querySelectorAll(e))}function n(e){return c[e]?c[e]:c[e]=t.get(e,{cache:a}).then(function(e){return e.data})}this.compile=function(t){t.template&&/\.html$/.test(t.template)&&(t.templateUrl=t.template,t.template="");var a=t.templateUrl,c=t.template||"",l=t.controller,u=t.controllerAs,d=angular.copy(t.resolve||{}),p=angular.copy(t.locals||{}),f=t.transformTemplate||angular.identity,m=t.bindToController;if(angular.forEach(d,function(e,t){angular.isString(e)?d[t]=o.get(e):d[t]=o.invoke(e)}),angular.extend(d,p),c)d.$template=e.when(c);else{if(!a)throw new Error("Missing `template` / `templateUrl` option.");d.$template=n(a)}return t.titleTemplate&&(d.$template=e.all([d.$template,n(t.titleTemplate)]).then(function(e){var t=angular.element(e[0]);return s('[ng-bind="title"]',t[0]).removeAttr("ng-bind").html(e[1]),t[0].outerHTML})),t.contentTemplate&&(d.$template=e.all([d.$template,n(t.contentTemplate)]).then(function(e){var o=angular.element(e[0]),i=s('[ng-bind="content"]',o[0]).removeAttr("ng-bind").html(e[1]);return t.templateUrl||i.next().remove(),o[0].outerHTML})),e.all(d).then(function(e){var o=f(e.$template);t.html&&(o=o.replace(/ng-bind="/gi,'ng-bind-html="'));var a=angular.element("<div>").html(String.prototype.trim?o.trim():o).contents(),s=i(a);return{locals:e,element:a,link:function(t){if(e.$scope=t,l){var o=r(l,e,!0);m&&angular.extend(o.instance,e);var i=angular.isObject(o)?o:o();a.data("$ngControllerController",i),a.children().data("$ngControllerController",i),u&&(t[u]=i)}return s.apply(null,arguments)}}})};var c={}}]),appsServices.factory("PagingService",["$timeout","StoreConfig",function(e,t){var o,i,r={hasFirst:!0,hasEnd:!0,prevPage:1,nextPage:1,pageCount:1,pages:[]},a={},s=!1,n=function(e){var o=0|e.pageCount,i=0|e.curPage,r=(e.$wrapper,$(".store-content").width()),a=0,s=r,n=t.paging;1==i?e.hasFirst=!1:(e.prevPage=i-1,s-=n.prevWidth,s-=n.firstWidth,a=a+n.prevWidth+n.firstWidth),i==o?e.hasEnd=!1:(e.nextPage=i+1,s-=n.nextWidth,s-=n.lastWidth,a=a+n.nextWidth+n.lastWidth);var c=Math.floor(s/n.itemWidth),l=1,u=o;if(u>c){var d=Math.floor(c/2);i<=d?(l=1,u=c):i>=u-d?(l=o-c+1,u=o):(l=i-d+(c%2==0?1:0),u=i+d)}else c=u;e.pages=[];for(var p=l,f=u;p<=f;p++)e.pages.push(p);return e};return{set:function(e){if(!s)return void(i=e);tmpObj=angular.extend({},r,e?e:{}),a[o].paging=angular.extend({},n(tmpObj))},init:function(e){r=angular.extend(r,e?e:{})},addDom:function(e,t,r){var n=this;s=!0,domsMap=t,o=e||"paging",a[o]=r,n.init(),i&&(n.set(i),i=null)}}}]),appsServices.factory("CartWarrantyDialogService",["$q","$timeout","$bsCompiler","DialogService",function(e,t,o,i){function r(){var e=this;e.options={templateUrl:"view/html/tempDialog-cart-warranty.html"},e.dialog=null}return r.prototype.setOptions=function(e){var t=this;angular.isObject(e)&&(this.options=angular.extend(t.options,e))},r.prototype.init=function(){var e=this,r=o.compile(e.options),a=e.options.scope.$new(),s={};a&&(s=a.$parent.tmpWarranty),r.then(function(o){e.dialog=i.setContent("dialog",{templateObj:o.link(e.options.scope.$new(),function(e,t){}),dialogClass:"module-dialog-cart-warranty",hasBtn:!1,title:"购买保修服务"}),t(function(){i.open("dialog")},50)})},r.prototype.close=function(){var e=this;e.dialog.cancel()},new r}]),appsServices.factory("PreSaleDialogService",["$q","$timeout","$bsCompiler","DialogService",function(e,t,o,i){function r(){var e=this;e.options={templateUrl:"view/html/tempDialog-jianguopro-pre-sale.html"},e.dialog=null}return r.prototype.setOptions=function(e){var t=this;angular.isObject(e)&&(this.options=angular.extend(t.options,e))},r.prototype.init=function(){var e=this,r=o.compile(e.options);r.then(function(o){e.dialog=i.setContent("dialog",{templateObj:o.link(e.options.scope.$new(),function(e,t){}),dialogClass:"module-dialog-jianguopro-pre-sale",hasBtn:!1,title:"坚果 Pro 全款预定规则说明"}),t(function(){i.open("dialog")},50)})},r.prototype.close=function(){var e=this;e.dialog.cancel()},new r}]),appsServices.factory("AddressService",["$q","StoreConfig","Config","$rootScope","CartRequest",function(e,t,o,i,r){function a(){var e=this;e.provinceList=null,e.cityList={},e.districtList={},e.cityList[0]=e.parseAreaData([],"city"),e.districtList[0]=e.parseAreaData([],"district")}return a.prototype.getList=function(){return r.addressList().then(function(t){var o=e.defer();return t.code?o.reject(t):o.resolve(t.data),o.promise})},a.prototype.removeAddress=function(t){return r.addressDelete({id:t}).then(function(t){var o=e.defer();return t.code?o.reject("网络延迟"):o.resolve(t.data),o.promise})},a.prototype.getAllProvince=function(){var t=this,o=e.defer();return t.provinceList?o.resolve(t.provinceList):r.getProvince({}).then(function(e){e.code||(t.provinceList=t.parseAreaData(e.data,"province"),o.resolve(t.provinceList))},function(e){}),o.promise},a.prototype.citySelect=function(t){var o=this,i=e.defer();return t?o.cityList[t]?i.resolve(o.cityList[t]):r.getCity({province_id:t}).then(function(e){e.code||(o.cityList[t]=o.parseAreaData(e.data,"city"),i.resolve(o.cityList[t]))},function(e){}):i.resolve(o.cityList[0]),i.promise},a.prototype.districtSelect=function(t){var o=this,i=e.defer();return t?o.districtList[t]?i.resolve(o.districtList[t]):r.getDistrict({city_id:t}).then(function(e){e.code||(o.districtList[t]=o.parseAreaData(e.data,"district"),i.resolve(o.districtList[t]))},function(e){}):i.resolve(o.districtList[0]),i.promise},a.prototype.updateAddress=function(t){var o=e.defer();return t["default"]=1==t["default"]?1:0,r.addressUpdate(t).then(function(e){e.code?o.reject("网络延迟"):o.resolve(e.data)},function(e){}),o.promise},a.prototype.addAddress=function(t){var o=e.defer();return t["default"]=1==t["default"]?1:0,r.addressAdd(t).then(function(e){e.code?o.reject({}):o.resolve(e.data)},function(e){}),o.promise},a.prototype.parseAreaData=function(e,t){var o=[];return $.each(e,function(e,t){o.push({area_name:t.area_name,area_id:t.area_id})}),"district"==t&&o.push({area_id:"999999",area_name:"其他"}),o},new a}]),appsServices.factory("AddressDialogService",["$q","$timeout","$bsCompiler","DialogService",function(e,t,o,i){function r(){var e=this;e.options={templateUrl:"view/html/tempDialog-address.html"},e.dialog=null}return r.prototype.setOptions=function(e){var t=this;angular.isObject(e)&&(this.options=angular.extend(t.options,e))},r.prototype.init=function(){var e=this,r=o.compile(e.options),a=e.options.scope.$new(),s={};a&&(s=a.$parent.tmpWarranty),r.then(function(o){e.dialog=i.setContent("dialog",{templateObj:o.link(e.options.scope.$new(),function(e,t){}),dialogClass:"module-dialog-address",title:"管理收货地址",hasCancel:!0,cancelText:"返回",doneText:"保存"}),t(function(){i.open("dialog",function(){e.options.scope.formDone()&&i.close()})},50)})},r.prototype.close=function(){var e=this;e.dialog.cancel()},new r}]),appsServices.factory("OrderComfirmDialogService",["$q","$timeout","$bsCompiler","DialogService",function(e,t,o,i){function r(){var e=this;e.options={templateUrl:"view/html/tempDialog-order-comfirm.html"},e.dialog=null}return r.prototype.setOptions=function(e){var t=this;angular.isObject(e)&&(this.options=angular.extend(t.options,e))},r.prototype.init=function(){var e=this,r=o.compile(e.options),a=e.options.scope.$new(),s={};a&&(s=a.$parent.tmpWarranty),r.then(function(o){e.dialog=i.setContent("dialog",{templateObj:o.link(e.options.scope.$new(),function(e,t){}),dialogClass:"module-dialog-confirm-order",title:"确认信息",hasCancel:!0,cancelText:"返回",doneText:"确定"}),t(function(){i.open("dialog",function(){e.options.scope.comfirmDone()&&i.close()})},50)})},r.prototype.close=function(){var e=this;e.dialog.cancel()},new r}]),appsServices.factory("CategoryService",["$rootScope","$q","CartRequest","StoreConfig","Config","MobileGoodsService","GoodsService",function(e,t,o,i,r,a,s){function n(){var e=this;e.CategoryModel=null,e.cacheCategoryList=null}return n.prototype.getCategoryList=function(){var e=this,i=t.defer();if(e.cacheCategoryList){var r=[].concat(e.cacheCategoryList);i.resolve({list:r})}return o.getCategoryList().then(function(t){var o;t.code?i.reject("网络延迟"):(o=t.data,e.cacheCategoryList=o.list,i.resolve(o))},function(e){}),i.promise},n.prototype.getSkuDetail=function(e){return o.getSingleSkuInfo({skuId:e,with_spu_sku:!0,with_stock:!0}).then(function(e){var o,i=t.defer();if(e.code)i.reject("网络异常!");else{o=e.data;var r={},a=!1,s=o.product_info.goods_type;20!=s&&8!=s||(a=!0,20==s&&(r.typeId=20,r.url="http://www.smartisan.com/shop/#/backshell?id=67",r.text="查看更多“足迹系列”手感膜"),8==s&&(r.typeId=8,r.url="http://www.smartisan.com/shop/#/hd/qinghuai",r.text="查看更多“情怀”背壳")),o.shop_info.is_doodle=a,o.moreDoodles=r,o.shop_info.is_custom=o.shop_info.is_custom||0,i.resolve(o)}return i.promise})},n.prototype.getSpecList=function(e,t,o){var r,a,s=this;angular.forEach(t,function(e){e.id==o&&(r=e,a=e.spu_id)});var n=[].concat(t),c=[];angular.forEach(e,function(e){var o=[];angular.forEach(e.spec_values,function(c){var l;angular.forEach(t,function(t){t.attr_info&&t.attr_info[e.spec_id]&&t.attr_info[e.spec_id].spec_value_id==c.id&&(l={specName:c.show_name,type:e.show_type,image:c.image})}),l&&o.push(angular.extend({specId:e.spec_id,specVal:c.id,soldout:s.isSoldout(n,e.spec_id,c.id),isExist:_.indexOf(i.SmartisanTShirtSpu,a)>-1||s.isExist(n,r,e.spec_id,c.id),selected:r.attr_info[e.spec_id].spec_value_id==c.id},l))}),c.push(o)});var l=[];return angular.forEach(e,function(e,t){var o,i={name:e.spec_name,item:c[t],cur:""};angular.forEach(i.item,function(e){if(1==e.selected)return void(o=e)}),o&&(i.cur=o.specVal),l.push(i)}),angular.forEach(l,function(e,t){l[t].isColor="颜色"==e.name}),l},n.prototype.isSoldout=function(e,t,o){var e=[].concat(e),i=!0;return $.each(e,function(e,r){if(r.attr_info&&r.attr_info[t]&&r.attr_info[t].spec_value_id==o&&r.in_stock&&3==r.sale_status)return i=!1,!1}),i},n.prototype.isExist=function(e,t,o,i){var r=this,a=[].concat(e),s=[],n=!0;return $.each(t.attr_info,function(e,t){t.spec_id==o&&t.spec_value_id!=i?s.push({key:o,value:i}):s.push({key:t.spec_id,value:t.spec_value_id})}),$.each(s,function(e,t){if(a=r.findSkus(a,t.key,t.value,"isExist"),!a.length)return n=!1,!1}),n},n.prototype.findSkus=function(e,t,o,i){var e=[].concat(e),r=[];return $.each(e,function(e,i){i.attr_info&&i.attr_info[t]&&i.attr_info[t].spec_value_id==o&&r.push(i)}),r},n.prototype.getSpuList=function(i,s,n){var c=t.defer(),l=this,u=e.isMobile?2:4,d={page_size:20};return i&&(d.category_id=i),s&&(d.page=s),n&&(d.sort=n),o.getSpusList(d).then(function(e){var t={spu:{list:[]}};if(!e.code&&e.data){var o=e.data;if(i){var s=u-o.list.length%u,n=a.getQHCoversSkus();angular.forEach(o.list,function(e){var o=e.sku_info,i=e.shop_info.spec_v2,a=_.findIndex(i,{spec_id:"1"}),s=!!e.product_info&&!!parseInt(e.product_info.is_package),c="",u={},d=[],p=!1;angular.forEach(o,function(e){p||(c=e.sku_id),a>=0&&angular.forEach(i[a].spec_values,function(t){e.color_id==t.id&&t.image&&_.indexOf(d,e.color_id)<0&&(_.indexOf(n,e.sku_id)>=0?e.sku_type="qh":(e.spec_image=r.imgUrl+t.image,e.sku_type="normal",d.push(e.color_id)))}),u[e.sku_id]={sku_id:e.sku_id,price:e.price,direct_to_cart:e.direct_to_cart,image:e.ali_image?e.ali_image:e.image,isOSS:!!e.ali_image,spec_image:e.spec_image||"",sku_type:e.sku_type,color_id:e.color_id,is_package:s,targetUrl:"#/item/"+e.sku_id},p=!0}),d=null;var f=[];!s&&a>=0&&(f=l.sortBySpecColor(i[a].spec_values,u),f.length>0&&(c=f[0])),t.spu.list.push({id:e.id,title:e.shop_info.spu_title,sub_title:e.shop_info.spu_sub_title,sku:u,sort_spect:f,current:{sku_id:u[c].sku_id,sku_type:u[c].sku_type,price:u[c].price,image:u[c].image,isPackage:u[c].is_package,isOSS:u[c].isOSS,direct_to_cart:u[c].direct_to_cart,targetUrl:u[c].targetUrl}})}),s=s==u?0:s;for(var d=0,p=s;d<p;++d)t.spu.list.push({placeholder:!0});t.spu.sku_count=o.sku_count||0,t.spu.page_count=o.page_count||0}c.resolve(t)}else c.reject("网络异常!")},function(e){c.reject("网络异常!")}),c.promise},n.prototype.sortBySpecColor=function(e,t){var o=[];for(var i in e)for(var r in t)e[i].id==t[r].color_id&&o.push(t[r].sku_id);return o},n.prototype.getSpuListWithPromotion=function(e,o,i){var r=t.defer();return t.all([s.fetchPromotionBrief(),this.getSpuList(e,o,i)]).then(function(e){var t=e[0],o=e[1],i=null;angular.forEach(o.spu.list,function(e){var o=e.current;o&&(o.promos={});for(i in e.sku){if(1==o.promos.promo_type)break;for(var r in t)if(i in t[r]){if(o.promos={},1==t[r][i].type&&(o.promos.promo_tag=t[r][i].tag,o.promos.promo_title=t[r][i].title,o.promos.promo_type=t[r][i].type),5==t[r][i].type&&(o.promos.promo_tag=t[r][i].tag,o.promos.promo_title=t[r][i].title,o.promos.promo_type=t[r][i].type,o.promos.discountPrice=t[r][i].discountPrice,o.promos.hasDiscount=!0),angular.forEach(t[r],function(t,o){1==t.type&&i==o?(e.sku[i].give={},e.sku[i].give=angular.extend({promo_tag:t.tag,promo_type:t.type,promo_title:t.title})):5==t.type&&i==o&&(e.sku[i].discount={},e.sku[i].discount=angular.extend({promo_tag:t.tag,promo_type:t.type,promo_title:t.title,discountPrice:t.discountPrice,hasDiscount:!0}))}),o.sku_id=i,o.image=e.sku[i].image,o.price=e.sku[i].price,e.sku[i].spec_image)e.current.targetUrl=e.sku[i].targetUrl;else for(var a in e.sku)if(e.sku[i].color_id===e.sku[a].color_id&&e.sku[a].spec_image){e.sku[i].spec_image=e.sku[a].spec_image,e.sku[i].sku_type=e.sku[a].sku_type,e.current.targetUrl=e.sku[i].targetUrl,e.sku[a].spec_image="",e.sku[a].sku_type="";break}if(1==o.promos.promo_type)break}}}),r.resolve(o)}),r.promise},n.prototype.getSkuListForQH=function(i,r,a){var s={page_size:20};i&&63==i&&(s.page_size=10),i&&(s.category_id=i),r&&(s.page=r),a&&(s.sort=a);var n=e.isMobile?2:4;return o.getSkusInfo(s).then(function(e){var o,r=t.defer();if(e.code)r.reject("网络异常!");else{if(o=e.data,i&&63!=i&&67!=i){var a=n-o.list.length%n;a=a==n?0:a;for(var s=0,c=a;s<c;s++)o.list.push({placeholder:!0})}r.resolve(o)}return r.promise},function(e){})},n.prototype.getCurrentSku=function(e,t){var o={},e=[].concat(e);return $.each(e,function(e,i){if(i.id==t)return o=i,!1}),o},n.prototype.getUpdateSkuID=function(e,t,o,i){var r,a=this,s=[].concat(e),n=[],c="";return $.each(t.attr_info,function(e,t){e!=o&&n.push({specId:e,specVal:t.spec_value_id})}),n.unshift({specId:o,specVal:i}),$.each(n,function(e,t){r=a.findSkus(s,t.specId,t.specVal),r.length>0&&(s=r)}),s.length&&(c=s[0].id),c},new n}]),appsServices.factory("MobileFittingService",["$q","MobileGoodsService","StoreConfig","GoodsService",function(e,t,o,i){function r(){var e=this;e.type={},e.UserService=null,e.MobileGoodsService=null,e.StorageService=null,e.CartService=null}return r.prototype.headset=function(e){var o={},i=[],r=t.modelHeadset(),a=t.mapHeadset;switch(e){default:i=[100013614,100013610,100013612,100013608,100013618,100013616],o={version:[{value:"bass",label:"低频增强版",lessLabel:"增强版"},{value:"three",label:"三段式均衡版",lessLabel:"均衡版"}],color:[{value:"black",label:"黑色"},{value:"red",label:"红色"},{value:"beige-white",label:"米白色"}]}}return{skus:i,params:o,listHeadset:r,mapHeadset:a}},r.prototype.cover=function(e){var i,r,a={},s=[],n=[],c=t.mapCovers,l=100;switch(e){case"youth":n=t.modelCover().nuts,s=[100010606,100010604,100010603,100010602,100010601,100010607,100010605,100010608],a=[{value:"red",label:"红色"},{value:"orange",label:"橙色"},{value:"yellow",label:"黄色"},{value:"green",label:"绿色"},{value:"light-blue",label:"青色"},{value:"blue",label:"蓝色"},{value:"purple",label:"紫色"},{value:"white",label:"白色"}],r="背壳",l=49,i=o.useGoodsDiscount?{num:o.goodsDiscount.cover.num,discount:o.goodsDiscount.cover.discount}:null;break;case"art":n=t.modelCover().nuts,s=[100013707,100013703,100013702,100013706,100013705,100013704,100013708,100013701],a=[{value:"bone",label:"远州鼠"},{value:"coffee",label:"落栗"},{value:"rose",label:"苏芳"},{value:"pink",label:"石竹"},{value:"sand",label:"枯草"},{value:"olive",label:"柳煤竹茶"},{value:"grass",label:"锖青磁"},{value:"violet",label:"鸠羽紫"}],r="背壳",l=49,i=o.useGoodsDiscount?{num:o.goodsDiscount.cover.num,discount:o.goodsDiscount.cover.discount}:null;break;case"t2":n=t.modelCover().t2,s=[100014901,100014902],a=[{value:"black",label:"黑色"},{value:"red",label:"红色"}],r="保护套",l=49}return{skus:s,coverName:r,price:l,params:a,listCover:n,mapCover:c,discountData:i}},r.prototype.getFitting=function(e,t){var o=this,r={fittingStock:!1,headset:{},cover:{}},a=[];switch(e){case"nuts":switch(a=["headset:1"],t){case"youth":a.push("cover:youth");break;case"art":a.push("cover:art")}break;case"t2":a=["headset:1","cover:t2"];break;case"m1l":case"m1":a=["headset:m1","cover:m1"];break;default:a=[]}if(a.length){for(var s,n=[],c={},l={},u=0,d=a.length;u<d;u++){var p=a[u].split(":")[0],f=a[u].split(":")[1],m=angular.isFunction(o[p])&&o[p](f);m&&(n=n.concat(m.skus),c[p]={fittingCategory:p,fittingVersion:f,fittingData:m})}return i.getSkuListWithStock(n).then(function(e){if(e&&e.list.length){s=e.list;for(var t=0,i=s.length;t<i;t++)s[t].max=s[t].shop_info.limit_num||5,l[s[t].id]=s[t]}return $.each(c,function(e,t){switch(e){case"cover":r.cover=o.parseCoverData(t,l),!!r.cover.stock&&(r.fittingStock=!0);break;case"headset":r.headset=o.parseHeadsetData(t,l),!!r.headset.stock&&(r.fittingStock=!0)}}),r})}return r},r.prototype.parseHeadsetData=function(e,o){var i=e.fittingData.params,r=e.fittingData.mapHeadset,a={stock:!1,curData:{},listData:{}},s=t.mapHeadset;return $.each(i.version,function(e,t){$.each(i.color,function(e,i){var n=_.find(r,function(e){return e.version==t.value&&e.color==i.value&&"line"==e.ctrl});if(n){angular.isArray(a.listData[t.value])||(a.listData[t.value]=[]);var c=o[n.sku];if(c){var l=3==c.sale_status&&c.in_stock,u=$.extend({},n,c,{stock:l});a.listData[t.value].push(u),!a.curData.sku&&l&&(a.curData=u),!!l&&(a.stock=!0),s[n.sku]&&(s[n.sku].shop_info=c.shop_info)}}})}),a},r.prototype.parseCoverData=function(e,o){var i=e.fittingData.params,r=(e.fittingData.mapCover,e.fittingData.listCover),a={},s={stock:!1,listData:[],curData:{},coverName:e.fittingData.coverName,price:e.fittingData.price,discountData:e.fittingData.discountData},n=t.mapCovers;return $.each(r,function(e,t){a[t.color]=t}),$.each(i,function(e,t){var i=a[t.value].sku,r=o[i],c=3==r.sale_status&&r.in_stock,l=$.extend({},a[t.value],r,{stock:c});s.listData.push(l),!s.curData.sku&&c&&(s.curData=l),!!c&&(s.stock=!0),n[i]&&r.shop_info&&(n[i].shop_info=r.shop_info)}),s},new r}]),appsServices.factory("OrderService",["$q","StorageService",function(e,t){function o(){self.OrderParseService=null,self.CartService=null,self.OrderCollection=null,self.StorageService=null}return o.prototype.createTempOrder=function(o){var i=this,r="eo"+(new Date).getTime(),a=[],s=[];$.each(o.carts,function(e,t){s.push(t.id+":"+t.num)}),o.mobileGoods&&$.each(o.mobileGoods,function(e,t){var o=[t.id];!!t.warranty&&o.push(t.warranty),o.push(t.num),a.push(o.join(":"))});var n={id:r,mobileGoods:a.join(","),goods_infos:s.join(","),suitGoods:o.suitGoods||""};i.removeCache(function(){t.set(r,n,{useCookie:!0,domain:".smartisan.com"})});var c=e.defer();return c.resolve(n),c.promise},o.prototype.completeTempOrder=function(o){var i=this,r=$.extend({},o,{mobileGoods:[o.mobile_id]});r.id=r.id||"to"+(new Date).getTime(),o.safety1&&r.mobileGoods.push(o.safety1),o.safety2&&r.mobileGoods.push(o.safety2),r.mobileGoods.push(1),r.mobileGoods=r.mobileGoods.join(":"),i.removeCache(function(){t.set(orderID,r,{useCookie:!0,domain:".smartisan.com"})});var a=e.defer();return a.resolve(r),a.promise},o.prototype.removeCache=function(e){var o=$.cookies.filter("^eo"),i=new Date;i.setTime(i.getTime()-1),$.each(o,function(e,o){t.remove(e,{domain:".smartisan.com",expires:i})}),"function"==typeof e&&e()},new o}]),appsServices.factory("NutsService",["$q","Config","$filter","MobileGoodsService","CartRequest","CategoryService",function(e,t,o,i,r,a){function s(){var e=this;e.type={},e.UserService=null,e.MobileGoodsService=null,e.StorageService=null,e.CartService=null,e.mapStock={},e.mobileSkus=n}var n=["100007303","100007304","100007305","100007306","100007307","100007308","100007309","100007310","100007311","100007312","100007313","100007314","100007317","100007318","100007319","100007320","100015803","100015804","100007315","100007316","100015801","100013101","100013102","100013103","100013104","100013105","100013106","100013107","100013108","100015901"];return s.prototype.getMobilesStock=function(t){var o=this,a=t||[].concat(n).join(","),s=!0,c=a.split(",");return $.each(c,function(e,t){if(void 0==o.mapStock[t])return s=!1,!1}),r.getSkusInfo({ids:a,with_spu:!0,with_stock:!0}).then(function(t){var r,a=e.defer(),s=[],n=i.nuts(),c={};return t.code?a.reject("网络延迟"):(r=t.data,$.each(r.list,function(e,t){c[t.id]={stock:t.in_stock,price:t.price,image:t.shop_info.ali_image?t.shop_info.ali_image:t.shop_info.image,isOSS:!!t.shop_info.ali_image}}),$.each(n,function(e,t){var o=_.findIndex(r.list,{id:parseInt(t.sku)});o!=-1&&(t.price=r.list[o].price),s.push($.extend({},t,c[t.sku]))}),i.formatMobileData({nuts:s}),o.mapStock=$.extend(o.mapStock,c),a.resolve(o.mapStock)),a.promise},function(e){return!1})},s.prototype.pageParams=function(e){var t={edition:[{value:"netcom",label:"全网通"},{value:"all",label:"公开版"}],version:[{value:"normal",label:"标准版"},{value:"young",label:"文艺青年版"},{value:"black",label:"黑色版"}],color:[{version:"normal",value:"red",label:"红色"},{version:"normal",value:"orange",label:"橙色"},{version:"normal",value:"yellow",label:"黄色"},{version:"normal",value:"green",label:"绿色"},{version:"normal",value:"light-blue",label:"青色"},{version:"normal",value:"blue",label:"蓝色"},{version:"normal",value:"purple",label:"紫色"},{version:"normal",value:"gray",label:"灰色"},{version:"young",value:"bone",label:"远州鼠"},{version:"young",value:"coffee",label:"落栗"},{version:"young",value:"rose",label:"苏芳"},{version:"young",value:"pink",label:"石竹"},{version:"young",value:"sand",label:"枯草"},{version:"young",value:"olive",label:"柳煤竹茶"},{version:"young",value:"grass",label:"锖青磁"},{version:"young",value:"violet",label:"鸠羽紫"},{version:"black",value:"black",label:"黑色"}],capacity:[{value:"16GB",label:"16GB",price:"699"},{value:"32GB",label:"32GB",price:"799"}]},o=$.extend({},t);return"netcom"==e&&(o.color=[{version:"normal",value:"gray",label:"灰色"},{version:"young",value:"bone",label:"远州鼠"},{version:"black",value:"black",label:"黑色"}],o.capacity=[{value:"16GB",label:"16GB",price:"799"},{value:"32GB",label:"32GB",price:"899"}]),o},s.prototype.getSkuByCategory=function(e){var t=i.mapPhones,o={defChoose:void 0},r={netcom:{normal:["100015803","100015804"],young:["100015901"],black:["100015801"]},all:{normal:["100007311","100007312","100007307","100007308","100007305","100007306","100007303","100007304","100007317","100007318","100007313","100007314","100007309","100007310","100007319","100007320"],young:["100013101","100013102","100013103","100013104","100013105","100013106","100013107","100013108"],black:["100007315","100007316"]}};return $.each(r,function(i,r){o[i]={},$.each(r,function(r,a){$.each(a,function(a,s){if(!o[i][r]&&e[s]&&e[s].stock)return o[i][r]=t[s],o[i].hasStock=t[s],o.defChoose||(o.defChoose=t[s]),!1})})}),o},s.prototype.getPageParams=function(e,t){var o=this,r=i.nuts(),a=(i.mapPhones,{edition:[],version:[],color:[],allStock:!1,curMobile:void 0});return o.getMobilesStock().then(function(i){var s={},n={};a.defChooseMobileData=o.getSkuByCategory(i),$.each(r,function(e,t){i[t.sku]&&i[t.sku].stock&&(s[t.edition]=!0,n[t.version]=!0,a.allStock=!0)}),a.allStock&&(e?a.curMobile=a.defChooseMobileData.netcom[e]||a.defChooseMobileData.all[e]:a.curMobile=a.defChooseMobileData.defChoose);var c=o.pageParams(t);$.each(c.edition,function(e,t){a.edition.push($.extend({},t,{stock:s[t.value]}))}),$.each(c.version,function(e,t){a.version.push($.extend({},t,{stock:n[t.value]}))}),a.allColor=[].concat(c.color);var l=o.getNutsParams(e);return a.color=l.color,a.capacity=l.capacity,a})},s.prototype.getNutsParams=function(e,t){var o=this,e=e||"normal",t=t||{},r=o.pageParams(t.edition),a=i.nuts(),s=(i.mapPhones,[]),n={},c={},l=[],u=[];if(t.edition&&t.version){var d={edition:t.edition,version:t.version};s=_.where(a,d),$.each(s,function(e,t){o.mapStock[t.sku]&&o.mapStock[t.sku].stock&&(!n[t.color]&&(n[t.color]={}),!c[t.color]&&(c[t.color]={}),n[t.color][t.capacity]=!0,c[t.color][t.capacity]=o.mapStock[t.sku].price)})}return $.each(r.color,function(o,i){i.version==e&&l.push($.extend(i,{stock:n[i.value],selected:n[i.value]&&i.value==t.color}))}),("young"==e||"netcom"==t.edition&&"black"==e)&&r.capacity.shift(),$.each(r.capacity,function(e,o){c[t.color]&&c[t.color][o.value]&&(o.price=c[t.color][o.value]),u.push($.extend(o,{stock:n[t.color]&&n[t.color][o.value],selected:n[t.color]&&n[t.color][o.value]&&o.value==t.capacity}))}),r.color=l,r.capacity=u,r},s.prototype.specMap=function(){var e={storage:{title:"容量和内存",youth:"16 / 32 GB 高速闪存",art:"32 GB 高速闪存",black:"16 / 32 GB 高速闪存",memory:"2 GB 内存"},color:{title:"颜色",youth:"红、橙、黄、绿、青、蓝、紫、灰",art:"遠州鼠",black:"黑色"},dimensions:{title:"机身尺寸和重量",num_height:"152.9 mm",num_width:"76.9 mm",num_thickness:"9.0 mm",text_height:"高度：152.9 mm",text_width:"宽度：76.9 mm",text_thickness:"厚度：9.0 mm",text_weight:"重量：约 155 g"},cpu:{title:"处理器",desc:"Qualcomm<sup>®</sup> 骁龙™ 615 ( MSM8939 ) 处理器",desc1:"ARM<sup>®</sup> cortex™ - A53 1.5 GHz x 4 +",
desc2:"ARM<sup>®</sup> cortex™ - A53 1.0 GHz x 4"},gpu:{title:"图形处理器",desc:"Adreno™ 405 550MHz 图形处理器"},cellular:{title:"蜂窝网络",yidong_h3:"公开版",table:'<tr><th colspan="3" class="n0">网络制式</th><th>支持频段</th></tr><tr><td rowspan="2" class="eq-0">4G</td><td class="eq-1">联通</td><td class="eq-2">FDD-LTE</td><td>B1 / B3 / B7</td></tr><tr><td>移动</td><td>TDD-LTE</td><td>B38 / B39 / B40 / B41 <span>( 注：B41 仅支持中国频段 )</span></td></tr><tr><td rowspan="2">3G</td><td>联通</td><td>WCDMA</td><td>B1 / B2 / B5 / B8</td></tr><tr><td>移动</td><td>TD-SCDMA</td><td>B34 / B39</td></tr><tr><td class="n1">2G</td><td class="n2">移动/联通</td><td class="n3">GSM</td><td>B2 / B3 / B5 / B8</td></tr>',sim1:"SIM 1 卡槽：支持 移动/联通 2G/3G/4G",sim2:"SIM 2 卡槽：仅支持 移动/联通 2G",dianxin_h3:"电信版",dianxin_table:'<tr><th colspan="3" class="n0">网络制式</th><th>支持频段</th></tr><tr><td rowspan="3" class="eq-0">4G</td><td rowspan="2" class="eq-1">电信</td><td class="eq-2">TDD-LTE</td><td>B41</td></tr><tr><td>FDD-LTE</td><td>B1 / B3 / B7 <span>（注：FDD-LTE 制式仅支持电信要求频段）</span></td></tr><tr><td>移动</td><td>TDD-LTE</td><td>B38 / B39 / B40 / B41</td></tr><tr><td rowspan="2">3G</td><td>电信</td><td>EVDO</td><td>BC0</td></tr><tr><td>移动</td><td>TD-SCDMA</td><td>B34 / B39</td></tr><tr><td class="n21" rowspan="2">2G</td><td class="n22">电信</td><td class="n23">CDMA 1X</td><td class="n24">BC0</td></tr><tr><td>移动/联通</td><td>GSM</td><td>B2 / B3 / B5 / B8</td></tr>',dianxin_sim1:"SIM 1 卡槽：支持 电信/移动 2G/3G/4G 联通 2G",dianxin_sim2:"SIM 2 卡槽：仅支持 移动/联通 2G",quanwangtong_h3:"全网通版",quanwangtong_table:'<tr><th colspan="3" class="n0">网络制式</th><th>支持频段</th></tr><tr><td rowspan="4" class="eq-0">4G</td><td>移动</td><td>TDD-LTE</td><td>B38 / B39 / B40 / B41</td></tr><tr><td>联通</td><td>FDD-LTE</td><td>B1 / B3 / B7</td></tr><tr><td rowspan="2" class="eq-1">电信</td><td class="eq-2">TDD-LTE</td><td>B41</td></tr><tr><td>FDD-LTE</td><td>B1 / B3 / B7</td></tr><tr><td rowspan="3">3G</td><td>移动</td><td>TD-SCDMA</td><td>B34 / B39</td></tr><tr><td>联通</td><td>WCDMA</td><td>B1 / B2 / B5 / B8</td></tr><tr><td>电信</td><td>EVDO</td><td>BC0</td></tr><tr><td class="n21" rowspan="2">2G</td><td>移动/联通</td><td>GSM</td><td>B2 / B3 / B5 / B8</td></tr><tr><td class="n22">电信</td><td class="n23">CDMA 1X</td><td class="n24">BC0</td></tr>',quanwangtong_sim1:"SIM 1 卡槽：支持 移动/联通/电信 2G/3G/4G",quanwangtong_sim2:"SIM 2 卡槽：仅支持 移动/联通 2G"},wireless:{title:"无线网络",wireless:"802.11 b/g/n 无线网络，支持 2.4 GHz 频段",bluetooth:"蓝牙 4.0",nfc:"NFC"},display:{title:"屏幕",display:"5.5 英寸 TFT 显示屏",resolution:"1920 x 1080 像素分辨率，403 PPI",contrast:"1000:1 对比度（标准）",brightness:"400 cd/m<sup>2</sup> 最大亮度（标准）",kang:"康宁<sup>®</sup>第三代大猩猩<sup>®</sup>玻璃"},frontCamera:{title:"前置摄像头",desc1:"500 万像素",desc2:"ƒ/2.2 光圈，等效焦距约 25mm 镜头"},rearCamera:{title:"主摄像头",desc1:"1300 万像素",desc2:"ƒ/2.2 光圈，等效焦距约 28mm 镜头",desc3:"LED 闪光灯"},audioPlayback:{title:"音频播放",desc1:"支持声音文件格式：MP3，M4A，AAC，AMR",desc2:"支持无损格式：ALAC ( Apple Lossless )，FLAC，APE，WAV ( 最高支持 192-KHz/24-bits ) ，AIFF",desc3:"支持声音解码格式：AAC/AAC+/eAAC+，MP3"},videoPlayback:{title:"视频播放",desc1:"支持的视频格式：",desc2:"H.264 视频，支持 1080p，60 fps，High Profile Level 4.2 和 AAC-LC/MP3 音频，文件格式为 .mp4，.avi，.mkv，.webm，.3gp",desc3:"MPEG4-ASP 视频，最高可达 1080p，60 fps，Level 5，Simple Profile，最高可达 1080p，60 fps，Level 8，AAC-LC 音频，文件格式为 .mp4",desc4:"H.263 视频，最高可达 864 x 480，Level 70，30 fps，AAC-LC 音频，文件格式为 .mp4"},keysPorts:{title:"按钮和接口",mode1:"开机设置为左手模式时",mode2:"开机设置为右手模式时",onOff:'长按 <span class="emphasis">开机 / 关机</span>',lock:'短按 <span class="emphasis">唤醒 / 锁屏</span>',volume:"音量调节",brightness:"可自定义键",back:"返回<br /><i>BACK</i>",home:"桌面<br /><i>HOME</i>",menu:"菜单<br /><i>MENU</i>",jack:"3.5mm 耳机接口",topSide:"顶部",usb:"Micro-USB 接口",bottomSide:"底部"},battery:{title:"电池",desc:"内置 2900 mAh 锂聚合物充电电池"},sensors:{title:"传感器",desc1:"陀螺仪",desc2:"重力传感器",desc3:"地磁传感器",desc4:"环境光传感器",desc5:"距离传感器"},os:{title:"操作系统",desc1:"基于 Android™ 深度定制的 Smartisan OS",desc2:"支持语言：中文简体、中文繁体（台湾）、英语、日语、韩语",desc3:"注：部分系统功能需要 Smartisan ID 与互联网连接"},builtIn:{title:"内置应用",icons:[{className:"phone",label:"电话"},{className:"music",label:"音乐"},{className:"messages",label:"短信"},{className:"calendar",label:"日历"},{className:"clock",label:"时钟"},{className:"notes",label:"便签"},{className:"recorder",label:"录音机"},{className:"mail",label:"邮件"},{className:"market",label:"应用商店"},{className:"game-center",label:"游戏中心"},{className:"browser",label:"浏览器"},{className:"gallery",label:"相册"},{className:"settings",label:"设置"},{className:"calculator",label:"计算器"},{className:"camera",label:"相机"},{className:"weather",label:"天气"},{className:"search",label:"搜索"},{className:"voice-assistant",label:"语音搜索"},{className:"downloads",label:"下载"},{className:"security-center",label:"安全中心"},{className:"cloud",label:"欢喜云服务"},{className:"bbs",label:"锤子科技论坛"}],remark:"“内置应用”是系统内建的为用户提供智能手机基本功能的应用程序，包括但不限于以上列举的锤子科技自主开发及与软件提供商共同研发的内建程序（如触宝输入法定制版、讯飞语音＋等）。为确保手机的正常使用，除锤子科技论坛外的所有内置应用均无法卸载。"},preloaded:{title:"预装第三方应用",remark:"你在首次使用坚果手机（ OS v2.0.4 ）时，如果发现手机中的应用与以上列表中的内置应用和预置第三方应用的数量、名称或图标有任何不同，则说明该手机的软件系统被除锤子科技（包括其关联公司）之外的其他方改动过。此种改动可能给你的手机带来病毒、系统不稳定、被植入广告或被偷偷盗取费用等不良影响。你可以联系你购买手机的经销商解决此类问题，也欢迎给 report@smartisan.com 发邮件向我们检举经销商，如果是我们的正式授权经销商，我们会严肃处理。但手机可能会由于不可控的因素落入非正规销售商甚至是职业黄牛手中，对于这种情况，我们无法控制，所以锤子科技对于非官方或非授权经销商售出手机的软件系统的人为改动，将不承担赔偿损失、免费维修等任何形式的责任。",icons:{weibo:"微博",wechat:"微信",zhifubao:"支付宝",momo:"陌陌",airdroid:"AirDroid",wpsOffice:"WPS Office",youku:"优酷视频",amap:"高德地图",youdao:"网易有道词典",dingxiang:"丁香医生",tencenVideo:"腾讯视频",mafengwo:"蚂蜂窝自由行",douban:"豆瓣",ireader:"掌阅iReader",qunar:"去哪儿旅行",neteaseNewsreader:"网易新闻",meituan:"美团",dianping:"大众点评",didi:"滴滴打车",daxiang:"大象公会"}},sim:{title:"SIM 卡",desc:"Micro-SIM 卡"},packagingContents:{title:"包装内容",desc1:"坚果手机",desc2:"USB 线缆及集线器",desc3:"充电器",desc4:"坚果手机产品使用说明书",desc5:"坚果手机三包凭证",desc6:"电子信息产品有害物质说明"},remarks:{desc1:'注：<br class="mobile">1. 本页面所列配置及参数均以实际上市产品为准，如有变更，恕不另行通知；',desc2:"2. Android™ is a trademark of Google Inc."}};return $.extend({},e)},new s}]),appsServices.factory("T2Service",["$q","Config","$filter","MobileGoodsService","CartRequest","StorageService",function(e,t,o,i,r,a){function s(){var e=this;e.type={},e.UserService=null,e.MobileGoodsService=null,e.StorageService=null,e.CartService=null,e.mapStock={},e.mobileSkus=n}var n=["100014501","100014502"];return s.prototype.getMobilesStock=function(t){var o=this,a=t||[].concat(n).join(","),s=!0,c=a.split(",");return $.each(c,function(e,t){if(void 0==o.mapStock[t])return s=!1,!1}),r.getSkusInfo({ids:a,with_spu:!0,with_stock:!0}).then(function(t){var r,a=e.defer(),s=[],n=i.t2(),c={};return t.code?a.reject("网络延迟"):(r=t.data,$.each(r.list,function(e,t){c[t.id]={stock:t.in_stock,price:t.price,image:t.shop_info.ali_image?t.shop_info.ali_image:t.shop_info.image,isOSS:!!t.shop_info.ali_image}}),$.each(n,function(e,t){var o=_.findIndex(r.list,{id:parseInt(t.sku)});o!=-1&&(t.price=r.list[o].price,t.buy_notes=r.list[o].spu.shop_info.buy_notes),s.push($.extend({},t,c[t.sku]))}),i.formatMobileData({t2:s}),o.mapStock=$.extend({},o.mapStock,c),a.resolve(o.mapStock)),a.promise},function(e){return!1})},s.prototype.getPageParams=function(e,t){var o=this,r=[].concat(i.t2()),a=(i.mapPhones,{allColor:null,allStock:!1,curMobile:void 0});return o.getMobilesStock().then(function(i){a.defChooseMobileData=o.getSkuByCategory(i),$.each(r,function(e,t){i[t.sku]&&i[t.sku].stock&&(r[e].stock=!0,a.allStock=!0)}),a.allStock&&e?a.curMobile=a.defChooseMobileData.netcom[e]||a.defChooseMobileData.all[e]:a.curMobile=a.defChooseMobileData.defChoose;var s=o.pageParams(t);a.allColor=[].concat(s.color);var n=o.getT2Params(e);return a.t2List=r,a.color=n.color,a.capacity=n.capacity,a})},s.prototype.getT2Params=function(e,t){var o=this,e=e||"normal",t=t||{},r=o.pageParams(t.edition),a=i.t2(),s=(i.mapPhones,[]),n={},c={},l=[],u=[];if(t.edition&&t.version){var d={edition:t.edition,version:t.version};s=_.where(a,d),$.each(s,function(e,t){o.mapStock[t.sku]&&o.mapStock[t.sku].stock&&(!n[t.color]&&(n[t.color]={}),n[t.color][t.capacity]=!0),!c[t.color]&&(c[t.color]={}),c[t.color][t.capacity]=o.mapStock[t.sku].price})}return $.each(r.color,function(o,i){i.version==e&&l.push($.extend(i,{stock:n[i.value],selected:n[i.value]&&i.value==t.color}))}),$.each(r.capacity,function(e,o){c[t.color]&&c[t.color][o.value]&&(o.price=c[t.color][o.value]),u.push($.extend(o,{stock:n[t.color]&&n[t.color][o.value],selected:n[t.color]&&n[t.color][o.value]&&o.value==t.capacity}))}),r.color=l,r.capacity=u,r},s.prototype.pageParams=function(e){var t={edition:[{value:"netcom",label:"全网通"}],version:[{value:"normal",label:"标准版"}],color:[{version:"normal",value:"black",label:"黑色"}],capacity:[{price:"2499",value:"16GB",label:"16GB"},{price:"2599",value:"32GB",label:"32GB"}]},o=$.extend({},t);return o},s.prototype.getSkuByCategory=function(e){var t=i.mapPhones,o={defChoose:void 0},r={netcom:{normal:["100014501","100014502"]}};return $.each(r,function(i,r){o[i]={},$.each(r,function(r,a){$.each(a,function(a,s){if(!o[i][r]&&e[s]&&e[s].stock)return o[i][r]=t[s],o[i].hasStock=t[s],o.defChoose||(o.defChoose=t[s]),!1})})}),o.defChoose||(o.defChoose=t[r.netcom.normal[0]]),o},new s}]),appsServices.factory("M1Service",["$rootScope","$location","$route","$q","CartRequest","StoreConfig","Config","MobileGoodsService",function(e,t,o,i,r,a,s,n){var c={},l=null,u={reformPackageData:function(e){var t,o=[];if(e&&e.length>0)for(var i=0;i<e.length;++i)for(var r=e[i].package_id,a=0;a<e[i].package_goods.length;++a)for(var s=0,t=e[i].package_goods[a].length;s<t;++s)o.push(r+":"+e[i].package_goods[a][s].sku_id);return o.join(",")},reformPackageGoodsStock:function(e){if(_.size(e)>0){for(var t={},o=null,i=0,r=e.length;i<r;++i)o=e[i].package_id,t[o]||(t[o]={}),t[o][e[i].sku_id]=e[i].stock;return t}},reformMobileGoodsWithStock:function(e,t,o){var i=null,r=[],a=null,s={};for(var n in o)for(var c=t[e][n].packageInfo,l=0,u=c.length;l<u;++l){var d={},p={};d.packageId=c[l].package_id,d.packagePrice=c[l].package_price,d.packageTitle=c[l].package_title,d.packageSubTitle=c[l].package_sub_title,d.goods=[],d.packageStock=!1,angular.forEach(o[n],function(e,t){c[l].package_id===t&&angular.forEach(c[l].package_goods,function(t){a={},s={},s.currSku={},s.skus=[];for(var o in t)i=t[o].sku_id,Number(e[i])>=0&&(t[o].stockNum=e[i]),s.skus.push({skuId:t[o].sku_id,image:t[o].image,title:t[o].title,subTitle:t[o].sub_title,colorImg:t[o].color,stockNum:t[o].stockNum||0}),0===_.size(s.currSku)&&(t[o].stockNum?(s.currSku={skuId:t[o].sku_id,image:t[o].image,title:t[o].title,subTitle:t[o].sub_title,colorImg:t[o].color,stockNum:t[o].stockNum},d.packageStock=!0):0===_.size(a)&&(a={skuId:t[o].sku_id,image:t[o].image,title:t[o].title,subTitle:t[o].sub_title,colorImg:t[o].color,stockNum:0}));0===_.size(s.currSku)&&(d.packageStock=!1,s.currSku=a,a=null),p=s,s=null,d.goods.push(p)})}),r.push(d)}return r},reformAccessoriesInfo:function(e){var t={},o=null,i=[],r=null,a=[],s={};return e&&(angular.forEach(e,function(e){o={},r=e.shop_info.spec_v2;for(var s=0,n=r.length;s<n;++s)if(1==r[s].spec_id){a=r[s].spec_values;break}angular.forEach(e.sku_info,function(e){angular.forEach(a,function(t){t.id==e.color_id&&(e.colorImg=t.image,e.colorName=t.show_name)}),o[e.sku_id]={skuId:e.sku_id,title:e.title,subTitle:e.sub_title,image:e.ali_image?e.ali_image:e.image,isOSS:!!e.ali_image,price:e.price,num:1,colorImg:e.colorImg||"",colorName:e.colorName},i.push(e.sku_id)}),t[e.id]={spuId:e.id,title:e.shop_info.spu_title,subTitle:e.shop_info.spu_sub_title,saleStatus:e.sale_status,skus:o}}),s={spus:t,allSkus:i}),s},accessoriesStockBySort:function(e,t,o,i){var r=[],s=a.accessoriesSpus[i];angular.forEach(o,function(o){e[o.spu_id]&&(_.indexOf(t,o.id.toString())>-1?(e[o.spu_id].skus[o.id].inStock=o.in_stock,e[o.spu_id].skus[o.id].price=Number(o.price).toString()):delete e[o.spu_id].skus[o.id])}),angular.forEach(e,function(t,o){var i=!1;for(var r in t.skus)if(t.skus[r].inStock){i=!0,t.curr=t.skus[r];break}i&&3==t.saleStatus||delete e[o]});for(var n in s)e[s[n]]&&r.push(e[s[n]]);return r},reformMobileBasicData:function(e,t){var o,i=c[t];angular.forEach(e.data.list,function(e){o=e.id.toString(),i[e.id].inStock=e.in_stock||!1,i[e.id].spu=e.spu_id.toString(),i[e.id].saleStatus=e.sale_status,i[e.id].price=e.price?e.price:i.price,i[e.id].totalPrice=e.price?e.price:i.price,i[e.id].image=e.shop_info.ali_image?e.shop_info.ali_image:e.shop_info.image,i[e.id].isOSS=!!e.shop_info.ali_image,i[e.id].packageInfo=e.package_info,i[e.id].buy_notes=e.spu.shop_info.buy_notes})}},d={getMobileInfoWithPackageStock:function(o){var s=this,d=i.defer(),p=n.getMobileSkus(),f=p[o],m=n.mapNormalM1,g=angular.extend({},n.mapNormalM1L,n.mapSeniorM1L);return c={m1:m,m1l:g},e.$watch("isLoggedIn",function(){e.isLoggedIn!==!0&&e.isLoggedIn!==!1||i.all([r.getSkusInfo({ids:f.join(","),with_stock:!0,with_spu:!0}),r.getReminder({goods_id:f.join(",")})]).then(function(e){var i=e[0];if(l=e[1]&&0==e[1].code?e[1].data:[],0==i.code){var r=t.search();u.reformMobileBasicData(i,o),s.resolveUrlParams(o,r,function(e){a.usePackage?s.getPackGoodsStock(e.sku,e.packageInfo).then(function(t){var i=u.reformMobileGoodsWithStock(o,c,t);d.resolve({mobilesData:c,packageData:i,currMobile:e})},function(e){d.reject(e)}):(s.confirmSaleStatusWithPackageId(e,null),d.resolve({mobilesData:c,currMobile:e}))})}else d.reject("CartRequest.getSkusInfo code<>0")})}),d.promise},getPackGoodsStock:function(e,t){var o=i.defer(),a=u.reformPackageData(t),s={};return a?r.getStockList({ids:a}).then(function(t){0==t.code?(s[e]=u.reformPackageGoodsStock(t.data),o.resolve(s)):o.reject("CartRequest.getStockList 接口异常")}):o.resolve({}),o.promise},resolveUrlParams:function(e,t,o){if(c[e]){var i,r,a=c[e],s=null;if(t.v&&t.c){for(i in a)if(t.c===a[i].colorId&&t.v===a[i].versionId){a[i].packageInfo||(a[i].packageInfo=[]),s=a[i];break}if(0===_.size(s))for(i in a)if(t.c===a[i].colorId){a[i].packageInfo||(a[i].packageInfo=[]),s=a[i];break}}if(0===_.size(s)){var n=[],u=null;for(var d in a){if(a[d].inStock){switch(e){case"m1":"whiteA"===a[d].colorId&&"normal"===a[d].versionId&&(s=a[d]);break;case"m1l":"whiteA"===a[d].colorId&&"senior"===a[d].versionId&&(s=a[d])}u=a[d]}if(0===n.length)switch(e){case"m1":"whiteA"===a[d].colorId&&"normal"===a[d].versionId&&n.push(a[d]);break;case"m1l":"whiteA"===a[d].colorId&&"senior"===a[d].versionId&&n.push(a[d])}}0===_.size(s)&&(u?s=u:_.size(a)>0&&n.length&&(s=n[0]))}if(s.userRank={isReserve:!1,canBuy:!1},l&&l.length>0)for(var p=0,r=l.length;p<r;++p)if(l[p].sku===s.sku){l[p].id&&parseInt(l[p].id)>0?(s.userRank.isReserve=!0,1===l[p].can_buy?s.userRank.canBuy=!0:s.userRank.canBuy=!1):(s.userRank.isReserve=!1,s.userRank.canBuy=!1);break}return o(s)}},updateVersionInfoByColorId:function(e,o){var i="m1l"!==t.$$search.n?"m1":"m1l",r=c[i],a=[];return angular.forEach(r,function(t){t.colorId==e&&angular.forEach(o,function(e){e.versionId==t.versionId&&a.push(e)})}),a},updateCurrPackageGoodsBySkuId:function(e,t,o,i){var r=[],a=o||0;for(var s in e)if(e[s].goods&&e[s].packageId==t){r=e[s].goods[a].skus;for(var n in r)if(r[n].skuId==i){e[s].goods[a].currSku={colorImg:r[n].colorImg,image:r[n].image,skuId:r[n].skuId,stockNum:r[n].stockNum,subTitle:r[n].subTitle,title:r[n].title};break}break}},confirmSaleStatusWithPackageId:function(e,t){3==e.saleStatus?e.userRank.canBuy?e.inStock?e.labelMessage="现在购买":e.labelMessage="已售罄":e.labelMessage="即将开放":e.labelMessage="已下架"},getAccessoriesInfoWithStock:function(e){var t=i.defer(),o=a.accessoriesSpus[e],s=a.accessoriesSkus[e];return o.length?r.getSpusList({ids:o.join(",")}).then(function(o){var i=null,a={};o.data&&o.data.list&&(i=u.reformAccessoriesInfo(o.data.list),r.getSkusInfo({ids:i.allSkus.join(","),with_stock:!0}).then(function(o){o.data&&o.data.list&&(a=u.accessoriesStockBySort(i.spus,s,o.data.list,e),t.resolve(a))}))}):t.resolve({}),t.promise},getPromotionGiftsInfo:function(){var e=i.defer(),t=n.getMobileSkus().m1,o=n.getMobileSkus().m1l,a=t.concat(o);return r.getDiscountList().then(function(t){var o,i={},s=[];if(0===t.code){o=t.data&&t.data.list;for(var n=0;n<o.length;++n)angular.forEach(o[n].rule.condition.main_skus,function(e){for(var t=0;t<a.length;t++)if(e==a[t]){i[a[t]]={},i[a[t]].title=o[n].title,i[a[t]].totalPrice=0,i[a[t]].gifts=angular.extend({},o[n].rule.result.gift_skus,o[n].rule.gift_num),i[a[t]].rule=o[n].note.rule_text;for(var r in o[n].rule.result.gift_skus)_.indexOf(s,r)<0&&s.push(r)}});s.length>0?r.getSkusInfo({ids:s.join(",")}).then(function(t){if(0===t.code){for(var o,r=t.data.list,a={},s=0;s<r.length;++s)o=r[s].attr_info[1]?"（"+r[s].attr_info[1].value+"）":"",a[r[s].id]={title:r[s].shop_info.title+o,isSold:3==r[s].sale_status,price:r[s].price};for(var n in i)for(var c in i[n].gifts)a[c]&&(i[n].totalPrice+=Number(a[c].price))}e.resolve({mobilePromos:i,gifts:a})}):e.resolve({})}else e.resolve({})}),e.promise},submitNumberInfo:function(e,t){var o=i.defer();return e&&t?r.createReminder({mobile:e,goods_id:t}).then(function(e){var t=0==e.code;o.resolve(t)}):o.resolve(!1),o.promise},updateSkuReserved:function(e){var t;if(l&&l.length>0)for(var o=0,t=l.length;o<t;++o)if(l[o].sku===e){l[o].id="1";break}}};return{getMobileInfoWithPackageStock:d.getMobileInfoWithPackageStock,getPackGoodsStock:d.getPackGoodsStock,resolveUrlParams:d.resolveUrlParams,reformMobileGoodsWithStock:u.reformMobileGoodsWithStock,updateVersionInfoByColorId:d.updateVersionInfoByColorId,updateCurrPackageGoodsBySkuId:d.updateCurrPackageGoodsBySkuId,confirmSaleStatusWithPackageId:d.confirmSaleStatusWithPackageId,getAccessoriesInfoWithStock:d.getAccessoriesInfoWithStock,submitNumberInfo:d.submitNumberInfo,updateSkuReserved:d.updateSkuReserved,getPromotionGiftsInfo:d.getPromotionGiftsInfo}}]),appsServices.factory("JianguoProService",["$rootScope","$location","$route","$q","CartRequest","$filter","TimeStampService",function(e,t,o,i,r,a,s){var n={},c=[],l=[],u={},d=[],p={},f={},m={100027301:{pixel:"前置 800 万像素",mPixel:"前置摄像头 800 万像素",processor:"骁龙™ 625",specTips:"此配置版本前置摄像头为 799 万有效像素，不支持 NFC 功能",mSpecTips:"此版本前置摄像头为 799 万有效像素，不支持 NFC 功能",mColorTips:"酒红色/浅金色/巧克力色 64GB 和 128GB 版本有售，细红线仅 128GB 版本有售",summary:"32GB 版本为印刷亮银色 Logo"},100027302:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mSpecTips:"此版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mColorTips:"细红线仅 128GB 版本有售"},100027303:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，支持 NFC 功能",mSpecTips:"此版本前置摄像头为 1593 万有效像素，支持 NFC 功能",mColorTips:null},100027304:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mSpecTips:"此版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mColorTips:"细红线仅 128GB 版本有售"},100027305:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，支持 NFC 功能",mSpecTips:"此版本前置摄像头为 1593 万有效像素，支持 NFC 功能",mColorTips:null},100027306:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，支持 NFC 功能",mSpecTips:"此版本前置摄像头为 1593 万有效像素，支持 NFC 功能",mColorTips:null},100027307:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mSpecTips:"此版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mColorTips:"细红线仅 128GB 版本有售",commingTime:"此版本将于 2017 年 6 月 10 日 00:00 开启全款预定"},100027308:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，支持 NFC 功能",mSpecTips:"此版本前置摄像头为 1593 万有效像素，支持 NFC 功能",mColorTips:null,commingTime:"此版本将于 2017 年 6 月 10 日 00:00 开启全款预定"},100027309:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mSpecTips:"此版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mColorTips:"细红线仅 128GB 版本有售",commingTime:"此版本将于 2017 年 6 月 10 日 00:00 开售"},100027310:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，支持 NFC 功能",mSpecTips:"此版本前置摄像头为 1593 万有效像素，支持 NFC 功能",mColorTips:null,commingTime:"此版本将于 2017 年 6 月 10 日 00:00 开启全款预定"},100027311:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mSpecTips:"此版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mColorTips:"细红线仅 128GB 版本有售"},100027313:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mSpecTips:"此版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mColorTips:"细红线仅 128GB 版本有售",packageTitle:"银魂定制版",packageSubTitle:"银魂 & 锤子科技联名礼盒",commingTime:"此版本将于 2017 年 8 月 28 日 10:00:00 开售"}},g=_.keys(m),h={reformMobileBasicData:function(e){var t,o,i=n;angular.forEach(e.data.list,function(e){t=e.id.toString();for(var r=0;r<e.shop_info.spec_json.length;++r)o=e.shop_info.spec_json[r],1==o.spec_id||12==o.spec_id?(i[e.id].colorId=o.spec_value_id,i[e.id].colorName=o.show_name):2==o.spec_id||13==o.spec_id?(i[e.id].versionId=o.spec_value_id,i[e.id].versionName=o.show_name.split("|")[0]):5==o.spec_id&&(i[e.id].packageId=o.spec_value_id,i[e.id].packageName=o.show_name);i[e.id].sku=e.id.toString(),i[e.id].name=e.name,i[e.id].inStock=e.in_stock||!1,i[e.id].spu=e.spu_id.toString(),i[e.id].saleStatus=e.sale_status,i[e.id].price=e.price?e.price:i.price,i[e.id].totalPrice=e.price?e.price:i.price,i[e.id].image=e.shop_info.ali_image?e.shop_info.ali_image:e.shop_info.image,i[e.id].isOSS=!!e.shop_info.ali_image,i[e.id].buy_notes=e.shop_info.buy_notes})},addPreSaleInfotoData:function(e){angular.forEach(e.data,function(e,t){n[t].inStock&&(e?(n[t].isPreSale=!0,n[t].preSaleTime=a("date")(1e3*e,"yyyy.MM.dd")):3==n[t].saleStatus&&(n[t].isNowSale=!0))})},reformAccessoriesInfo:function(e){var t={},o=null,i=[],r=null,a=[],s={};return e&&(angular.forEach(e,function(e){o={},r=e.shop_info.spec_v2;for(var s=0,n=r.length;s<n;++s)if(1==r[s].spec_id){a=r[s].spec_values;break}angular.forEach(e.sku_info,function(t){angular.forEach(a,function(e){e.id==t.color_id&&(t.colorImg=e.image,t.colorName=e.show_name)}),o[t.sku_id]={skuId:t.sku_id,title:t.title,subTitle:t.sub_title,image:t.ali_image?t.ali_image:t.image,isOSS:!!t.ali_image,price:t.price,num:1,colorImg:t.colorImg||"",colorName:t.colorName},angular.forEach(t.spec_json,function(e){20==e.spec_id&&(o[t.sku_id].attrTitle=e.show_name)}),e.shop_info.tpl_content.base.extra[0].title&&(o[t.sku_id].storyTitle=e.shop_info.tpl_content.base.extra[0].title.split("|")[0],o[t.sku_id].storyTime=e.shop_info.tpl_content.base.extra[0].title.split("|")[1],o[t.sku_id].storyContent=e.shop_info.tpl_content.base.extra[0].content.split("\n")),i.push(t.sku_id)}),t[e.id]={spuId:e.id,title:e.shop_info.spu_title,subTitle:e.shop_info.spu_sub_title,saleStatus:e.sale_status,skus:o,isPackage:!!e.product_info&&!!parseInt(e.product_info.is_package)}}),s={spus:t,allSkus:i}),s},setCurrSkuAndDelNoStockSpu:function(e){return angular.forEach(e,function(e){var t=!1;for(var o in e.skus)if(e.skus[o].inStock&&(t=!0),e.skus[o].isDefault)if(e.skus[o].inStock)e.curr=e.skus[o];else for(var i in e.skusSort)if(e.skus[e.skusSort[i]].inStock){t=!0,e.curr=e.skus[e.skusSort[i]];break}t||(e.isSoldOut=!0)}),e},addAccessToAccessoriesInfo:function(e,t,o){f[e]={},f[e].type_1=[],f[e].type_2=[],angular.forEach(t.note.assoc_list,function(i,r){var s,n={};n={curr:{},skus:{},skusSort:[]},angular.forEach(i.list,function(e){"1"==i.type&&(s=e.sku.substring(0,7),n.spuId=s),n.skus[e.sku]={},n.skus[e.sku].type=i.type,n.skus[e.sku].awardPrice=a("numberFormat")(e.award_price,"floor",-2),n.skus[e.sku].skuId=e.sku,n.skus[e.sku].isDefault=e.is_default,n.skus[e.sku].inStock=!0,angular.forEach(t.gift_num,function(t,o){o==e.sku&&(!t||t<0)&&(n.skus[e.sku].inStock=!1)}),n.skusSort.push(e.sku),"2"==i.type&&(n.skus[e.sku].configIndex=Number(r).toString(),n.skus[e.sku].configId=Number(o).toString())}),f[e]["type_"+i.type].push(n)})},addSkuDataToAccessoriesInfo:function(e,t,o){angular.forEach(t.skus,function(t,i){angular.forEach(o.skus,function(r,a){i==a&&(t.colorImg=r.colorImg,t.colorName=r.colorName,t.image=r.image,t.isOSS=r.isOSS,t.price=parseFloat(r.price),t.num=r.num,t.title=r.title,t.subTitle=r.subTitle,t.hasDiscount=!1,t.price!=parseFloat(t.awardPrice)&&(t.hasDiscount=!0),"type_2"==e&&(t.spuTitle=o.title,t.spuSubTitle=o.subTitle,t.attrTitle=r.attrTitle,t.storyTitle=r.storyTitle,t.storyTime=r.storyTime,t.storyContent=r.storyContent))})})}},v={getMobileInfoWithStock:function(){var o=this,a=i.defer(),s=_.keys(m);return n=m,e.$watch("isLoggedIn",function(){e.isLoggedIn!==!0&&e.isLoggedIn!==!1||i.all([r.getSkusInfo({ids:s.join(","),with_stock:!0}),r.getPreSale({skus:s.join(",")})]).then(function(e){var i=e[0],r=e[1];if(0==i.code){var s=t.search();h.reformMobileBasicData(i),0==r.code&&h.addPreSaleInfotoData(r),o.resolveUrlParams(s,function(e){o.confirmSaleStatus(e),a.resolve({mobilesData:n,currMobile:e})})}else a.reject("CartRequest.getSkusInfo code<>0")})}),a.promise},updateColorInfoByVersionId:function(e,t){var o=[];return angular.forEach(n,function(i){i.versionId==e&&angular.forEach(t,function(e){e.colorId==i.colorId&&o.push(e)})}),o},updatePackageInfoByVersionIdColorId:function(e,t,o){var i=[];return angular.forEach(n,function(r){r.versionId==e&&r.colorId==t&&angular.forEach(o,function(e){e.packageId==r.packageId&&i.push(e)})}),i},addColorInfoToParams:function(e,t){return angular.forEach(e,function(e){e.isProduce=!1,e.tipsText=null,angular.forEach(t,function(t){e.colorId==t.colorId&&(e.isProduce=!0)}),e.isProduce||("210"==e.colorId?e.tipsText="此颜色仅 128GB 版本有售":e.tipsText="此颜色仅 64GB 和 128GB 版本有售")}),e},addPackageInfoToParams:function(e,t){return angular.forEach(e,function(e){e.isProduce=!1,e.tipsText=null,angular.forEach(t,function(t){e.packageId==t.packageId&&(e.isProduce=!0)}),e.isProduce||("253"==e.packageId?e.tipsText="仅 64G 浅金色颜色有银魂特别版":e.tipsText="仅 64G 浅金色颜色有银魂特别版")}),e},confirmSaleStatus:function(e){3==e.saleStatus?e.inStock?e.isPreSale?e.labelMessage="全款预定":e.labelMessage="现在购买":e.labelMessage="已售罄":("100027307"==e.sku,e.labelMessage="即将开售",e.isComming=!0)},resolveUrlParams:function(e,t){if(n){var o,i=n,r=null;s.getServerTime().then(function(a){var s=a.now||0,n=[];if(n=s<1497715200?i[100027302].inStock?i[100027302].isPreSale&&i[100027311].inStock&&!i[100027311].isPreSale?["100027309","100027307","100027310","100027308","100027306","100027305","100027303","100027304","100027311","100027301"]:["100027309","100027307","100027310","100027308","100027306","100027305","100027303","100027304","100027302","100027301"]:3!=i[100027302].saleStatus||i[100027311].inStock?["100027309","100027307","100027310","100027308","100027306","100027305","100027303","100027304","100027311","100027301"]:["100027309","100027307","100027310","100027308","100027306","100027305","100027303","100027304","100027302","100027301"]:i[100027302].inStock?i[100027302].isPreSale&&i[100027311].inStock&&!i[100027311].isPreSale?["100027310","100027308","100027309","100027307","100027306","100027305","100027303","100027304","100027311","100027301"]:["100027310","100027308","100027309","100027307","100027306","100027305","100027303","100027304","100027302","100027301"]:3!=i[100027302].saleStatus||i[100027311].inStock?["100027310","100027308","100027309","100027307","100027306","100027305","100027303","100027304","100027311","100027301"]:["100027310","100027308","100027309","100027307","100027306","100027305","100027303","100027304","100027302","100027301"],e.v&&e.c){for(o in i)if(e.c==i[o].colorId&&e.v==i[o].versionId){"100027302"==o?i[o].inStock?i[o].isPreSale&&i[100027311].inStock&&!i[100027311].isPreSale?(r=i[100027311],r.colorId="36"):r=i[o]:3!=i[o].saleStatus||i[100027311].inStock?(r=i[100027311],r.colorId="36"):r=i[o]:r=i[o];break}if(0===_.size(r))for(o in i)if("208"==e.v){var c=[];c=i[100027302].inStock?i[100027302].isPreSale&&i[100027311].inStock&&!i[100027311].isPreSale?["100027309","100027307","100027304","100027311"]:["100027309","100027307","100027304","100027302"]:3!=i[100027302].saleStatus||i[100027311].inStock?["100027309","100027307","100027304","100027311"]:["100027309","100027307","100027304","100027302"];for(var l=0;l<c.length;l++)if(i[c[l]].isNowSale){r=i[c[l]],"100027311"==c[l]&&(r.colorId="36");break}0===_.size(r)&&(r=i[100027309])}else if("93"==e.v)r=i[100027301];else if(e.v==i[o].versionId){r=i[o];break}}if(e.v&&e.c&&e.p)for(o in i)if(e.c==i[o].colorId&&e.v==i[o].versionId&&e.p==i[o].packageId){r=i[o];break}if(0===_.size(r)){for(var l=0;l<n.length;l++)if(i[n[l]].isNowSale){r=i[n[l]],"100027311"==n[l]&&(r.colorId="36");break}0===_.size(r)&&(r=s<14977152e5?i[100027309]:i[100027310])}return t(r)})}},getAccessoriesAndPromos:function(){var e=i.defer();return r.getDiscountList({with_num:!0}).then(function(t){var o;if(0==t.code){o=t.data&&t.data.list;for(var i=0;i<o.length;++i)1==o[i].type?c.push(o[i]):4==o[i].type&&l.push(o[i]);for(var i=0;i<c.length;++i)angular.forEach(c[i].rule.condition.main_skus,function(e){for(var t=0;t<g.length;t++)if(e==g[t]){u[g[t]]={},u[g[t]].title=c[i].title,u[g[t]].totalPrice=0,u[g[t]].gifts=angular.extend({},c[i].rule.result.gift_skus,c[i].rule.gift_num),u[g[t]].rule=c[i].note.rule_text;for(var o in c[i].rule.result.gift_skus)_.indexOf(d,o)<0&&d.push(o)}});d.length>0&&r.getSkusInfo({ids:d.join(",")}).then(function(e){if(0===e.code){for(var t,o=e.data.list,i=0;i<o.length;++i)t=o[i].attr_info[1]?"（"+o[i].attr_info[1].value+"）":"",p[o[i].id]={title:o[i].shop_info.title+t,isSold:3==o[i].sale_status,price:o[i].price};for(var r in u)for(var a in u[r].gifts)p[a]&&(u[r].totalPrice+=Number(p[a].price))}});for(var a,s=[],n=[],i=0;i<l.length;++i)angular.forEach(l[i].rule.condition.main_skus,function(e){for(var t=0;t<g.length;t++)e==g[t]&&angular.forEach(l[i].rule.result.assoc_skus,function(e){angular.forEach(e,function(e,t){_.indexOf(n,t)<0&&n.push(t),a=t.substring(0,7),_.indexOf(s,a)<0&&s.push(a)})})});s.sort(),s.length>0&&r.getSpusList({ids:s.join(",")}).then(function(e){var t=null,o={};if(e.data&&e.data.list){t=h.reformAccessoriesInfo(e.data.list),angular.forEach(t.allSkus,function(e){_.indexOf(n,e.toString())<0&&delete t.spus[e.substring(0,7)].skus[e]}),o=t.spus;for(var i,r=0;r<l.length;++r)i=l[r].id,angular.forEach(l[r].rule.condition.main_skus,function(e){for(var t=0;t<g.length;t++)e==g[t]&&h.addAccessToAccessoriesInfo(e,l[r],i)});angular.forEach(f,function(e){angular.forEach(e.type_1,function(e){angular.forEach(o,function(t,o){e.spuId==o&&(e.title=t.title,e.subTitle=t.subTitle,e.saleStatus=t.saleStatus,e.isPackage=t.isPackage,h.addSkuDataToAccessoriesInfo("type_1",e,t))})}),h.setCurrSkuAndDelNoStockSpu(e.type_1),angular.forEach(e.type_2,function(e){angular.forEach(o,function(t){h.addSkuDataToAccessoriesInfo("type_2",e,t)})}),h.setCurrSkuAndDelNoStockSpu(e.type_2)})}}),e.resolve({promosInfo:{mobilePromos:u||{},gifts:p||{}},accessoriesInfo:f||{}})}else e.resolve({})}),e.promise}};return{getMobileInfoWithStock:v.getMobileInfoWithStock,updateColorInfoByVersionId:v.updateColorInfoByVersionId,addColorInfoToParams:v.addColorInfoToParams,updatePackageInfoByVersionIdColorId:v.updatePackageInfoByVersionIdColorId,addPackageInfoToParams:v.addPackageInfoToParams,confirmSaleStatus:v.confirmSaleStatus,resolveUrlParams:v.resolveUrlParams,getAccessoriesAndPromos:v.getAccessoriesAndPromos}}]),appsServices.factory("JianguoProCdkeyService",["$rootScope","$location","$route","$q","CartRequest",function(e,t,o,i,r){var a={},s={100027301:{pixel:"前置 800 万像素",mPixel:"前置摄像头 800 万像素",processor:"骁龙™ 625",specTips:"此配置版本前置摄像头为 799 万有效像素，不支持 NFC 功能",mSpecTips:"此版本前置摄像头为 799 万有效像素，不支持 NFC 功能",mColorTips:"酒红色 64GB 和 128GB 版本有货，细红线仅 128GB 版本有货",summary:"32GB 版本为印刷亮银色 Logo"},100027302:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mSpecTips:"此版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mColorTips:"细红线仅 128GB 版本有货"},100027303:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，支持 NFC 功能",mSpecTips:"此版本前置摄像头为 1593 万有效像素，支持 NFC 功能",mColorTips:null},100027304:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mSpecTips:"此版本前置摄像头为 1593 万有效像素，不支持 NFC 功能",mColorTips:"细红线仅 128GB 版本有货"},100027305:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，支持 NFC 功能",
mSpecTips:"此版本前置摄像头为 1593 万有效像素，支持 NFC 功能",mColorTips:null},100027306:{pixel:"前置 1600 万像素",mPixel:"前置摄像头 1600 万像素",processor:"骁龙™ 626",specTips:"此配置版本前置摄像头为 1593 万有效像素，支持 NFC 功能",mSpecTips:"此版本前置摄像头为 1593 万有效像素，支持 NFC 功能",mColorTips:null}},n={reformMobileBasicData:function(e){var t,o,i=a;angular.forEach(e.data.list,function(e){t=e.id.toString();for(var r=0;r<e.shop_info.spec_json.length;++r)o=e.shop_info.spec_json[r],1==o.spec_id||12==o.spec_id?(i[e.id].colorId=o.spec_value_id,i[e.id].colorName=o.show_name):2!=o.spec_id&&13!=o.spec_id||(i[e.id].versionId=o.spec_value_id,i[e.id].versionName=o.show_name.split("|")[0]);i[e.id].sku=e.id.toString(),i[e.id].name=e.name,i[e.id].inStock=e.in_stock||!1,i[e.id].spu=e.spu_id.toString(),i[e.id].saleStatus=e.sale_status,i[e.id].price=e.price?e.price:i.price,i[e.id].totalPrice=e.price?e.price:i.price,i[e.id].image=e.shop_info.ali_image?e.shop_info.ali_image:e.shop_info.image,i[e.id].isOSS=!!e.shop_info.ali_image,i[e.id].buy_notes=e.shop_info.buy_notes})}},c={getMobileInfoByCdkey:function(){var o=this,c=i.defer(),l=_.keys(s);return a=s,e.$watch("isLoggedIn",function(){e.isLoggedIn!==!0&&e.isLoggedIn!==!1||i.all(r.getSkusInfo({ids:l.join(","),with_stock:!0,with_spu:!0})).then(function(e){if(0==e.code){var i=t.search();n.reformMobileBasicData(e),o.resolveUrlParams(i,function(e){o.confirmSaleStatus(e),c.resolve({mobilesData:a,currMobile:e})})}else c.reject("CartRequest.getSkusInfo code<>0")})}),c.promise},updateColorInfoByVersionId:function(e,t){var o=[];return angular.forEach(a,function(i){i.versionId==e&&angular.forEach(t,function(e){e.colorId==i.colorId&&o.push(e)})}),o},addColorInfoToParams:function(e,t){return angular.forEach(e,function(e){e.isProduce=!1,e.tipsText=null,angular.forEach(t,function(t){e.colorId==t.colorId&&(e.isProduce=!0)}),e.isProduce||("201"==e.colorId?e.tipsText="此颜色 64GB 和 128GB 版本有货":"210"==e.colorId&&(e.tipsText="此颜色仅 128GB 版本有货"))}),e},confirmSaleStatus:function(e){3==e.saleStatus?e.labelMessage="现在购买":e.labelMessage="已下架"},resolveUrlParams:function(e,t){if(a){var o,i=a,r=null;if(e.v&&e.c){for(o in i)if(e.c==i[o].colorId&&e.v==i[o].versionId){r=i[o];break}if(0===_.size(r))for(o in i)if("208"==e.v)r=i[100027304];else if("93"==e.v)r=i[100027301];else if(e.v==i[o].versionId){r=i[o];break}}if(0===_.size(r))for(var s in i)i[s].sku&&i[s].saleStatus&&(r=i[s]);return t(r)}}};return{getMobileInfoByCdkey:c.getMobileInfoByCdkey,updateColorInfoByVersionId:c.updateColorInfoByVersionId,addColorInfoToParams:c.addColorInfoToParams,confirmSaleStatus:c.confirmSaleStatus,resolveUrlParams:c.resolveUrlParams}}]),appsServices.factory("InsuranceService",["$rootScope","$location","$route","$q","CartRequest","$filter","Utils","GoodsService",function(e,t,o,i,r,a,s,n){var c={INSURANCE_TYPE_TEXT:{2:{name:"意外保修服务",slogan:"“免费一次主机更换 ? ”“免费两次维修 ? ”",introduction:["在您购买意外保修服务后的一年内，由于摔落碎屏、液体泼溅、挤压等意外损伤造成的手机硬件故障，将可以获得最多两次维修，或 1 次主机更换。","（本服务优先采取维修服务，若锤子数码售后服务中心确认无法修复，则进行主机更换。）您可选择在购机时购买，或收货次日起 3 日内购买本服务。",'服务细则参见<a href="http://www.smartisan.com/support/#/repair" target="_blank">《意外损坏保修服务条款》</a>'],checked:-1},3:{name:"意外碎屏保修服务",slogan:"“屏幕意外摔碎，可以免费更换 ? ”",introduction:["在您购买“意外碎屏保修服务”后的有效期内，由于意外坠落、意外挤压或碰撞等非蓄意破坏的原因导致手机屏幕碎裂，","可免费更换一次原装屏幕组件。您可选择在手机初次联网激活时或收货次日起 3 日内访问 ",'<a href="http://bx.smartisan.com" target="_blank">bx.smartisan.com</a> 网站购买，',"或在本机 设置 > 关于本机 > 保修服务 中购买服务。",'服务细则参见<a href="http://www.smartisan.com/support/#/broken-screen" target="_blank">《意外碎屏保修服务条款》</a>'],checked:-1},4:{name:"延长保修服务",introduction:["如您购买本服务，在手机正常“三包” 1 年保修期结束后，将额外多获得 1 年保修服务。","延长保修服务期为 1 年，自手机正常“三包” 1 年服务期的截止日之次日零时开始，至第二年对应日之 24 时结束。",'服务细则参见<a href="http://www.smartisan.com/support/#/insurance" target="_blank">《延长保修服务条款》</a>']}},checkPromotions:function(){var e=i.defer();return r.getDiscountList({with_num:!0}).then(function(t){0===t.code?e.resolve(t.data.list):e.resolve([])}),e.promise}};return{reformMobileData:function(){var o=i.defer(),n=t.search(),l={},u={},d={},p={},f=0,m=[];if(n.m&&9===n.m.length){if(m.push(n.m),e.mobileAccessories){if(e.mobileAccessories.skus.length>0){var g=0,h=e.mobileAccessories.items;console.log(h);for(var v in h)g=h[v].awardPrice||h[v].price,f+=g*h[v].num;p=angular.extend({},e.mobileAccessories.items)}}else if(n.ac)for(var b=n.ac.split("|"),k=0;k<b.length;++k)9===b[k].length&&(m.push(b[k]),p[b[k]]={num:1});return c.checkPromotions().then(function(e){var t;if(!n.c)for(var i=0;i<e.length;++i)if(1==e[i].type){if(_.indexOf(e[i].rule.condition.main_skus,Number(n.m))>-1)for(var g in e[i].rule.result.gift_skus)t=g.toString(),u[t]={num:e[i].rule.result.gift_skus[t]},m.push(t)}else if(n.ac&&4==e[i].type){var h,v=n.ac.split("|");if(_.indexOf(e[i].rule.condition.main_skus,Number(n.m))>-1)for(var b=0;b<e[i].note.assoc_list.length;++b)for(var k=0;k<e[i].note.assoc_list[b].list.length;++k)h=e[i].note.assoc_list[b].list[k],_.indexOf(v,h.sku)>-1&&(d[h.sku]=h.award_price)}r.getSkusInfo({ids:m.join(","),with_stock:!0,with_spu:!0}).then(function(e){var t,i,r,m,g;if(0===e.code){t=e.data.list;for(var h=0;h<t.length;++h)if(1==t[h].product_info.is_mobile){m=[],i=t[h].spu.product_info.accessory_goods,l.currMobile={id:t[h].id,image:t[h].shop_info.ali_image,inStock:t[h].in_stock,isSold:3==t[h].sale_status,title:t[h].shop_info.title,categoryName:s.matchMobileCategoryName(t[h].shop_info.title),attrs:t[h].shop_info.spec_json,price:t[h].price};for(var v=0;v<t[h].shop_info.spec_json.length;++v)r=t[h].shop_info.spec_json[v],1==r.spec_id||12==r.spec_id?l.currMobile.colorName=r.show_name:2==r.spec_id||13==r.spec_id?(g=r.show_name&&r.show_name.split("|"),g&&(g.length>1?(l.currMobile.versionName=g[0],l.currMobile.versionDesc=g[1]):l.currMobile.versionName=g[0])):11==r.spec_id&&(l.currMobile.inchName=r.show_name);if(_.size(i)>0)for(var b in i)m.push(angular.extend({sku:b,title:i[b].shop_info.title,image:i[b].shop_info.ali_image,price:i[b].price,typeId:i[b].is_insurance,checked:0},c.INSURANCE_TYPE_TEXT[i[b].is_insurance.toString()]));l.insurances=m,l.insurances=a("orderBy")(m,["typeId"]),f+=l.currMobile.price}else{var k=t[h].id.toString();u[k]&&(u[k]=angular.extend({},u[k],{title:t[h].shop_info.title,price:t[h].price})),p[k]&&(p[k]=angular.extend({},p[k],{title:t[h].shop_info.title,price:d[k]||t[h].price}),f+=p[k].num*p[k].price)}n.c&&(l.cdKey=n.c,l.discountAmount=n.d||0,f-=l.discountAmount),l.currMobile?(angular.extend(l,{promotions:u,hasPromos:_.size(u)>0,accessories:p,hasAccessoires:_.size(p)>0,insurancesNum:0,totalPrice:f,quickCheckout:!!n.q||n.c}),o.resolve(l)):location.replace("http://www.smartisan.com/#/error/404")}else o.resolve({})})}),o.promise}location.replace("http://www.smartisan.com/#/error/404")}}}]),appsServices.factory("ThemeService",["$q","MobileGoodsService","CartRequest","$filter","StoreConfig",function(e,t,o,i,r){function a(){}return a.prototype.init=function(){},a.prototype.getLimitContent=function(e,t,o){var t=t+"",r="";document.location.origin+"/#/item/"+e;return r=i("ellipsis")(t,o),r=r.replace(/\.+$/,"······")},a.prototype.shareWeibo=function(e,t,o){var t="http://service.weibo.com/share/share.php?appkey=&title="+encodeURIComponent(e)+"&url="+encodeURIComponent(t)+"&pic="+o;return t},a.prototype.getCoverData=function(e){for(var t=this,o=[],i=0,r=e.length;i<r;i++)if(!e[i].placeholder){var a=e[i],s=a.shop_info,n=document.location.origin+"#/item/"+a.id,c=a.product_info.goods_type||0,l="";a.is_custom=0|s.is_custom,a.status=0|a.sale_status,a.doodleImg=s.image,a.isOSS=s.isOSS,a.title=s.title,a.subtitle=s.sub_title,a.promotitle=s.promo_title,8!=c&&20!=c||(a.goodsType="cover"),a.buttonLabel=l,s.tpl_content&&s.tpl_content.doodle&&(a.content=s.tpl_content.doodle.text),s.tpl_content&&s.tpl_content.weibo&&(a.share_text=s.tpl_content.weibo.text)&&(a.share_pic=s.tpl_content.weibo.images.image_pre+s.tpl_content.weibo.images["1x"]+s.tpl_content.weibo.images.image_name),a.thumbContent=t.getLimitContent(a.id,a.content,104),a.sectionContent=a.content&&a.content.split("\n");var u=0,d=0,p=0,f=9;angular.forEach(a.sectionContent,function(e,t){if(u<f){var o=0;if(""==e)u++;else{var i=e.length/42;parseInt(i)==i?(o=u+i,o>f?(p=f-u,u=f):u+=i):(o=u+parseInt(i)+1,o>f?(p=f-u,u=f):u+=parseInt(i)+1),u++}d++}}),a.sectionContent.splice(d),""==a.sectionContent[a.sectionContent.length-1]&&(a.sectionContent.splice(-1),--d),p>0&&(a.sectionContent[d-1]=a.sectionContent[d-1].substring(0,36*p)+"……"),a.shareWeibo=t.shareWeibo(a.share_text,n,a.share_pic),o.push(a)}return o},new a}]),appsServices.factory("MyCarousel",["$window",function(e){var t=function(e,t){$(e).myCarousel(t)};return{init:t}}]),appsDirectives.directive("realSrc",["$timeout","StoreConfig",function(e,t){return{restrict:"A",link:function(e,o,i,r){function a(e){i.$set("src",e),t.configmsie&&o.prop("src",e)}i.$observe("realSrc",function(e){e&&a(e)})}}}]).directive("uiRadio",["$timeout",function(e){return{restrict:"EA",templateUrl:"view/html/tempUiRadio.html",replace:!0,scope:{name:"@name",options:"=options",value:"@",parentEl:"@",checked:"=checked"},link:function(t,o,i,r){t.normalClass=!!t.options&&t.options.normalClass||"blue-radio",o&&e(function(){t.options&&t.options.parentEl?o.closest(t.options.parentEl).click(function(e){t.$apply(function(){t.options&&angular.isFunction(t.options.callback)&&t.options.callback(o,t.name,t.checked,t.value)})}):t.toggleRadio=function(e){t.options&&angular.isFunction(t.options.callback)&&t.options.callback(o,t.name,t.checked,t.value)}},500)}}}]).directive("uiCheckbox",["$timeout",function(e){return{restrict:"EA",templateUrl:"view/html/tempUiCheckbox.html",replace:!0,scope:{name:"@",options:"=options",checked:"=checked",disableddd:"=disableddd",goods:"="},link:function(e,t,o,i){e.normalClass=e.options&&e.options.normalClass||"blue-checkbox",t&&(e.options&&e.options.parentEl?t.closest(e.options.parentEl).click(function(o){e.$apply(function(){e.disableddd||(e.checked=!e.checked,e.options&&angular.isFunction(e.options.callback)&&e.options.callback(t,e.name,e.checked,e.goods))})}):e.toggleCheck=function(o){e.disableddd||(e.checked=!e.checked,e.options&&angular.isFunction(e.options.callback)&&e.options.callback(t,e.name,e.checked,e.goods))})}}}]).directive("cartQuantity",["$timeout","DialogService","Navigator",function(e,t,o){return{restrict:"EA",templateUrl:"view/html/tempCartQuantity.html",replace:!0,scope:{options:"=options",value:"=value",sku:"@",min:"@",max:"@",ismobile:"="},link:function(i,r,a,s){var n=!1,c=!1;if(i.arr=[1,2],i.customClass=i.options&&i.options.customClass||"select",i.max=Number(i.max),r){var l=function(){i.options&&!i.options.inputType&&(i.options.inputType=o.isMobile?"number":"text"),o.isMobile&&(i.arr=[i.value-1,i.value,i.value-0+1]),0==i.max&&0==i.min?(n=!0,$(r).find(".num input").attr("readonly","readonly")):n=!1,1==i.value&&i.options&&!i.options.canDelete?$(r).find(".down").addClass("down-disabled"):$(r).find(".down").removeClass("down-disabled"),i.value>=i.max?$(r).find(".up").addClass("up-disabled"):$(r).find(".up").removeClass("up-disabled")};i.options&&angular.isFunction(i.options.refresh)?i.options.refresh(l):e(function(){l()},20),i.resetList=function(e,t,o){i.value=t,i.arr=[t-1,t,t-0+1],i.options.callback&&angular.isFunction(i.options.callback)?i.options.callback(e,i.sku,t,o):c=!1,i.$root.$$phase||i.$apply()},r.find("input").on("keydown",function(e){var t=e.keyCode;(t>47&&t<58||t>94&&t<106||8==t||13==t)&&13==t&&$(e.currentTarget).blur()}),r.find("input").on("blur",function(e){if(n)return!1;var t=$(e.currentTarget),o=t.siblings("ul"),r=(t.closest(".cart-items"),t.closest(".js-select-quantity")),a=r.find(".down"),s=r.find(".up"),c=0|i.min||1,l=0|i.max||0,u=t.val();u=u.match(/^\d+$/)?u:1,u=Math.max(u,c),u=Math.min(u,l),s.hasClass("up-disabled")&&s.removeClass("up-disabled"),u>=l&&s.addClass("up-disabled"),a.hasClass("down-disabled")&&a.removeClass("down-disabled"),1!=u||i.options.canDelete||a.addClass("down-disabled"),t.val(u),i.resetList(o,u)}),i.up=function(r){var a=$(r.currentTarget),s=a.siblings(".num"),l=s.find("input"),u=s.find("ul"),d=a.siblings(".down"),p=a.closest(".cart-items"),f=i.max||0,m=i.value,g=s.height();return!(n||!i.options.useData&&a.hasClass("up-disabled")||c)&&(d.hasClass("down-disabled")&&d.removeClass("down-disabled"),f=Math.max(f,1),!p.hasClass("cart-disabled-items")&&(m>=f&&i.options.useData?(t.setContent("dialog",{message:"商品已达到最大可购买数量，无法继续添加",dialogClass:"module-dialog-confirm"}),e(function(){t.open("dialog")},50),!1):!(u.is("animated")||m>=f)&&void(o.isMobile?(++m,m>=f&&a.addClass("up-disabled"),c=!0,i.resetList(u,m,function(){c=!1})):(l.hide(),u.show(),u.animate({top:"-="+g},150,function(){++m,l.show(),u.css("top","-"+g+"px").hide(),m>=f&&a.addClass("up-disabled"),c=!0,i.resetList(u,m,function(){c=!1})})))))},i.down=function(e){var t=$(e.currentTarget),r=t.siblings(".num"),a=t.siblings(".up"),s=r.find("input"),l=r.find("ul"),u=t.closest(".cart-items"),d=i.min||1,p=i.value,f=r.height();return!(n||t.hasClass("down-disabled")||c)&&(1!=i.max&&a.hasClass("up-disabled")&&a.removeClass("up-disabled"),i.options.canDelete&&(d=0),!u.hasClass("cart-disabled-items")&&(!(1==p&&!i.options.canDelete)&&(!(l.is("animated")||p<=d)&&void(o.isMobile?(--p,c=!0,i.resetList(l,p,function(){c=!1})):(s.hide(),l.show(),l.animate({top:"+="+f},150,function(){--p,s.show(),l.css("top","-"+f+"px").hide(),1!=p||i.options.canDelete||t.addClass("down-disabled"),c=!0,i.resetList(l,p,function(){c=!1})}))))))}}}}}]).directive("tempDialog",["$timeout","DialogService",function(e,t){return{restrict:"EA",templateUrl:"view/html/tempDialog.html",link:function(e,o,i,r){o&&t.addDom(i.dialog,o,e)}}}]).directive("tempPaging",["$timeout","StoreConfig","PagingService",function(e,t,o){return{restrict:"EA",templateUrl:"view/html/tempPaging.html",link:function(e,t,i,r){o.addDom(null,t,e)}}}]).directive("uiShoppingService",["$timeout",function(e){return{restrict:"EA",templateUrl:"view/html/tempUiShoppingService.html",link:function(e,t,o,i){}}}]).directive("skuChange",["$timeout",function(e){return{restrict:"A",link:function(t,o,i){t.$watch(function(){return i.model},function(){e(function(){o.addClass("on-opc")},100)})}}}]).directive("imgLoaded",["$rootScope","$timeout","$location","MobileGoodsService",function(e,t,o,i){return{restrict:"A",link:function(t,i,r){o.$$search&&o.$$search.id&&o.$$search.anchor?1==t.$last&&i.on("load",function(){t.$emit("ngRepeatFinished")}):e.pageLoading=!1}}}]),appsDirectives.directive("iAutoFocus",["$timeout",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,i,r){o&&e(function(){o.focus()},10)}}}]).directive("selectOn",["$timeout",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,i,r){t.$watch(i.selectOn,function(t){t&&e(function(){o.select()},10)})}}}]).directive("iFocus",[function(){var e="i-focused";return{restrict:"A",require:"ngModel",link:function(t,o,i,r){r.$focused=!1,r.$blurred=!1,o.on("focus",function(i){o.addClass(e),t.$apply(function(){r.$focused=!0})}).on("blur",function(i){o.removeClass(e),t.$apply(function(){r.$focused=!1,r.$blurred=!0})}).on("keydown",function(e){t.$apply(function(){r.$blurred=!1})})}}}]).directive("iInput",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,i){t.on("focus",function(){$(this).parent(".input").addClass("module-form-item-shadow"),!jQuery.support.opacity}),t.on("blur",function(){$(this).parent(".input").removeClass("module-form-item-shadow"),$(this).val()||$(this).prev(".placeholder").show()}),t.on("keydown input",function(t){if($(this).prev(".placeholder").hide(),13!=t.which)switch(i.$submitted=!1,e.util.submitted=!1,e.errAnimation={},angular.forEach(e.focus,function(t,o){e.focus[o]=!1}),i.$name){case"cdkeycode":e.invalid.cdkeycodeValid=!0;break;case"captcha":e.invalid.captchaValid=!0,e.invalid.captchaReload=!0;break;case"password":e.invalid.passwordValid=!0;break;case"oldpassword":e.invalid.oldpasswordValid=!0;break;case"mobile":e.invalid.mobileRegistered=!0;break;case"mail":e.invalid.emailRegistered=!0;break;case"nickname":e.invalid.nickname=!0,e.invalid.nicknameRegistered=!0,e.invalid.nicknameIllegal=!0;break;case"verification":e.invalid.mobileCaptchaValid=!0,e.invalid.mobileCaptchaReload=!0;break;case"answer1":case"answer2":e.invalid.answerInvalid=!0}}),e.$watch("util.submitted",function(e){e&&(i.$submitted=!0,i.$blurred=!0)})}}}).directive("iCdkeycode",["Config","$timeout",function(e,t){return{restrict:"A",require:"ngModel",link:function(o,i,r,a){t(function(){a.$parsers.push(function(t){return e.regExp.numOrEn.test(t)?($(i).parent(".input").removeClass("module-form-item-shadow"),$(i).parent(".input").addClass("focus-item"),a.$setValidity(a.$name,!0),t):($(i).parent(".input").removeClass("focus-item"),void a.$setValidity(a.$name,!1))})},20)}}}]).directive("iResponse",["$timeout",function(e){return{restrict:"A",require:"ngModel",link:function(e,t,o,i){switch(i.$name){case"cdkeycode":e.$watch("invalid.cdkeycodeValid",function(e){e="undefined"==typeof e||e,e?i.$setValidity("cdkeycodeValid",!0):i.$setValidity("cdkeycodeValid",!1)});break;case"captcha":e.$watch("invalid.captchaValid",function(e){e="undefined"==typeof e||e,e?($(t).parent(".input").addClass("focus-item"),i.$setValidity("captchaValid",!0)):($(t).parent(".input").removeClass("focus-item"),i.$setValidity("captchaValid",!1))}),e.$watch("invalid.captchaReload",function(e){e="undefined"==typeof e||e,e?i.$setValidity("captchaReload",!0):i.$setValidity("captchaReload",!1)})}}}}]).directive("iWarning",[function(){return{restrict:"A",link:function(e,t,o,i){var r=t.parent(".input");e.$watch(o.iWarning,function(e,o){!!e!=!!o&&(e?(r.addClass("module-small-error-wrapper"),jQuery.support.opacity?t.stop().show().animate({opacity:1},{queue:!1,duration:300}):t.stop().show()):(r.removeClass("module-small-error-wrapper"),jQuery.support.opacity?t.stop().animate({opacity:0},{duration:300,done:function(){t.hide()}}):t.stop().hide()))})}}}]).directive("iEnter",[function(){return function(e,t,o,i){t.bind("keydown keypress",function(t){13==t.which&&(e.$apply(function(){e.$eval(o.iEnter,{event:t})}),t.preventDefault())})}}]),appsDirectives.directive("aAutoFocus",["$timeout",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,i,r){o&&e(function(){o.focus()},10)}}}]).directive("selectOn",["$timeout",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,i,r){t.$watch(i.selectOn,function(t){t&&e(function(){o.select()},10)})}}}]).directive("aFocus",[function(){var e="i-focused";return{restrict:"A",require:"ngModel",link:function(t,o,i,r){r.$focused=!1,r.$blurred=!1,o.on("focus",function(i){o.addClass(e),t.$apply(function(){r.$focused=!0})}).on("blur verify",function(i){o.removeClass(e),t.$apply(function(){r.$focused=!1,r.$blurred=!0})}).on("keydown",function(e){t.$apply(function(){r.$blurred=!1})})}}}]).directive("aInput",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,i){angular.isObject(e.util.form)||(e.util.form=e.form),setTimeout(function(){$(t).val()&&($(t).prev(".placeholder").hide(),$(t).parent().addClass("focus-item"))},50),t.on("focus",function(){$(this).parent(".input").addClass("module-form-item-shadow"),!jQuery.support.opacity}),t.on("blur",function(){$(this).parent(".input").removeClass("module-form-item-shadow"),$(this).val()?$(this).parent().addClass("focus-item"):($(this).prev(".placeholder").show(),$(this).parent().removeClass("focus-item"))}),t.on("keydown input",function(t){$(this).prev(".placeholder").hide(),13!=t.which&&(i.$submitted=!1,e.util.submitted=!1,angular.forEach(e.focus,function(t,o){e.focus[o]=!1}))}),e.$watch("util.submitted",function(e){e&&(i.$submitted=!0,i.$blurred=!0)})}}}).directive("aCdkeycode",["Config","$timeout",function(e,t){return{restrict:"A",require:"ngModel",link:function(o,i,r,a){t(function(){a.$parsers.push(function(t){return e.regExp.numOrEn.test(t)?($(i).parent(".input").removeClass("module-form-item-shadow"),$(i).parent(".input").addClass("focus-item"),a.$setValidity(a.$name,!0),t):($(i).parent(".input").removeClass("focus-item"),void a.$setValidity(a.$name,!1))})},20)}}}]).directive("aWarning",[function(){return{restrict:"A",link:function(e,t,o,i){var r=t.parent(".input");e.$watch(o.aWarning,function(e,o){!!e!=!!o&&(e?(r.addClass("module-small-error-wrapper"),jQuery.support.opacity?t.stop().show().animate({opacity:1},{queue:!1,duration:300}):t.stop().show()):(r.removeClass("module-small-error-wrapper"),jQuery.support.opacity?t.stop().animate({opacity:0},{duration:300,done:function(){t.hide()}}):t.stop().hide()))})}}}]).directive("aEnter",[function(){return function(e,t,o,i){t.bind("keydown keypress",function(t){13==t.which&&(e.$apply(function(){e.$eval(o.iEnter,{event:t})}),t.preventDefault())})}}]).directive("ieSelectFix",["$document",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,i,r){var a=e[0]&&e[0].attachEvent;if(a){var s=o[0];t.$watch(i.ieSelectFix,function(){setTimeout(function(){var e=document.createElement("option");s.add(e,null),s.remove(s.options.length-1)},0)})}}}}]);