/*2017-09-13 17:09:48 smartisan*/
var shopApp=angular.module("shopApp",["ngRoute","me-lazyload","ngTouch","apps.filters","apps.services","apps.controllers","apps.directives","templates","ngCollection","ng-translation"]),appsFilters=angular.module("apps.filters",[]),appsServices=angular.module("apps.services",["ngCookies"]),appsControllers=angular.module("apps.controllers",[]),appsDirectives=angular.module("apps.directives",[]);shopApp.config(["$locationProvider","$routeProvider","ngTranslationProvider","NavigatorProvider",function(e,t,o,i){i.init();var r={},n=i.language;r[n]=n,o.setDirectory("../m1/lang").setFilesSuffix(".json").langsFiles(r).fallbackLanguage("cn"),t.when("/category",{templateUrl:i.isMobile?"view/html/category-mobile.html":"view/html/category.html",controller:"CategoryCtrl",pageClass:"app-page-category",reloadOnSearch:!1,resolve:{goodsList:["$location","CategoryService",function(e,t){var o=e.search().id,i=e.search().sort||"sort",r=e.search().page||1;return t.getSpuListWithPromotion(o,r,i).then(function(e){return r<1||e.page_count<r?(location.replace("http://www.smartisan.com/#/error/404"),!1):e})}],displayType:["StorageService",function(e){return e.get("categoryDisplay")||1}],timestamp:["TimeStampService",function(e){return e.getServerTime().then(function(e){return e.now})}]}}),t.when("/hd/qinghuai",{templateUrl:i.isMobile?"view/html/qinghuai-mobile.html":"view/html/qinghuai.html",controller:"QinghuaiCtrl",pageClass:"app-page-qinghuai",subNavPosition:"",subNavTheme:"",title:"“情怀”背壳",resolve:{Cover:["$location","CategoryService","StoreConfig","Config",function(e,t,o,i){var r,n=63,a=1,l=0;return t.getSkuListForQH(n,a).then(function(e){if(e.list)for(;r=e.list.length,l<r;++l)e.list[l].shop_info&&(e.list[l].shop_info.image=e.list[l].shop_info.ali_image?e.list[l].shop_info.ali_image:e.list[l].shop_info.image,e.list[l].shop_info.isOSS=!!e.list[l].shop_info.ali_image);return e})}],promotions:["GoodsService",function(e){return e.fetchPromotionBrief().then(function(e){return e})}],timestamp:["TimeStampService",function(e){return e.getServerTime().then(function(e){return e.now})}]}}),t.when("/backshell",{templateUrl:i.isMobile?"view/html/backshell-mobile.html":"view/html/backshell.html",controller:"QinghuaiCtrl",pageClass:"app-page-qinghuai",subNavPosition:"",subNavTheme:"",resolve:{Cover:["$location","CategoryService",function(e,t){var o,i=e.search().id,r=1,n=0;return t.getSkuListForQH(i,r).then(function(e){if(e.list)for(;o=e.list.length,n<o;++n)e.list[n].shop_info&&(e.list[n].shop_info.image=e.list[n].shop_info.ali_image?e.list[n].shop_info.ali_image:e.list[n].shop_info.image,e.list[n].shop_info.isOSS=!!e.list[n].shop_info.ali_image);return e})}],promotions:["GoodsService",function(e){return e.fetchPromotionBrief().then(function(e){return e})}],timestamp:["TimeStampService",function(e){return e.getServerTime().then(function(e){return e.now})}]}}),t.when("/item/:id",{templateUrl:i.isMobile?"view/html/item-mobile.html":"view/html/item.html",controller:"ItemCtrl",pageClass:"app-page-item",subNavPosition:"",subNavTheme:"",title:"商品详情",reloadOnSearch:!1,redirectTo:function(e,t,o){i.isMobile&&location.replace("http://www.smartisan.com/shop-v2/#/item/"+(o.id||e.id))},resolve:{promotions:["GoodsService",function(e){return e.fetchPromotionBrief().then(function(e){return e})}],timestamp:["TimeStampService",function(e){return e.getServerTime().then(function(e){return e.now})}]}}),t.when("/jianguo",{templateUrl:i.isMobile?"view/html/jianguo-mobile.html":"view/html/jianguo.html",controller:"JianguoCtrl",pageClass:"app-page-jianguo",subNavPosition:"",subNavTheme:"theme-white",title:"坚果手机",resolve:{pageParams:["$location","NutsService",function(e,t){var o=e.search().name;switch(o||(e.search().youth?o="youth":e.search().art?o="art":e.search().black&&(o="black"),o&&e.url("jianguo?name="+o)),o){case"youth":o="normal";break;case"art":o="young";break;case"black":o="black";break;default:o=""}return t.getPageParams(o)}],curMobile:function(){return{}},specMap:["NutsService",function(e){return e.specMap()}],total:function(){return 0},giftInfo:["GoodsService","NutsService",function(e,t){return e.fetchPromotionBrief(t.mobileSkus.join(",")).then(function(e){return angular.isObject(e)?e:null},function(e){})}]}}),t.when("/t2",{templateUrl:i.isMobile?"view/html/t2-mobile.html":"view/html/t2.html",controller:"T2Ctrl",pageClass:"app-page-t2",subNavPosition:"",subNavTheme:"theme-white",title:"Smartisan T2",resolve:{pageParams:["$location","T2Service",function(e,t){var o=e.search().name;switch(o){case"black":o="black";break;default:o=""}return t.getPageParams(o)}],giftInfo:["GoodsService","T2Service",function(e,t){return e.fetchPromotionBrief(t.mobileSkus.join(",")).then(function(e){return angular.isObject(e)?e:null})}]}}),t.when("/buyphone",{templateUrl:i.isMobile?"view/html/m1-mobile.html":"view/html/m1.html",controller:"M1Ctrl",pageClass:"app-page-m1",subNavPosition:"theme-white",subNavTheme:"theme-white",title:"Smartisan M1",reloadOnSearch:!1,resolve:{promotions:["GoodsService",function(e){return e.fetchPromotionBrief().then(function(e){return e})}],mobileWithPackage:["M1Service","$location",function(e,t){var o="m1l"!==t.$$search.n?"m1":"m1l";return e.getMobileInfoWithPackageStock(o).then(function(e){return e},function(e){return e})}],accessoriesWithStock:["M1Service","$location",function(e,t){var o="m1l"!==t.$$search.n?"m1":"m1l";return e.getAccessoriesInfoWithStock(o).then(function(e){return e},function(e){return e})}],promotionsGifts:["M1Service",function(e){return e.getPromotionGiftsInfo().then(function(e){return e})}]}}),t.when("/buyphone/m1",{templateUrl:i.isMobile?"view/html/m1-mobile.html":"view/html/m1.html",controller:"M1Ctrl",pageClass:"app-page-m1",subNavPosition:"theme-white",subNavTheme:"theme-white",title:"Smartisan M1",reloadOnSearch:!1,resolve:{promotions:["GoodsService",function(e){return e.fetchPromotionBrief().then(function(e){return e})}],mobileWithPackage:["M1Service","$location",function(e,t){var o="m1l"!==t.$$search.n?"m1":"m1l";return e.getMobileInfoWithPackageStock(o).then(function(e){return e},function(e){return e})}],accessoriesWithStock:["M1Service","$location",function(e,t){var o="m1l"!==t.$$search.n?"m1":"m1l";return e.getAccessoriesInfoWithStock(o).then(function(e){return e},function(e){return e})}],promotionsGifts:["M1Service",function(e){return e.getPromotionGiftsInfo().then(function(e){return e})}]}}),t.when("/jianguopro",{templateUrl:i.isMobile?"view/html/jianguo-pro-mobile.html":"view/html/jianguo-pro.html",controller:"JianguoProCtrl",pageClass:"app-page-jianguo-pro",subNavPosition:"",subNavTheme:"",title:"坚果 Pro",reloadOnSearch:!1,redirectTo:function(e,t,o){if(i.isMobile){var r;switch(o.v+"-"+o.c){case"209-207":r="100027310";break;case"208-207":r="253"==o.p?"100027313":"100027309";break;case"209-232":r="100027308";break;case"208-232":r="100027307";break;case"209-210":r="100027306";break;case"209-201":r="100027305";break;case"208-201":r="100027304";break;case"209-36":r="100027303";break;case"208-36":r="100027302";break;case"93-36":default:r="100027301"}location.replace("http://www.smartisan.com/shop-v2/#/item/"+r)}},resolve:{mobileWithStock:["JianguoProService",function(e){return e.getMobileInfoWithStock().then(function(e){return e},function(e){return e})}],accessoriesAndPromosInfo:["JianguoProService",function(e){return e.getAccessoriesAndPromos().then(function(e){return e},function(e){return e})}],timestamp:["TimeStampService",function(e){return e.getServerTime().then(function(e){return e.now})}],promotions:["GoodsService",function(e){return e.fetchPromotionBrief().then(function(e){return e})}]}}),t.when("/jianguopro-cdkey",{templateUrl:i.isMobile?"view/html/jianguo-pro-cdkey-mobile.html":"view/html/jianguo-pro-cdkey.html",controller:"JianguoProCdkeyCtrl",pageClass:"app-page-jianguo-pro",subNavPosition:"",subNavTheme:"",title:"坚果 Pro",reloadOnSearch:!1,resolve:{mobileInfoByCdkey:["JianguoProCdkeyService",function(e){return e.getMobileInfoByCdkey().then(function(e){return e},function(e){return e})}]}}),t.when("/insurance",{templateUrl:i.isMobile?"view/html/insurance-mobile.html":"view/html/insurance.html",controller:"InsuranceCtrl",pageClass:"app-page-accessories",subNavPosition:"hide",subNavTheme:"",hideAside:!0,resolve:{renderData:["InsuranceService",function(e){return e.reformMobileData()}],promotions:["GoodsService",function(e){return e.fetchPromotionBrief().then(function(e){return e})}]}}),t.when("/jianguopro/converge",{templateUrl:i.isMobile?"view/html/jianguo-pro-converge-mobile.html":"view/html/jianguo-pro-converge.html",controller:"JianguoProConvergeCtrl",pageClass:"app-page-jianguopro-converge",subNavPosition:"",subNavTheme:"",resolve:{timestamp:["TimeStampService",function(e){return e.getServerTime().then(function(e){return e.now})}]}}),t.when("/cart",{templateUrl:i.isMobile?"view/html/cart-mobile.html":"view/html/cart.html",controller:"CartCtrlReBuild",pageClass:"app-page-cart",subNavPosition:"hide",subNavTheme:"",title:"购物车",hideAside:!0,isCartOrderPage:!0,needLogin:!0,resolve:{timestamp:["TimeStampService",function(e){return e.getServerTime().then(function(e){return e.now})}]}}),t.when("/cdkey",{templateUrl:i.isMobile?"view/html/cdkey-mobile.html":"view/html/cdkey.html",controller:"CdkeyCtrl",pageClass:i.isMobile?"app-page-cdkey-m":"app-page-cdkey",subNavPosition:"",subNavTheme:"",title:"优先购买通道"}),t.when("/converge",{templateUrl:i.isMobile?"view/html/converge-mobile.html":"view/html/converge.html",controller:"ConvergeCtrl",pageClass:"app-page-converge",title:"新品配件",resolve:{convergeList:["$location","CartRequest","StoreConfig","Config",function(e,t,o,i){var r=[100022303,100022401,100022501,100022601,100022701,100022702,100022801,100023903];return t.getSkusInfo({ids:r.join(",")}).then(function(e){return{skuList:r,msg:e}})}]}}),t.when("/huanxin",{redirectTo:function(e,t,o){location.replace("http://www.smartisan.com/service/#/tradein")}}),t.when("/huanxin/exchange",{redirectTo:function(e,t,o){location.replace("http://www.smartisan.com/service/#/tradein")}}),t.when("/",{title:"logo",redirectTo:function(e,t,o){location.replace("http://www.smartisan.com/")}}),t.otherwise({redirectTo:function(e,t,o){location.replace("http://www.smartisan.com/#/error/404")}})}]),shopApp.run(["$rootScope","$route","$location","$timeout","Utils","GoodsService","M1Service","Navigator","NavigationMenu","Account","TitleBar",function(e,t,o,i,r,n,a,l,s,c,u){e.subHeaderJianguopro&&!r.isMobile()||s.subMenu().then(function(t){var o=[];if(angular.isArray(t))if(r.isMobile()){for(var i=0;i<t.length;++i)t[i].isMobile?o.push({title:"坚果 Pro",url:"../shop/#/jianguopro"},{title:"Smartisan M1 / M1L",url:"../shop/#/buyphone/m1"}):o.push(t[i]);e.subMenuList=o}else e.subMenuList=t}),e.isMobile=l.isMobile,e.lang=l.language,e.useCover=!1,c.set({cartSync:!0}),e.$on("$locationChangeStart",function(e,t,o){if(r.matchModules("shop","item")){var i=!!t&&t.match(/\/item\/(\d+)/)||"",a=!!t&&t.match(/anchor=(\D+)/),l="";a&&a[1]&&(l=a[1]),i&&i[1]&&9==i[1].length&&n.skuResolve(i[1],null,l)}}),e.$on("$routeChangeStart",function(t,o,n){var a=o.$$route.originalPath;e.subNavPosition=o.$$route.subNavPosition||"",e.subNavTheme=o.$$route.subNavTheme||"",e.pageClass=o.$$route.pageClass,e.hideAside=o.$$route.hideAside,e.isCartOrderPage=o.$$route.isCartOrderPage,"/cart"===a?_.size(e.cartOrder)>0?(e.pageLoading=!1,e.cartOrder.tips&&i(function(){r.openDialog({message:e.cartOrder.tips})},200)):(e.pageLoading=!0,e.isLoggedIn===!1&&location.replace("https://account.smartisan.com/#/v2/login?return_url="+encodeURIComponent(e.rootShopPath+"#/cart"))):e.pageLoading=!0,"/jianguopro"===a||"/jianguopro-cdkey"===a?e.subHeaderJianguopro=!0:e.subHeaderJianguopro=!1,r.isMobile()?u.toggleBackDrawer():$(".header-desktop").removeClass("fixed"),e.currentPage=""}),e.$on("$routeChangeSuccess",function(t,o,i){var n=o.$$route.originalPath;"/item/:id"!=n&&"/cart"!=n&&(e.pageLoading=!1),r.setHeaderActive("")})}]);